(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by LiveScript 1.4.0
var apply, curry, flip, fix, over, memoize, slice$ = [].slice, toString$ = {}.toString;
apply = curry$(function(f, list){
  return f.apply(null, list);
});
curry = function(f){
  return curry$(f);
};
flip = curry$(function(f, x, y){
  return f(y, x);
});
fix = function(f){
  return function(g){
    return function(){
      return f(g(g)).apply(null, arguments);
    };
  }(function(g){
    return function(){
      return f(g(g)).apply(null, arguments);
    };
  });
};
over = curry$(function(f, g, x, y){
  return f(g(x), g(y));
});
memoize = function(f){
  var memo;
  memo = {};
  return function(){
    var args, key, arg;
    args = slice$.call(arguments);
    key = (function(){
      var i$, ref$, len$, results$ = [];
      for (i$ = 0, len$ = (ref$ = args).length; i$ < len$; ++i$) {
        arg = ref$[i$];
        results$.push(arg + toString$.call(arg).slice(8, -1));
      }
      return results$;
    }()).join('');
    return memo[key] = key in memo
      ? memo[key]
      : f.apply(null, args);
  };
};
module.exports = {
  curry: curry,
  flip: flip,
  fix: fix,
  apply: apply,
  over: over,
  memoize: memoize
};
function curry$(f, bound){
  var context,
  _curry = function(args) {
    return f.length > 1 ? function(){
      var params = args ? args.concat() : [];
      context = bound ? context || this : this;
      return params.push.apply(params, arguments) <
          f.length && arguments.length ?
        _curry.call(context, params) : f.apply(context, params);
    } : f;
  };
  return _curry();
}
},{}],2:[function(require,module,exports){
// Generated by LiveScript 1.4.0
var each, map, compact, filter, reject, partition, find, head, first, tail, last, initial, empty, reverse, unique, uniqueBy, fold, foldl, fold1, foldl1, foldr, foldr1, unfoldr, concat, concatMap, flatten, difference, intersection, union, countBy, groupBy, andList, orList, any, all, sort, sortWith, sortBy, sum, product, mean, average, maximum, minimum, maximumBy, minimumBy, scan, scanl, scan1, scanl1, scanr, scanr1, slice, take, drop, splitAt, takeWhile, dropWhile, span, breakList, zip, zipWith, zipAll, zipAllWith, at, elemIndex, elemIndices, findIndex, findIndices, toString$ = {}.toString, slice$ = [].slice;
each = curry$(function(f, xs){
  var i$, len$, x;
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    f(x);
  }
  return xs;
});
map = curry$(function(f, xs){
  var i$, len$, x, results$ = [];
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    results$.push(f(x));
  }
  return results$;
});
compact = function(xs){
  var i$, len$, x, results$ = [];
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    if (x) {
      results$.push(x);
    }
  }
  return results$;
};
filter = curry$(function(f, xs){
  var i$, len$, x, results$ = [];
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    if (f(x)) {
      results$.push(x);
    }
  }
  return results$;
});
reject = curry$(function(f, xs){
  var i$, len$, x, results$ = [];
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    if (!f(x)) {
      results$.push(x);
    }
  }
  return results$;
});
partition = curry$(function(f, xs){
  var passed, failed, i$, len$, x;
  passed = [];
  failed = [];
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    (f(x) ? passed : failed).push(x);
  }
  return [passed, failed];
});
find = curry$(function(f, xs){
  var i$, len$, x;
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    if (f(x)) {
      return x;
    }
  }
});
head = first = function(xs){
  return xs[0];
};
tail = function(xs){
  if (!xs.length) {
    return;
  }
  return xs.slice(1);
};
last = function(xs){
  return xs[xs.length - 1];
};
initial = function(xs){
  if (!xs.length) {
    return;
  }
  return xs.slice(0, -1);
};
empty = function(xs){
  return !xs.length;
};
reverse = function(xs){
  return xs.concat().reverse();
};
unique = function(xs){
  var result, i$, len$, x;
  result = [];
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    if (!in$(x, result)) {
      result.push(x);
    }
  }
  return result;
};
uniqueBy = curry$(function(f, xs){
  var seen, i$, len$, x, val, results$ = [];
  seen = [];
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    val = f(x);
    if (in$(val, seen)) {
      continue;
    }
    seen.push(val);
    results$.push(x);
  }
  return results$;
});
fold = foldl = curry$(function(f, memo, xs){
  var i$, len$, x;
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    memo = f(memo, x);
  }
  return memo;
});
fold1 = foldl1 = curry$(function(f, xs){
  return fold(f, xs[0], xs.slice(1));
});
foldr = curry$(function(f, memo, xs){
  var i$, x;
  for (i$ = xs.length - 1; i$ >= 0; --i$) {
    x = xs[i$];
    memo = f(x, memo);
  }
  return memo;
});
foldr1 = curry$(function(f, xs){
  return foldr(f, xs[xs.length - 1], xs.slice(0, -1));
});
unfoldr = curry$(function(f, b){
  var result, x, that;
  result = [];
  x = b;
  while ((that = f(x)) != null) {
    result.push(that[0]);
    x = that[1];
  }
  return result;
});
concat = function(xss){
  return [].concat.apply([], xss);
};
concatMap = curry$(function(f, xs){
  var x;
  return [].concat.apply([], (function(){
    var i$, ref$, len$, results$ = [];
    for (i$ = 0, len$ = (ref$ = xs).length; i$ < len$; ++i$) {
      x = ref$[i$];
      results$.push(f(x));
    }
    return results$;
  }()));
});
flatten = function(xs){
  var x;
  return [].concat.apply([], (function(){
    var i$, ref$, len$, results$ = [];
    for (i$ = 0, len$ = (ref$ = xs).length; i$ < len$; ++i$) {
      x = ref$[i$];
      if (toString$.call(x).slice(8, -1) === 'Array') {
        results$.push(flatten(x));
      } else {
        results$.push(x);
      }
    }
    return results$;
  }()));
};
difference = function(xs){
  var yss, results, i$, len$, x, j$, len1$, ys;
  yss = slice$.call(arguments, 1);
  results = [];
  outer: for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    for (j$ = 0, len1$ = yss.length; j$ < len1$; ++j$) {
      ys = yss[j$];
      if (in$(x, ys)) {
        continue outer;
      }
    }
    results.push(x);
  }
  return results;
};
intersection = function(xs){
  var yss, results, i$, len$, x, j$, len1$, ys;
  yss = slice$.call(arguments, 1);
  results = [];
  outer: for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    for (j$ = 0, len1$ = yss.length; j$ < len1$; ++j$) {
      ys = yss[j$];
      if (!in$(x, ys)) {
        continue outer;
      }
    }
    results.push(x);
  }
  return results;
};
union = function(){
  var xss, results, i$, len$, xs, j$, len1$, x;
  xss = slice$.call(arguments);
  results = [];
  for (i$ = 0, len$ = xss.length; i$ < len$; ++i$) {
    xs = xss[i$];
    for (j$ = 0, len1$ = xs.length; j$ < len1$; ++j$) {
      x = xs[j$];
      if (!in$(x, results)) {
        results.push(x);
      }
    }
  }
  return results;
};
countBy = curry$(function(f, xs){
  var results, i$, len$, x, key;
  results = {};
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    key = f(x);
    if (key in results) {
      results[key] += 1;
    } else {
      results[key] = 1;
    }
  }
  return results;
});
groupBy = curry$(function(f, xs){
  var results, i$, len$, x, key;
  results = {};
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    key = f(x);
    if (key in results) {
      results[key].push(x);
    } else {
      results[key] = [x];
    }
  }
  return results;
});
andList = function(xs){
  var i$, len$, x;
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    if (!x) {
      return false;
    }
  }
  return true;
};
orList = function(xs){
  var i$, len$, x;
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    if (x) {
      return true;
    }
  }
  return false;
};
any = curry$(function(f, xs){
  var i$, len$, x;
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    if (f(x)) {
      return true;
    }
  }
  return false;
});
all = curry$(function(f, xs){
  var i$, len$, x;
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    if (!f(x)) {
      return false;
    }
  }
  return true;
});
sort = function(xs){
  return xs.concat().sort(function(x, y){
    if (x > y) {
      return 1;
    } else if (x < y) {
      return -1;
    } else {
      return 0;
    }
  });
};
sortWith = curry$(function(f, xs){
  return xs.concat().sort(f);
});
sortBy = curry$(function(f, xs){
  return xs.concat().sort(function(x, y){
    if (f(x) > f(y)) {
      return 1;
    } else if (f(x) < f(y)) {
      return -1;
    } else {
      return 0;
    }
  });
});
sum = function(xs){
  var result, i$, len$, x;
  result = 0;
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    result += x;
  }
  return result;
};
product = function(xs){
  var result, i$, len$, x;
  result = 1;
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    result *= x;
  }
  return result;
};
mean = average = function(xs){
  var sum, i$, len$, x;
  sum = 0;
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    x = xs[i$];
    sum += x;
  }
  return sum / xs.length;
};
maximum = function(xs){
  var max, i$, ref$, len$, x;
  max = xs[0];
  for (i$ = 0, len$ = (ref$ = xs.slice(1)).length; i$ < len$; ++i$) {
    x = ref$[i$];
    if (x > max) {
      max = x;
    }
  }
  return max;
};
minimum = function(xs){
  var min, i$, ref$, len$, x;
  min = xs[0];
  for (i$ = 0, len$ = (ref$ = xs.slice(1)).length; i$ < len$; ++i$) {
    x = ref$[i$];
    if (x < min) {
      min = x;
    }
  }
  return min;
};
maximumBy = curry$(function(f, xs){
  var max, i$, ref$, len$, x;
  max = xs[0];
  for (i$ = 0, len$ = (ref$ = xs.slice(1)).length; i$ < len$; ++i$) {
    x = ref$[i$];
    if (f(x) > f(max)) {
      max = x;
    }
  }
  return max;
});
minimumBy = curry$(function(f, xs){
  var min, i$, ref$, len$, x;
  min = xs[0];
  for (i$ = 0, len$ = (ref$ = xs.slice(1)).length; i$ < len$; ++i$) {
    x = ref$[i$];
    if (f(x) < f(min)) {
      min = x;
    }
  }
  return min;
});
scan = scanl = curry$(function(f, memo, xs){
  var last, x;
  last = memo;
  return [memo].concat((function(){
    var i$, ref$, len$, results$ = [];
    for (i$ = 0, len$ = (ref$ = xs).length; i$ < len$; ++i$) {
      x = ref$[i$];
      results$.push(last = f(last, x));
    }
    return results$;
  }()));
});
scan1 = scanl1 = curry$(function(f, xs){
  if (!xs.length) {
    return;
  }
  return scan(f, xs[0], xs.slice(1));
});
scanr = curry$(function(f, memo, xs){
  xs = xs.concat().reverse();
  return scan(f, memo, xs).reverse();
});
scanr1 = curry$(function(f, xs){
  if (!xs.length) {
    return;
  }
  xs = xs.concat().reverse();
  return scan(f, xs[0], xs.slice(1)).reverse();
});
slice = curry$(function(x, y, xs){
  return xs.slice(x, y);
});
take = curry$(function(n, xs){
  if (n <= 0) {
    return xs.slice(0, 0);
  } else {
    return xs.slice(0, n);
  }
});
drop = curry$(function(n, xs){
  if (n <= 0) {
    return xs;
  } else {
    return xs.slice(n);
  }
});
splitAt = curry$(function(n, xs){
  return [take(n, xs), drop(n, xs)];
});
takeWhile = curry$(function(p, xs){
  var len, i;
  len = xs.length;
  if (!len) {
    return xs;
  }
  i = 0;
  while (i < len && p(xs[i])) {
    i += 1;
  }
  return xs.slice(0, i);
});
dropWhile = curry$(function(p, xs){
  var len, i;
  len = xs.length;
  if (!len) {
    return xs;
  }
  i = 0;
  while (i < len && p(xs[i])) {
    i += 1;
  }
  return xs.slice(i);
});
span = curry$(function(p, xs){
  return [takeWhile(p, xs), dropWhile(p, xs)];
});
breakList = curry$(function(p, xs){
  return span(compose$(p, not$), xs);
});
zip = curry$(function(xs, ys){
  var result, len, i$, len$, i, x;
  result = [];
  len = ys.length;
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    i = i$;
    x = xs[i$];
    if (i === len) {
      break;
    }
    result.push([x, ys[i]]);
  }
  return result;
});
zipWith = curry$(function(f, xs, ys){
  var result, len, i$, len$, i, x;
  result = [];
  len = ys.length;
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    i = i$;
    x = xs[i$];
    if (i === len) {
      break;
    }
    result.push(f(x, ys[i]));
  }
  return result;
});
zipAll = function(){
  var xss, minLength, i$, len$, xs, ref$, i, lresult$, j$, results$ = [];
  xss = slice$.call(arguments);
  minLength = undefined;
  for (i$ = 0, len$ = xss.length; i$ < len$; ++i$) {
    xs = xss[i$];
    minLength <= (ref$ = xs.length) || (minLength = ref$);
  }
  for (i$ = 0; i$ < minLength; ++i$) {
    i = i$;
    lresult$ = [];
    for (j$ = 0, len$ = xss.length; j$ < len$; ++j$) {
      xs = xss[j$];
      lresult$.push(xs[i]);
    }
    results$.push(lresult$);
  }
  return results$;
};
zipAllWith = function(f){
  var xss, minLength, i$, len$, xs, ref$, i, results$ = [];
  xss = slice$.call(arguments, 1);
  minLength = undefined;
  for (i$ = 0, len$ = xss.length; i$ < len$; ++i$) {
    xs = xss[i$];
    minLength <= (ref$ = xs.length) || (minLength = ref$);
  }
  for (i$ = 0; i$ < minLength; ++i$) {
    i = i$;
    results$.push(f.apply(null, (fn$())));
  }
  return results$;
  function fn$(){
    var i$, ref$, len$, results$ = [];
    for (i$ = 0, len$ = (ref$ = xss).length; i$ < len$; ++i$) {
      xs = ref$[i$];
      results$.push(xs[i]);
    }
    return results$;
  }
};
at = curry$(function(n, xs){
  if (n < 0) {
    return xs[xs.length + n];
  } else {
    return xs[n];
  }
});
elemIndex = curry$(function(el, xs){
  var i$, len$, i, x;
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    i = i$;
    x = xs[i$];
    if (x === el) {
      return i;
    }
  }
});
elemIndices = curry$(function(el, xs){
  var i$, len$, i, x, results$ = [];
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    i = i$;
    x = xs[i$];
    if (x === el) {
      results$.push(i);
    }
  }
  return results$;
});
findIndex = curry$(function(f, xs){
  var i$, len$, i, x;
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    i = i$;
    x = xs[i$];
    if (f(x)) {
      return i;
    }
  }
});
findIndices = curry$(function(f, xs){
  var i$, len$, i, x, results$ = [];
  for (i$ = 0, len$ = xs.length; i$ < len$; ++i$) {
    i = i$;
    x = xs[i$];
    if (f(x)) {
      results$.push(i);
    }
  }
  return results$;
});
module.exports = {
  each: each,
  map: map,
  filter: filter,
  compact: compact,
  reject: reject,
  partition: partition,
  find: find,
  head: head,
  first: first,
  tail: tail,
  last: last,
  initial: initial,
  empty: empty,
  reverse: reverse,
  difference: difference,
  intersection: intersection,
  union: union,
  countBy: countBy,
  groupBy: groupBy,
  fold: fold,
  fold1: fold1,
  foldl: foldl,
  foldl1: foldl1,
  foldr: foldr,
  foldr1: foldr1,
  unfoldr: unfoldr,
  andList: andList,
  orList: orList,
  any: any,
  all: all,
  unique: unique,
  uniqueBy: uniqueBy,
  sort: sort,
  sortWith: sortWith,
  sortBy: sortBy,
  sum: sum,
  product: product,
  mean: mean,
  average: average,
  concat: concat,
  concatMap: concatMap,
  flatten: flatten,
  maximum: maximum,
  minimum: minimum,
  maximumBy: maximumBy,
  minimumBy: minimumBy,
  scan: scan,
  scan1: scan1,
  scanl: scanl,
  scanl1: scanl1,
  scanr: scanr,
  scanr1: scanr1,
  slice: slice,
  take: take,
  drop: drop,
  splitAt: splitAt,
  takeWhile: takeWhile,
  dropWhile: dropWhile,
  span: span,
  breakList: breakList,
  zip: zip,
  zipWith: zipWith,
  zipAll: zipAll,
  zipAllWith: zipAllWith,
  at: at,
  elemIndex: elemIndex,
  elemIndices: elemIndices,
  findIndex: findIndex,
  findIndices: findIndices
};
function curry$(f, bound){
  var context,
  _curry = function(args) {
    return f.length > 1 ? function(){
      var params = args ? args.concat() : [];
      context = bound ? context || this : this;
      return params.push.apply(params, arguments) <
          f.length && arguments.length ?
        _curry.call(context, params) : f.apply(context, params);
    } : f;
  };
  return _curry();
}
function in$(x, xs){
  var i = -1, l = xs.length >>> 0;
  while (++i < l) if (x === xs[i]) return true;
  return false;
}
function compose$() {
  var functions = arguments;
  return function() {
    var i, result;
    result = functions[0].apply(this, arguments);
    for (i = 1; i < functions.length; ++i) {
      result = functions[i](result);
    }
    return result;
  };
}
function not$(x){ return !x; }
},{}],3:[function(require,module,exports){
// Generated by LiveScript 1.4.0
var max, min, negate, abs, signum, quot, rem, div, mod, recip, pi, tau, exp, sqrt, ln, pow, sin, tan, cos, asin, acos, atan, atan2, truncate, round, ceiling, floor, isItNaN, even, odd, gcd, lcm;
max = curry$(function(x$, y$){
  return x$ > y$ ? x$ : y$;
});
min = curry$(function(x$, y$){
  return x$ < y$ ? x$ : y$;
});
negate = function(x){
  return -x;
};
abs = Math.abs;
signum = function(x){
  if (x < 0) {
    return -1;
  } else if (x > 0) {
    return 1;
  } else {
    return 0;
  }
};
quot = curry$(function(x, y){
  return ~~(x / y);
});
rem = curry$(function(x$, y$){
  return x$ % y$;
});
div = curry$(function(x, y){
  return Math.floor(x / y);
});
mod = curry$(function(x$, y$){
  var ref$;
  return (((x$) % (ref$ = y$) + ref$) % ref$);
});
recip = (function(it){
  return 1 / it;
});
pi = Math.PI;
tau = pi * 2;
exp = Math.exp;
sqrt = Math.sqrt;
ln = Math.log;
pow = curry$(function(x$, y$){
  return Math.pow(x$, y$);
});
sin = Math.sin;
tan = Math.tan;
cos = Math.cos;
asin = Math.asin;
acos = Math.acos;
atan = Math.atan;
atan2 = curry$(function(x, y){
  return Math.atan2(x, y);
});
truncate = function(x){
  return ~~x;
};
round = Math.round;
ceiling = Math.ceil;
floor = Math.floor;
isItNaN = function(x){
  return x !== x;
};
even = function(x){
  return x % 2 === 0;
};
odd = function(x){
  return x % 2 !== 0;
};
gcd = curry$(function(x, y){
  var z;
  x = Math.abs(x);
  y = Math.abs(y);
  while (y !== 0) {
    z = x % y;
    x = y;
    y = z;
  }
  return x;
});
lcm = curry$(function(x, y){
  return Math.abs(Math.floor(x / gcd(x, y) * y));
});
module.exports = {
  max: max,
  min: min,
  negate: negate,
  abs: abs,
  signum: signum,
  quot: quot,
  rem: rem,
  div: div,
  mod: mod,
  recip: recip,
  pi: pi,
  tau: tau,
  exp: exp,
  sqrt: sqrt,
  ln: ln,
  pow: pow,
  sin: sin,
  tan: tan,
  cos: cos,
  acos: acos,
  asin: asin,
  atan: atan,
  atan2: atan2,
  truncate: truncate,
  round: round,
  ceiling: ceiling,
  floor: floor,
  isItNaN: isItNaN,
  even: even,
  odd: odd,
  gcd: gcd,
  lcm: lcm
};
function curry$(f, bound){
  var context,
  _curry = function(args) {
    return f.length > 1 ? function(){
      var params = args ? args.concat() : [];
      context = bound ? context || this : this;
      return params.push.apply(params, arguments) <
          f.length && arguments.length ?
        _curry.call(context, params) : f.apply(context, params);
    } : f;
  };
  return _curry();
}
},{}],4:[function(require,module,exports){
// Generated by LiveScript 1.4.0
var values, keys, pairsToObj, objToPairs, listsToObj, objToLists, empty, each, map, compact, filter, reject, partition, find;
values = function(object){
  var i$, x, results$ = [];
  for (i$ in object) {
    x = object[i$];
    results$.push(x);
  }
  return results$;
};
keys = function(object){
  var x, results$ = [];
  for (x in object) {
    results$.push(x);
  }
  return results$;
};
pairsToObj = function(object){
  var i$, len$, x, resultObj$ = {};
  for (i$ = 0, len$ = object.length; i$ < len$; ++i$) {
    x = object[i$];
    resultObj$[x[0]] = x[1];
  }
  return resultObj$;
};
objToPairs = function(object){
  var key, value, results$ = [];
  for (key in object) {
    value = object[key];
    results$.push([key, value]);
  }
  return results$;
};
listsToObj = curry$(function(keys, values){
  var i$, len$, i, key, resultObj$ = {};
  for (i$ = 0, len$ = keys.length; i$ < len$; ++i$) {
    i = i$;
    key = keys[i$];
    resultObj$[key] = values[i];
  }
  return resultObj$;
});
objToLists = function(object){
  var keys, values, key, value;
  keys = [];
  values = [];
  for (key in object) {
    value = object[key];
    keys.push(key);
    values.push(value);
  }
  return [keys, values];
};
empty = function(object){
  var x;
  for (x in object) {
    return false;
  }
  return true;
};
each = curry$(function(f, object){
  var i$, x;
  for (i$ in object) {
    x = object[i$];
    f(x);
  }
  return object;
});
map = curry$(function(f, object){
  var k, x, resultObj$ = {};
  for (k in object) {
    x = object[k];
    resultObj$[k] = f(x);
  }
  return resultObj$;
});
compact = function(object){
  var k, x, resultObj$ = {};
  for (k in object) {
    x = object[k];
    if (x) {
      resultObj$[k] = x;
    }
  }
  return resultObj$;
};
filter = curry$(function(f, object){
  var k, x, resultObj$ = {};
  for (k in object) {
    x = object[k];
    if (f(x)) {
      resultObj$[k] = x;
    }
  }
  return resultObj$;
});
reject = curry$(function(f, object){
  var k, x, resultObj$ = {};
  for (k in object) {
    x = object[k];
    if (!f(x)) {
      resultObj$[k] = x;
    }
  }
  return resultObj$;
});
partition = curry$(function(f, object){
  var passed, failed, k, x;
  passed = {};
  failed = {};
  for (k in object) {
    x = object[k];
    (f(x) ? passed : failed)[k] = x;
  }
  return [passed, failed];
});
find = curry$(function(f, object){
  var i$, x;
  for (i$ in object) {
    x = object[i$];
    if (f(x)) {
      return x;
    }
  }
});
module.exports = {
  values: values,
  keys: keys,
  pairsToObj: pairsToObj,
  objToPairs: objToPairs,
  listsToObj: listsToObj,
  objToLists: objToLists,
  empty: empty,
  each: each,
  map: map,
  filter: filter,
  compact: compact,
  reject: reject,
  partition: partition,
  find: find
};
function curry$(f, bound){
  var context,
  _curry = function(args) {
    return f.length > 1 ? function(){
      var params = args ? args.concat() : [];
      context = bound ? context || this : this;
      return params.push.apply(params, arguments) <
          f.length && arguments.length ?
        _curry.call(context, params) : f.apply(context, params);
    } : f;
  };
  return _curry();
}
},{}],5:[function(require,module,exports){
// Generated by LiveScript 1.4.0
var split, join, lines, unlines, words, unwords, chars, unchars, reverse, repeat, capitalize, camelize, dasherize;
split = curry$(function(sep, str){
  return str.split(sep);
});
join = curry$(function(sep, xs){
  return xs.join(sep);
});
lines = function(str){
  if (!str.length) {
    return [];
  }
  return str.split('\n');
};
unlines = function(it){
  return it.join('\n');
};
words = function(str){
  if (!str.length) {
    return [];
  }
  return str.split(/[ ]+/);
};
unwords = function(it){
  return it.join(' ');
};
chars = function(it){
  return it.split('');
};
unchars = function(it){
  return it.join('');
};
reverse = function(str){
  return str.split('').reverse().join('');
};
repeat = curry$(function(n, str){
  var result, i$;
  result = '';
  for (i$ = 0; i$ < n; ++i$) {
    result += str;
  }
  return result;
});
capitalize = function(str){
  return str.charAt(0).toUpperCase() + str.slice(1);
};
camelize = function(it){
  return it.replace(/[-_]+(.)?/g, function(arg$, c){
    return (c != null ? c : '').toUpperCase();
  });
};
dasherize = function(str){
  return str.replace(/([^-A-Z])([A-Z]+)/g, function(arg$, lower, upper){
    return lower + "-" + (upper.length > 1
      ? upper
      : upper.toLowerCase());
  }).replace(/^([A-Z]+)/, function(arg$, upper){
    if (upper.length > 1) {
      return upper + "-";
    } else {
      return upper.toLowerCase();
    }
  });
};
module.exports = {
  split: split,
  join: join,
  lines: lines,
  unlines: unlines,
  words: words,
  unwords: unwords,
  chars: chars,
  unchars: unchars,
  reverse: reverse,
  repeat: repeat,
  capitalize: capitalize,
  camelize: camelize,
  dasherize: dasherize
};
function curry$(f, bound){
  var context,
  _curry = function(args) {
    return f.length > 1 ? function(){
      var params = args ? args.concat() : [];
      context = bound ? context || this : this;
      return params.push.apply(params, arguments) <
          f.length && arguments.length ?
        _curry.call(context, params) : f.apply(context, params);
    } : f;
  };
  return _curry();
}
},{}],6:[function(require,module,exports){
// Generated by LiveScript 1.4.0
var Func, List, Obj, Str, Num, id, isType, replicate, prelude, toString$ = {}.toString;
Func = require('./Func.js');
List = require('./List.js');
Obj = require('./Obj.js');
Str = require('./Str.js');
Num = require('./Num.js');
id = function(x){
  return x;
};
isType = curry$(function(type, x){
  return toString$.call(x).slice(8, -1) === type;
});
replicate = curry$(function(n, x){
  var i$, results$ = [];
  for (i$ = 0; i$ < n; ++i$) {
    results$.push(x);
  }
  return results$;
});
Str.empty = List.empty;
Str.slice = List.slice;
Str.take = List.take;
Str.drop = List.drop;
Str.splitAt = List.splitAt;
Str.takeWhile = List.takeWhile;
Str.dropWhile = List.dropWhile;
Str.span = List.span;
Str.breakStr = List.breakList;
prelude = {
  Func: Func,
  List: List,
  Obj: Obj,
  Str: Str,
  Num: Num,
  id: id,
  isType: isType,
  replicate: replicate
};
prelude.each = List.each;
prelude.map = List.map;
prelude.filter = List.filter;
prelude.compact = List.compact;
prelude.reject = List.reject;
prelude.partition = List.partition;
prelude.find = List.find;
prelude.head = List.head;
prelude.first = List.first;
prelude.tail = List.tail;
prelude.last = List.last;
prelude.initial = List.initial;
prelude.empty = List.empty;
prelude.reverse = List.reverse;
prelude.difference = List.difference;
prelude.intersection = List.intersection;
prelude.union = List.union;
prelude.countBy = List.countBy;
prelude.groupBy = List.groupBy;
prelude.fold = List.fold;
prelude.foldl = List.foldl;
prelude.fold1 = List.fold1;
prelude.foldl1 = List.foldl1;
prelude.foldr = List.foldr;
prelude.foldr1 = List.foldr1;
prelude.unfoldr = List.unfoldr;
prelude.andList = List.andList;
prelude.orList = List.orList;
prelude.any = List.any;
prelude.all = List.all;
prelude.unique = List.unique;
prelude.uniqueBy = List.uniqueBy;
prelude.sort = List.sort;
prelude.sortWith = List.sortWith;
prelude.sortBy = List.sortBy;
prelude.sum = List.sum;
prelude.product = List.product;
prelude.mean = List.mean;
prelude.average = List.average;
prelude.concat = List.concat;
prelude.concatMap = List.concatMap;
prelude.flatten = List.flatten;
prelude.maximum = List.maximum;
prelude.minimum = List.minimum;
prelude.maximumBy = List.maximumBy;
prelude.minimumBy = List.minimumBy;
prelude.scan = List.scan;
prelude.scanl = List.scanl;
prelude.scan1 = List.scan1;
prelude.scanl1 = List.scanl1;
prelude.scanr = List.scanr;
prelude.scanr1 = List.scanr1;
prelude.slice = List.slice;
prelude.take = List.take;
prelude.drop = List.drop;
prelude.splitAt = List.splitAt;
prelude.takeWhile = List.takeWhile;
prelude.dropWhile = List.dropWhile;
prelude.span = List.span;
prelude.breakList = List.breakList;
prelude.zip = List.zip;
prelude.zipWith = List.zipWith;
prelude.zipAll = List.zipAll;
prelude.zipAllWith = List.zipAllWith;
prelude.at = List.at;
prelude.elemIndex = List.elemIndex;
prelude.elemIndices = List.elemIndices;
prelude.findIndex = List.findIndex;
prelude.findIndices = List.findIndices;
prelude.apply = Func.apply;
prelude.curry = Func.curry;
prelude.flip = Func.flip;
prelude.fix = Func.fix;
prelude.over = Func.over;
prelude.split = Str.split;
prelude.join = Str.join;
prelude.lines = Str.lines;
prelude.unlines = Str.unlines;
prelude.words = Str.words;
prelude.unwords = Str.unwords;
prelude.chars = Str.chars;
prelude.unchars = Str.unchars;
prelude.repeat = Str.repeat;
prelude.capitalize = Str.capitalize;
prelude.camelize = Str.camelize;
prelude.dasherize = Str.dasherize;
prelude.values = Obj.values;
prelude.keys = Obj.keys;
prelude.pairsToObj = Obj.pairsToObj;
prelude.objToPairs = Obj.objToPairs;
prelude.listsToObj = Obj.listsToObj;
prelude.objToLists = Obj.objToLists;
prelude.max = Num.max;
prelude.min = Num.min;
prelude.negate = Num.negate;
prelude.abs = Num.abs;
prelude.signum = Num.signum;
prelude.quot = Num.quot;
prelude.rem = Num.rem;
prelude.div = Num.div;
prelude.mod = Num.mod;
prelude.recip = Num.recip;
prelude.pi = Num.pi;
prelude.tau = Num.tau;
prelude.exp = Num.exp;
prelude.sqrt = Num.sqrt;
prelude.ln = Num.ln;
prelude.pow = Num.pow;
prelude.sin = Num.sin;
prelude.tan = Num.tan;
prelude.cos = Num.cos;
prelude.acos = Num.acos;
prelude.asin = Num.asin;
prelude.atan = Num.atan;
prelude.atan2 = Num.atan2;
prelude.truncate = Num.truncate;
prelude.round = Num.round;
prelude.ceiling = Num.ceiling;
prelude.floor = Num.floor;
prelude.isItNaN = Num.isItNaN;
prelude.even = Num.even;
prelude.odd = Num.odd;
prelude.gcd = Num.gcd;
prelude.lcm = Num.lcm;
prelude.VERSION = '1.1.2';
module.exports = prelude;
function curry$(f, bound){
  var context,
  _curry = function(args) {
    return f.length > 1 ? function(){
      var params = args ? args.concat() : [];
      context = bound ? context || this : this;
      return params.push.apply(params, arguments) <
          f.length && arguments.length ?
        _curry.call(context, params) : f.apply(context, params);
    } : f;
  };
  return _curry();
}
},{"./Func.js":1,"./List.js":2,"./Num.js":3,"./Obj.js":4,"./Str.js":5}],7:[function(require,module,exports){
(function (global){
(function(){
  var i$, ref$, len$, module;
  if (typeof global != 'undefined' && global) {
    import$(global, require('prelude-ls'));
  }
  angular.module("dsc", ["ngRoute", "ngResource", "LocalStorageModule", "angucomplete-alt", "ui.grid", "ui.grid.autoResize"]).filter('percentage', function($filter){
    return function(input, decimals){
      decimals == null && (decimals = 0);
      return $filter('number')(input * 100, decimals) + '%';
    };
  });
  require('./app/routes');
  require('./app/services/storage-service');
  require('./app/services/external-data-service');
  require('./app/services/data-export-service');
  require('./app/main-controller');
  (function(){
    require('./modules/armor-calc/main.js');require('./modules/guide/main.js');require('./modules/items/main.js');require('./modules/pc/main.js');require('./modules/weapon-finder/main.js');
  });
  for (i$ = 0, len$ = (ref$ = ['guide', 'items', 'pc', 'weapon-finder', 'armor-calc']).length; i$ < len$; ++i$) {
    module = ref$[i$];
    require("./modules/" + module + "/main.js");
  }
  function import$(obj, src){
    var own = {}.hasOwnProperty;
    for (var key in src) if (own.call(src, key)) obj[key] = src[key];
    return obj;
  }
}).call(this);

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./app/main-controller":8,"./app/routes":9,"./app/services/data-export-service":10,"./app/services/external-data-service":11,"./app/services/storage-service":12,"./modules/armor-calc/main.js":16,"./modules/guide/main.js":19,"./modules/items/main.js":25,"./modules/pc/main.js":30,"./modules/weapon-finder/main.js":37,"prelude-ls":6}],8:[function(require,module,exports){
(function(){
  var MainController;
  if (typeof angular != 'undefined' && angular !== null) {
    angular.module("dsc").controller("mainController", function($scope, $location){
      return new MainController($scope, $location);
    });
  }
  MainController = (function(){
    MainController.displayName = 'MainController';
    var prototype = MainController.prototype, constructor = MainController;
    function MainController($scope, $location){
      var this$ = this;
      this.$scope = $scope;
      this.$location = $location;
      $scope.$watch(function(){
        return this$.$location.path();
      }, function(it){
        $scope.thisLocation = it;
      });
      $scope.menu = [
        {
          path: "/guide",
          name: "Game info & checklist"
        }, {
          path: "/pc",
          name: "Stats & inventory"
        }, {
          path: "/armor-calc",
          name: "Armor finder"
        }, {
          path: "/weapon-finder",
          name: "Weapon finder"
        }, {
          path: "/items",
          name: "Item data"
        }
      ];
    }
    return MainController;
  }());
  if (typeof module != 'undefined' && module !== null) {
    module.exports = MainController;
  }
}).call(this);

},{}],9:[function(require,module,exports){
(function(){
  angular.module("dsc").config(function($routeProvider){
    $routeProvider.when('/guide/:section', {
      templateUrl: 'modules/guide/guide-view.html',
      controller: 'GuideController'
    }).when('/items', {
      templateUrl: 'modules/items/view.html',
      controller: 'ItemsController'
    }).when('/pc', {
      templateUrl: 'modules/pc/pc-view.html',
      controller: 'pcController'
    }).when('/weapon-finder', {
      templateUrl: 'modules/weapon-finder/weapon-finder-view.html',
      controller: 'weaponFinderController'
    }).when('/armor-calc', {
      templateUrl: 'modules/armor-calc/armor-calc-view.html',
      controller: 'ArmorCalcController'
    }).otherwise({
      redirectTo: '/guide/intro'
    });
  });
}).call(this);

},{}],10:[function(require,module,exports){
(function(){
  angular.module("dsc").service('dataExportSvc', function(){
    return {
      exportJson: function(data){
        window.open(encodeURI("data:application/json," + JSON.stringify(data)));
      },
      exportCsv: function(data){
        var firstLine, rows, i$, len$, item, row, key, value, output;
        firstLine = join(',')(
        keys(
        first(
        data)));
        rows = [];
        for (i$ = 0, len$ = data.length; i$ < len$; ++i$) {
          item = data[i$];
          row = [];
          for (key in item) {
            value = item[key];
            if (typeof value === "string") {
              value = value.replace('"', '""').replace(/(\r\n|\n|\r)/g, '\\n');
              value = "\"" + value + "\"";
            }
            row.push(value);
          }
          row = join(',')(
          row);
          rows.push(row);
        }
        output = firstLine + "\n" + join("\n")(
        rows);
        window.open(encodeURI("data:text/plain," + output));
      }
    };
  });
}).call(this);

},{}],11:[function(require,module,exports){
(function(){
  var ExternalDataService;
  if (typeof angular != 'undefined' && angular !== null) {
    angular.module("dsc").service("externalDataSvc", function($resource, $q){
      return new ExternalDataService($resource, $q);
    });
  }
  ExternalDataService = (function(){
    ExternalDataService.displayName = 'ExternalDataService';
    var prototype = ExternalDataService.prototype, constructor = ExternalDataService;
    function ExternalDataService($resource, $q){
      this.$resource = $resource;
      this.$q = $q;
      this.loadJson = bind$(this, 'loadJson', prototype);
      this._cache = {};
    }
    /**
     * Load an external JSON resource and parse it into an array
     */
    prototype.loadJson = function(url, returnPromise){
      var task, ref$, this$ = this;
      returnPromise == null && (returnPromise = true);
      if (url == null || typeof url !== "string" || url.length < 1) {
        throw new Error("Invalid URL: [" + url + "]");
      }
      task = this.$q.defer();
      if (empty(
      (ref$ = this._cache)[url] || (ref$[url] = []))) {
        this._cache[url] = this.$resource(url).query(function(){
          task.resolve(this$._cache[url]);
        });
      } else {
        task.resolve(this._cache[url]);
      }
      return returnPromise
        ? task.promise
        : this._cache[url];
    };
    return ExternalDataService;
  }());
  if (typeof module != 'undefined' && module !== null) {
    module.exports = ExternalDataService;
  }
  function bind$(obj, key, target){
    return function(){ return (target || obj)[key].apply(obj, arguments) };
  }
}).call(this);

},{}],12:[function(require,module,exports){
(function(){
  angular.module("dsc").config(function(localStorageServiceProvider){
    localStorageServiceProvider.setPrefix("DSC");
  }).service('storageSvc', [
    'localStorageService', function(localStorage){
      return {
        save: function(key, data){
          localStorage.set(key, data);
        },
        load: function(key){
          return localStorage.get(key);
        }
      };
    }
  ]);
}).call(this);

},{}],13:[function(require,module,exports){
(function(){
  angular.module("dsc").controller("ArmorCalcController", function($q, $scope, storageSvc, itemSvc, armorCalcSvc, statSvc, uiGridConstants){
    var ref$, x$;
    $scope.results = [];
    ({
      maxLoad: 0,
      availableLoad: 0
    });
    $scope.params = (ref$ = storageSvc.load('armor-calc-params')) != null
      ? ref$
      : {
        reservedWeight: 15,
        selectedWeightLimit: 0.50,
        includeUpgrades: true,
        modifiers: [2, 0, 0, 0, 0, 0, 0, 1],
        resultLimit: 10
      };
    $scope.weightLimits = [0.25, 0.50, 0.75, 1.00];
    $scope.modifiers = [
      {
        key: 'phy',
        title: "Physical"
      }, {
        key: 'mag',
        title: "Magic"
      }, {
        key: 'fir',
        title: "Fire"
      }, {
        key: 'lit',
        title: "Lightning"
      }, {
        key: 'blo',
        title: "Bleed"
      }, {
        key: 'tox',
        title: "Poison"
      }, {
        key: 'cur',
        title: "Curse"
      }, {
        key: 'poise',
        title: "Poise"
      }
    ];
    $scope.maxLoad = 40 + statSvc.statValueOf('endurance');
    $scope.typeNames = {
      0: 'head',
      1: 'chest',
      2: 'hands',
      3: 'legs'
    };
    $scope.partNames = ['head', 'chest', 'hands', 'legs'];
    x$ = $scope.gridOptions = require('./controller/gridOptions')(uiGridConstants);
    x$.data = $scope.results;
    $scope.calculate = function(type){
      var x$, i$, ref$, len$, index, mod, ref1$;
      type == null && (type = 'offence');
      armorCalcSvc.freeWeight = $scope.availableLoad;
      x$ = armorCalcSvc.params = {};
      x$.freeWeight = $scope.availableLoad;
      x$.includeUpgrades = $scope.params.includeUpgrades;
      for (i$ = 0, len$ = (ref$ = $scope.modifiers).length; i$ < len$; ++i$) {
        index = i$;
        mod = ref$[i$];
        ((ref1$ = armorCalcSvc.params).modifiers || (ref1$.modifiers = {}))[mod.key] = $scope.params.modifiers[index];
      }
      armorCalcSvc.findBestCombinations().then(function(results){
        var i$, len$, result;
        $scope.results = [];
        for (i$ = 0, len$ = results.length; i$ < len$; ++i$) {
          result = results[i$];
          $scope.results.push({
            score: result.score,
            weight: result.weight,
            armors: join(', ')(
            map(fn$)(
            result.armors)),
            detailScores: result.detailScores
          });
        }
        $scope.gridOptions.data = take($scope.params.resultLimit)(
        reverse(
        sortBy(function(it){
          return it.score;
        })(
        $scope.results)));
        function fn$(it){
          return it.name;
        }
      });
    };
    $scope.$watch("params", function(){
      $scope.availableLoad = $scope.maxLoad * $scope.params.selectedWeightLimit - $scope.params.reservedWeight;
      storageSvc.save("armor-calc-params", $scope.params);
    }, true);
  });
}).call(this);

},{"./controller/gridOptions":15}],14:[function(require,module,exports){
(function(){
  var ArmorCalcSvc;
  if (typeof angular != 'undefined' && angular !== null) {
    angular.module("dsc").service("armorCalcSvc", function(inventorySvc, itemSvc, $q){
      return (function(func, args, ctor) {
        ctor.prototype = func.prototype;
        var child = new ctor, result = func.apply(child, args), t;
        return (t = typeof result)  == "object" || t == "function" ? result || child : child;
  })(ArmorCalcSvc, arguments, function(){});
    });
  }
  ArmorCalcSvc = (function(){
    ArmorCalcSvc.displayName = 'ArmorCalcSvc';
    var prototype = ArmorCalcSvc.prototype, constructor = ArmorCalcSvc;
    function ArmorCalcSvc(_inventorySvc, _itemSvc, $q){
      this._inventorySvc = _inventorySvc;
      this._itemSvc = _itemSvc;
      this.$q = $q;
      this.calculateScoreFor = bind$(this, 'calculateScoreFor', prototype);
      this.findAllCombinationsOf = bind$(this, 'findAllCombinationsOf', prototype);
      this.findUsableArmors = bind$(this, 'findUsableArmors', prototype);
      this.takeOnlyAffordable = bind$(this, 'takeOnlyAffordable', prototype);
      this.findBestCombinations = bind$(this, 'findBestCombinations', prototype);
      this.freeWeight = 0;
      this.params = {};
      this.armorTypes = ['head', 'chest', 'hands', 'legs'];
      this.armorTypeKeys = {
        'head': 0,
        'chest': 1,
        'hands': 2,
        'legs': 3
      };
    }
    prototype.findBestCombinations = function(){
      var staticArmors, dynamicArmors, canAfford, this$ = this;
      if ((this.params || (this.params = {})).includeUpgrades == null) {
        this.params.includeUpgrades = true;
      }
      staticArmors = [];
      dynamicArmors = [];
      canAfford = [];
      return this.findUsableArmors().then(function(armors){
        staticArmors = filter(function(it){
          return it.matSetId < 0;
        })(
        armors);
        dynamicArmors = reject(function(it){
          return it.upgradeId < 0;
        })(
        armors);
        return this$.findAllCombinationsOf(dynamicArmors);
      }).then(function(combinations){
        var i$, len$, comb, best, j$, ref$, len1$, armor;
        for (i$ = 0, len$ = combinations.length; i$ < len$; ++i$) {
          comb = combinations[i$];
          comb.score = this$.calculateScoreFor(comb);
        }
        best = take(this$.params.includeUpgrades ? 10 : 100)(
        reverse(
        sortBy(function(it){
          return it.score;
        })(
        combinations)));
        dynamicArmors = [];
        for (i$ = 0, len$ = best.length; i$ < len$; ++i$) {
          comb = best[i$];
          for (j$ = 0, len1$ = (ref$ = comb.armors).length; j$ < len1$; ++j$) {
            armor = ref$[j$];
            dynamicArmors.push(armor);
          }
        }
        dynamicArmors = unique(
        dynamicArmors);
      }).then(function(){
        var promises, i$, ref$, len$, armor;
        if (!this$.params.includeUpgrades) {
          return dynamicArmors;
        }
        promises = [];
        for (i$ = 0, len$ = (ref$ = dynamicArmors).length; i$ < len$; ++i$) {
          armor = ref$[i$];
          promises.push(this$._itemSvc.upgradeComp.findAllAvailableUpgradesFor(armor).then(fn$));
        }
        return this$.$q.all(promises);
        function fn$(upgrades){
          return dynamicArmors = dynamicArmors.concat(upgrades);
        }
      }).then(function(){
        this$._debugLog = false;
        return this$.findAllCombinationsOf(dynamicArmors);
      }).then(function(combinations){
        return this$.takeOnlyAffordable(combinations);
      }).then(function(combs){
        var sets, best, i$, len$, set, bestArmors;
        sets = Obj.values(
        groupBy(function(it){
          return it.pieces;
        })(
        combs));
        best = [];
        for (i$ = 0, len$ = sets.length; i$ < len$; ++i$) {
          set = sets[i$];
          best.push(first(
          reverse(
          sortBy(fn$)(
          set))));
        }
        bestArmors = [];
        for (i$ = 0, len$ = best.length; i$ < len$; ++i$) {
          set = best[i$];
          bestArmors = bestArmors.concat(set.armors);
        }
        bestArmors = unique(
        bestArmors).concat(staticArmors);
        return this$.findAllCombinationsOf(bestArmors);
        function fn$(it){
          return it.upgradeLevel;
        }
      }).then(function(combs){
        return this$.takeOnlyAffordable(combs);
      }).then(function(combs){
        return each(this$.calculateScoreFor)(
        combs);
      });
    };
    /**
     * Given a list of combinations, only take those that the user can afford.
     */
    prototype.takeOnlyAffordable = function(combinations){
      var canAfford, i$, len$, comb, promises, j$, ref$, len1$, armor, k$, ref1$, len2$, aCost, cCost, this$ = this;
      canAfford = [];
      for (i$ = 0, len$ = combinations.length; i$ < len$; ++i$) {
        comb = combinations[i$];
        comb.totalCost = [];
        promises = [];
        for (j$ = 0, len1$ = (ref$ = filter(fn$)(
        comb.armors)).length; j$ < len1$; ++j$) {
          armor = ref$[j$];
          for (k$ = 0, len2$ = (ref1$ = armor.totalCost).length; k$ < len2$; ++k$) {
            aCost = ref1$[k$];
            cCost = find(fn1$)(
            comb.totalCost);
            if (cCost == null) {
              cCost = {
                matId: aCost.matId,
                matCost: 0
              };
              comb.totalCost.push(cCost);
            }
            cCost.matCost += aCost.matCost;
          }
        }
        promises.push(fn2$(comb));
      }
      return this.$q.all(promises).then(function(){
        return canAfford;
      });
      function fn$(it){
        return it.totalCost != null;
      }
      function fn1$(it){
        return it.matId === aCost.matId;
      }
      function fn2$(comb){
        return this$._inventorySvc.load().then(function(inventory){
          var materials, can, i$, ref$, len$, cost, material;
          materials = filter(function(it){
            return it.itemType === 'item';
          })(
          inventory);
          can = true;
          for (i$ = 0, len$ = (ref$ = comb.totalCost).length; i$ < len$; ++i$) {
            cost = ref$[i$];
            material = find(fn$)(
            materials);
            if (!(material != null && material.amount >= cost.matCost)) {
              can = false;
            }
          }
          if (can) {
            canAfford.push(comb);
            return comb;
          } else {
            return null;
          }
          function fn$(it){
            return it.id === cost.matId;
          }
        });
      }
    };
    /**
     * Find armors fit for using in calculations.
     */
    prototype.findUsableArmors = function(){
      var this$ = this;
      return this._inventorySvc.load().then(function(inventory){
        return this$.$q.all(map(function(entry){
          return this$._itemSvc.findAnyItemByUid(entry.uid);
        })(
        filter(function(it){
          return it.itemType === 'armor';
        })(
        inventory)));
      }).then(function(armors){
        return filter(function(it){
          return it.weight <= this$.freeWeight;
        })(
        armors);
      });
    };
    /**
     * Take a list of armors and generate every possible combination of them
     * within the current weight limit.
     * @returns Promise that will be resolved with an array of combinations.
     */
    prototype.findAllCombinationsOf = function(armors){
      var def, combinations, empties, i$, ref$, len$, index, type, empty, groupOf, lengths, combCount, prod, splitAt, b, combinationIndex, indexes, a, combination, log, ciKey, seq, key, piece, x$, split, jumpTo, comb, this$ = this;
      def = this.$q.defer();
      combinations = [];
      empties = [];
      for (i$ = 0, len$ = (ref$ = this.armorTypes).length; i$ < len$; ++i$) {
        index = i$;
        type = ref$[i$];
        empty = find(fn$)(
        armors);
        if (empty == null) {
          empty = this._itemSvc.createItemModelFrom({
            itemType: 'armor',
            name: "(bare " + type + ")",
            armorType: type,
            weight: 0,
            upgradeId: -1,
            id: -(index + 1)
          });
          armors.push(empty);
        }
        empties.push(empty);
      }
      groupOf = groupBy(function(it){
        return it.armorType;
      })(
      armors);
      lengths = map(function(it){
        return (it != null ? it.length : void 8) || 0;
      })(
      [groupOf['head'], groupOf['chest'], groupOf['hands'], groupOf['legs']]);
      combCount = product(
      lengths);
      prod = 1;
      splitAt = [0, 0, 0, 0];
      for (i$ = 0, len$ = (ref$ = [1, 3, 0, 2]).length; i$ < len$; ++i$) {
        b = ref$[i$];
        prod *= lengths[b];
        splitAt[b] = combCount / prod;
      }
      combinationIndex = {};
      indexes = [0, 0, 0, 0];
      a = 0;
      while (++a <= combCount) {
        combination = {
          armors: [null, null, null, null],
          weight: 0
        };
        log = [];
        log.push(a + " : " + join(',')(
        indexes));
        ciKey = "";
        for (i$ = 0, len$ = (ref$ = seq = [1, 3, 0, 2]).length; i$ < len$; ++i$) {
          key = i$;
          b = ref$[i$];
          if (combination.weight < this.freeWeight) {
            piece = groupOf[this.armorTypes[b]][indexes[b]];
            log.push(combination.weight + " < " + this.freeWeight + " => +" + indexes[b] + " (" + piece.name + ")");
            x$ = combination;
            x$.armors[b] = piece;
            x$.weight += piece.weight;
            ciKey += (piece.id > 0
              ? indexes[b]
              : piece.id) + ",";
          } else {
            if (combination.weight === this.freeWeight) {
              log.push(combination.weight + " == " + this.freeWeight + " => +" + empties[b].name);
              combination.armors[b] = empties[b];
              ciKey += empties[b].id + ",";
              if (key > 0) {
                split = splitAt[seq[key - 1]];
                jumpTo = a + (split - a % split);
                if (jumpTo !== a) {
                  log.push("Jumping to " + a + " + (" + split + " - " + a + " % " + split + ") = " + jumpTo);
                  a = jumpTo;
                }
              }
            }
          }
        }
        if (combination.weight <= this.freeWeight) {
          if (combinationIndex[ciKey] != null) {
            log.push("Combination [" + ciKey + "] already added, skipping");
          } else {
            log.push("Adding combination [" + ciKey + "] to list");
            combinationIndex[ciKey] = true;
            combinations.push(combination);
          }
          if (this._debugLog) {
            console.log(join("\n")(
            log));
          }
        }
        for (i$ = 0, len$ = (ref$ = [1, 3, 0, 2]).length; i$ < len$; ++i$) {
          b = ref$[i$];
          if (a % splitAt[b] === 0) {
            indexes[b] = (indexes[b] + 1) % lengths[b];
            break;
          }
        }
      }
      for (i$ = 0, len$ = combinations.length; i$ < len$; ++i$) {
        comb = combinations[i$];
        comb.names = map(fn1$)(
        comb.armors);
        comb.pieces = join(',')(
        map(fn2$)(
        comb.armors));
        comb.upgradeLevel = sum(
        map(fn3$)(
        comb.armors));
      }
      def.resolve(combinations);
      return def.promise;
      function fn$(it){
        return it.armorType === type && it.weight === 0;
      }
      function fn1$(it){
        return it != null ? it.name : void 8;
      }
      function fn2$(it){
        return this$._itemSvc.upgradeComp.getBaseIdFrom(it.id);
      }
      function fn3$(it){
        var ref$;
        return (ref$ = it.upgradeLevel) != null ? ref$ : 0;
      }
    };
    prototype.calculateScoreFor = function(combination){
      var ref$, i$, len$, armor, j$, ref1$, len1$, mod, modifier, ref2$, baseValue, score;
      combination.score = 0;
      combination.detailScores = {};
      (ref$ = this.params).modifiers == null && (ref$.modifiers = {
        phy: 2,
        poise: 1
      });
      for (i$ = 0, len$ = (ref$ = combination.armors).length; i$ < len$; ++i$) {
        armor = ref$[i$];
        armor.score = 0;
        for (j$ = 0, len1$ = (ref1$ = ['Phy', 'Mag', 'Fir', 'Lit', 'Blo', 'Tox', 'Cur', 'Poise']).length; j$ < len1$; ++j$) {
          mod = ref1$[j$];
          modifier = (ref2$ = this.params.modifiers[mod.toLowerCase()]) != null ? ref2$ : 0;
          baseValue = (ref2$ = armor["def" + mod]) != null ? ref2$ : 0;
          score = baseValue * modifier;
          armor.score += score;
          combination.detailScores[mod.toLowerCase()] = baseValue + ((ref2$ = combination.detailScores[mod.toLowerCase()]) != null ? ref2$ : 0);
        }
        combination.score += armor.score;
      }
      return combination.score;
    };
    return ArmorCalcSvc;
  }());
  if (typeof module != 'undefined' && module !== null) {
    module.exports = ArmorCalcSvc;
  }
  function bind$(obj, key, target){
    return function(){ return (target || obj)[key].apply(obj, arguments) };
  }
}).call(this);

},{}],15:[function(require,module,exports){
(function(){
  if (typeof module != 'undefined' && module !== null) {
    module.exports = function(uiGridConstants){
      var percentFieldMinWidth;
      percentFieldMinWidth = 45;
      return {
        columnDefs: [
          {
            field: 'score',
            width: 75,
            cellFilter: 'number:2',
            sort: {
              direction: uiGridConstants.DESC,
              priority: 0
            },
            type: 'number'
          }, {
            field: 'weight',
            width: 50,
            cellFilter: 'number:2',
            type: 'number',
            sort: {
              direction: uiGridConstants.ASC,
              priority: 1
            }
          }, {
            field: 'armors',
            minWidth: 700
          }, {
            field: 'detailScores.phy',
            minWidth: 50,
            cellFilter: 'number:2',
            type: 'number',
            displayName: 'Phys.'
          }, {
            field: 'detailScores.mag',
            minWidth: 50,
            cellFilter: 'number:2',
            type: 'number',
            displayName: 'Magic'
          }, {
            field: 'detailScores.fir',
            minWidth: 50,
            cellFilter: 'number:2',
            type: 'number',
            displayName: 'Fire'
          }, {
            field: 'detailScores.lit',
            minWidth: 50,
            cellFilter: 'number:2',
            type: 'number',
            displayName: 'Light.'
          }, {
            field: 'detailScores.blo',
            minWidth: 50,
            cellFilter: 'number:2',
            type: 'number',
            displayName: 'Bleed'
          }, {
            field: 'detailScores.tox',
            minWidth: 50,
            cellFilter: 'number:2',
            type: 'number',
            displayName: 'Tox.'
          }, {
            field: 'detailScores.cur',
            minWidth: 50,
            cellFilter: 'number:2',
            type: 'number',
            displayName: 'Curse'
          }, {
            field: 'detailScores.poise',
            minWidth: 50,
            cellFilter: 'number:2',
            type: 'number',
            displayName: 'Poise'
          }
        ]
      };
    };
  }
}).call(this);

},{}],16:[function(require,module,exports){
(function(){
  angular.module("dsc");
  require('./armor-calc-service');
  require('./armor-calc-controller');
}).call(this);

},{"./armor-calc-controller":13,"./armor-calc-service":14}],17:[function(require,module,exports){
(function(){
  angular.module("dsc").controller("GuideController", function($sce, $scope, $routeParams, $resource, guideService, storageSvc){
    var _getArrowFor, _prepareGuideContent, _saveUserData, _loadUserData, data;
    $scope.sections = [
      {
        id: 'intro',
        name: "Intro"
      }, {
        id: 'asylum',
        name: "Northern Undead Asylum"
      }, {
        id: 'firelink',
        name: "Firelink Shrine"
      }, {
        id: 'burg',
        name: "Undead Burg"
      }, {
        id: 'parish',
        name: "Undead Parish"
      }, {
        id: 'low',
        name: "Lower Undead Burg"
      }, {
        id: 'depths',
        name: "The Depths"
      }, {
        id: 'blight',
        name: "Blighttown"
      }, {
        id: 'quelaag',
        name: "Quelaag's Domain"
      }
    ];
    $scope.section = $routeParams['section'];
    $scope.userData = null;
    $scope.entryIndex = {};
    _getArrowFor = function(entry){
      if (!(entry.meta || (entry.meta = {})).isExpandable) {
        return '';
      }
      return (entry.meta || (entry.meta = {})).isCollapsed ? '[..]' : '';
    };
    _prepareGuideContent = function(entry){
      var userMeta, ref$, ref1$, x$, i$, len$, check, child;
      if (entry.id != null) {
        $scope.entryIndex[entry.id] = entry;
      }
      if (entry.content != null) {
        entry.content = $sce.trustAsHtml(entry.content);
      }
      userMeta = (ref$ = ((ref1$ = $scope.userData || ($scope.userData = {})).entryMeta || (ref1$.entryMeta = {}))[entry.id]) != null
        ? ref$
        : {};
      x$ = entry.meta || (entry.meta = {});
      x$.isCollapsed = (ref$ = userMeta.isCollapsed) != null
        ? ref$
        : entry.content != null;
      x$.isDone = (ref$ = userMeta.isDone) != null ? ref$ : false;
      x$.isExpandable = entry.children != null || entry.content != null;
      x$.arrow = _getArrowFor(entry);
      for (i$ = 0, len$ = (ref$ = ['content', 'children']).length; i$ < len$; ++i$) {
        check = ref$[i$];
        ((ref1$ = entry.meta || (entry.meta = {})).additionalClasses || (ref1$.additionalClasses = [])).push(entry[check] != null
          ? "with-" + check
          : "without-" + check);
      }
      if (entry.children != null) {
        for (i$ = 0, len$ = (ref$ = entry.children).length; i$ < len$; ++i$) {
          child = ref$[i$];
          _prepareGuideContent(child);
        }
      }
    };
    _saveUserData = function(){
      var id, ref$, entry, i$, ref1$, len$, field, ref2$, ref3$;
      for (id in ref$ = $scope.entryIndex) {
        entry = ref$[id];
        for (i$ = 0, len$ = (ref1$ = ['isCollapsed', 'isDone']).length; i$ < len$; ++i$) {
          field = ref1$[i$];
          ((ref2$ = (ref3$ = $scope.userData || ($scope.userData = {})).entryMeta || (ref3$.entryMeta = {}))[id] || (ref2$[id] = {}))[field] = entry.meta[field];
        }
      }
      storageSvc.save('guide:userData', $scope.userData);
    };
    _loadUserData = function(){
      var ref$;
      $scope.userData = (ref$ = storageSvc.load('guide:userData')) != null
        ? ref$
        : {};
    };
    _loadUserData();
    data = guideService.getContentFor($scope.section);
    $scope.entry = {
      children: data
    };
    data.$promise.then(function(){
      _prepareGuideContent($scope.entry);
    });
    $scope.canAddToInventory = function(entry){
      var can;
      can = any((function(it){
        return it === 'item';
      }))(
      entry.labels || (entry.labels = []));
      can = can && !any((function(it){
        return it === 'abstract';
      }))(
      entry.flags || (entry.flags = []));
      return can;
    };
    $scope.entryClicked = function($event, entry){
      var x$;
      $event.stopPropagation();
      if (!(entry.meta || (entry.meta = {})).isExpandable) {
        return;
      }
      x$ = entry.meta || (entry.meta = {});
      x$.isCollapsed = !(entry.meta || (entry.meta = {})).isCollapsed;
      x$.arrow = _getArrowFor(entry);
      _saveUserData();
    };
    $scope.entryDone = function(entry){
      entry.meta.isDone = true;
      _saveUserData();
    };
  });
}).call(this);

},{}],18:[function(require,module,exports){
(function(){
  angular.module("dsc").service("guideService", function($resource){
    var svc;
    svc = {};
    svc.getContentFor = function(section){
      return $resource("/modules/guide/content/" + section + ".json").query();
    };
    return svc;
  });
}).call(this);

},{}],19:[function(require,module,exports){
(function(){
  require('./guide-controller');
  require('./guide-service');
}).call(this);

},{"./guide-controller":17,"./guide-service":18}],20:[function(require,module,exports){
(function(){
  var ItemServiceUpgradeComponent;
  ItemServiceUpgradeComponent = (function(){
    ItemServiceUpgradeComponent.displayName = 'ItemServiceUpgradeComponent';
    var prototype = ItemServiceUpgradeComponent.prototype, constructor = ItemServiceUpgradeComponent;
    function ItemServiceUpgradeComponent(_itemSvc, _externalDataSvc, _itemIndexSvc, _inventorySvc, $q){
      this._itemSvc = _itemSvc;
      this._externalDataSvc = _externalDataSvc;
      this._itemIndexSvc = _itemIndexSvc;
      this._inventorySvc = _inventorySvc;
      this.$q = $q;
      this.findAllAvailableUpgradesFor = bind$(this, 'findAllAvailableUpgradesFor', prototype);
      this.apply = bind$(this, 'apply', prototype);
      this.canBeUpgradedFurther = bind$(this, 'canBeUpgradedFurther', prototype);
      this.canBeUpgraded = bind$(this, 'canBeUpgraded', prototype);
      this.isUpgraded = bind$(this, 'isUpgraded', prototype);
      this.upgradeLevelOf = bind$(this, 'upgradeLevelOf', prototype);
      this.ensureItCanBeUpgraded = bind$(this, 'ensureItCanBeUpgraded', prototype);
      this.loadAllUpgrades = bind$(this, 'loadAllUpgrades', prototype);
      this.loadAllMaterialSets = bind$(this, 'loadAllMaterialSets', prototype);
      this.deductFrom = bind$(this, 'deductFrom', prototype);
      this.are = bind$(this, 'are', prototype);
      this.findUpgradeMaterialsFor = bind$(this, 'findUpgradeMaterialsFor', prototype);
      this.findUpgradeFor = bind$(this, 'findUpgradeFor', prototype);
      this.findBaseItem = bind$(this, 'findBaseItem', prototype);
      this.getBaseItemIdOf = bind$(this, 'getBaseItemIdOf', prototype);
      this.getUpgradeLevelFrom = bind$(this, 'getUpgradeLevelFrom', prototype);
      this.getBaseIdFrom = bind$(this, 'getBaseIdFrom', prototype);
      this._upgrades = {};
      this._materialSets = [];
    }
    prototype.getBaseIdFrom = function(id){
      return id - this.getUpgradeLevelFrom(id);
    };
    prototype.getUpgradeLevelFrom = function(id){
      return id % 100;
    };
    prototype.getBaseItemIdOf = function(item){
      return this.getBaseIdFrom(item.id);
    };
    prototype.findBaseItem = function(item){
      var this$ = this;
      return this._itemSvc.findItem(item.itemType, function(it){
        return it.id === this$.getBaseIdFrom(item.id);
      });
    };
    /**
     * Get the upgrade model for a given weapon at a given upgrade level
     * @returns Promise, resolved with the upgrade (or null if nothing found)
     */
    prototype.findUpgradeFor = function(item, level){
      var this$ = this;
      return this.loadAllUpgrades(item.itemType).then(function(upgrades){
        return find(function(it){
          return it.id === this$.getBaseIdFrom(item.upgradeId) + level;
        })(
        upgrades);
      });
    };
    /**
     * Find the materials required to upgrade a given item using a given upgrade model.
     * @returns Promise that is resolved with the material data.
     */
    prototype.findUpgradeMaterialsFor = function(item, upgrade){
      var x$, this$ = this;
      if (!(item != null && upgrade != null)) {
        throw new Error("Can't find upgrade materials, either item or upgrade is unset.");
      }
      if (item.matSetId < 0) {
        x$ = this.$q.defer();
        x$.resolve(null);
        return x$.promise;
      }
      return this.loadAllMaterialSets().then(function(){
        return find(function(it){
          return it.id === this$.getBaseIdFrom(item.matSetId) + upgrade.matSetId;
        })(
        this$._materialSets);
      });
    };
    prototype.are = function(materials){
      var this$ = this;
      return {
        enoughToUpgrade: function(item, level){
          return this$.findUpgradeFor(item, level).then(function(upgrade){
            if (upgrade == null) {
              return false;
            }
            return this$.findUpgradeMaterialsFor(item, upgrade);
          }).then(function(materialSet){
            if (materialSet === false) {
              return null;
            }
            return any(function(it){
              return it.id === materialSet.matId && it.amount >= materialSet.matCost;
            })(
            materials);
          });
        }
      };
    };
    prototype.deductFrom = function(materials){
      var this$ = this;
      return {
        costOfUpgrade: function(item, level){
          return this$.findUpgradeFor(item, level).then(function(upgrade){
            return this$.findUpgradeMaterialsFor(item, upgrade);
          }).then(function(materialSet){
            find(function(it){
              return it.id === materialSet.matId;
            })(
            materials).amount -= materialSet.matCost;
            return {
              matCost: materialSet.matCost,
              matId: materialSet.matId
            };
          });
        }
      };
    };
    /**
     * Asynchronously loads all information on material sets required for upgrades
     * @returns Promise that will be resolved with the material set data.
     */
    prototype.loadAllMaterialSets = function(){
      if (this._materialSets.$promise == null) {
        this._materialSets = this._externalDataSvc.loadJson("/modules/items/content/material-sets.json", false);
      }
      return this._materialSets.$promise;
    };
    /**
     * Load information on all upgrades for a given item type
     * @returns Promise resolved with the upgrade data
     */
    prototype.loadAllUpgrades = function(itemType){
      var ref$;
      this.ensureItCanBeUpgraded(
      itemType);
      if (((ref$ = this._upgrades)[itemType] || (ref$[itemType] = [])).$promise == null) {
        this._upgrades[itemType] = this._externalDataSvc.loadJson("/modules/items/content/" + itemType + "-upgrades.json", false);
      }
      return this._upgrades[itemType].$promise;
    };
    prototype.ensureItCanBeUpgraded = function(item){
      if (item == null) {
        throw new Error("Item / item type not provided.");
      }
      if (typeof item === 'string') {
        item = {
          itemType: item
        };
      }
      if (!this.canBeUpgraded(
      item)) {
        throw new Error("Only weapons and armors can be upgraded, this is a [" + item.itemType + "].");
      }
    };
    prototype.upgradeLevelOf = function(item){
      return item.id % 100;
    };
    prototype.isUpgraded = function(item){
      return this.upgradeLevelOf(item) > 0;
    };
    prototype.canBeUpgraded = function(item){
      return item.itemType === 'weapon' || item.itemType === 'armor';
    };
    prototype.canBeUpgradedFurther = function(item){
      var this$ = this;
      if (!this.canBeUpgraded(item)) {
        return false;
      }
      return this.findUpgradeFor(item, this.upgradeLevelOf(item)).then(function(upgrade){
        return upgrade != null;
      });
    };
    prototype.apply = function(upgrade){
      var this$ = this;
      if (upgrade == null) {
        throw new Error("No upgrade data provided.");
      }
      return {
        to: function(item){
          var x$, i$, ref$, len$, field;
          this$.ensureItCanBeUpgraded(
          item);
          x$ = item;
          x$.id += upgrade['id'] % 100;
          x$.upgradeId = upgrade['id'];
          x$.matSetId += upgrade['matSetId'];
          for (i$ = 0, len$ = (ref$ = ['defModPhy', 'defModMag', 'defModFir', 'defModLit', 'defModTox', 'defModBlo', 'defModCur']).length; i$ < len$; ++i$) {
            field = ref$[i$];
            item[field.replace('Mod', '')] *= upgrade[field];
          }
          switch (item['itemType']) {
          case 'weapon':
            for (i$ = 0, len$ = (ref$ = ['atkModPhy', 'atkModMag', 'atkModFir', 'atkModLit', 'bonusModStr', 'bonusModDex', 'bonusModInt', 'bonusModFai']).length; i$ < len$; ++i$) {
              field = ref$[i$];
              item[field.replace('Mod', '')] *= upgrade[field];
            }
            break;
          case 'armor':
            for (i$ = 0, len$ = (ref$ = ['defModStrike', 'defModSlash', 'defModThrust']).length; i$ < len$; ++i$) {
              field = ref$[i$];
              item[field.replace('Mod', '')] *= upgrade[field];
            }
          }
          return item;
        }
      };
    };
    /**
     * Find all upgrades that can be applied to a given item,
     * within the limits of what is available to the user
     */
    prototype.findAllAvailableUpgradesFor = function(item){
      var ref$, x$, upgradeList, this$ = this;
      if ((ref$ = !item.itemType) === 'armor' || ref$ === 'weapon') {
        throw new Error("Only weapons and armor can be upgraded, this is [" + item.itemType + "]");
      }
      if (item.id < 0 || item.upgradeId < 0) {
        x$ = this.$q.defer();
        x$.resolve([]);
        return x$.promise;
      }
      upgradeList = [];
      return this._inventorySvc.load().then(function(inventory){
        var materials, promise, i$, level;
        materials = map(function(it){
          return import$({}, it);
        })(
        filter(function(it){
          return it.itemType === 'item';
        })(
        inventory));
        promise = this$.$q(function(resolve, reject){
          resolve();
        });
        for (i$ = this$.getUpgradeLevelFrom(item.id) + 1; i$ <= 10; ++i$) {
          level = i$;
          fn$(materials, level);
        }
        return promise;
        function fn$(materials, level){
          promise = promise.then(function(){
            return this$.are(materials).enoughToUpgrade(item, level);
          }).then(function(canUpgrade){
            if (canUpgrade) {
              return this$.$q.all([this$._itemSvc.getUpgraded(item, level), this$.deductFrom(materials).costOfUpgrade(item, level)]);
            } else {
              materials.length = 0;
              return null;
            }
          }).then(function(result){
            var upItem, cost, totalCost, costEntry, x$;
            upItem = result != null ? result[0] : void 8;
            cost = result != null ? result[1] : void 8;
            if (upItem != null) {
              totalCost = materials.totalCost || (materials.totalCost = []);
              costEntry = find(function(it){
                return it.matId === cost.matId;
              })(
              totalCost);
              if (costEntry == null) {
                costEntry = {
                  matId: cost.matId,
                  matCost: 0
                };
                totalCost.push(costEntry);
              }
              costEntry.matCost += cost.matCost;
              x$ = upItem;
              x$.totalCost = map(function(it){
                return import$({}, it);
              })(
              totalCost);
              x$.upgradeLevel = level - this$.getUpgradeLevelFrom(item.id);
              upgradeList.push(upItem);
            }
          });
        }
      }).then(function(){
        return upgradeList;
      });
    };
    return ItemServiceUpgradeComponent;
  }());
  if (typeof module != 'undefined' && module !== null) {
    module.exports = ItemServiceUpgradeComponent;
  }
  function bind$(obj, key, target){
    return function(){ return (target || obj)[key].apply(obj, arguments) };
  }
  function import$(obj, src){
    var own = {}.hasOwnProperty;
    for (var key in src) if (own.call(src, key)) obj[key] = src[key];
    return obj;
  }
}).call(this);

},{}],21:[function(require,module,exports){
(function(){
  if (typeof module != 'undefined' && module !== null) {
    module.exports = function($scope, uiGridConstants){
      var percentFieldMinWidth, i$, ref$, len$, itemType;
      $scope.gridOptions = {
        enableFiltering: true
      };
      percentFieldMinWidth = 45;
      $scope.columnConfigs = {
        'weapon': [
          {
            field: 'weaponType',
            displayName: 'Type',
            minWidth: 70,
            sort: {
              direction: uiGridConstants.ASC,
              priority: 0
            }
          }, {
            field: 'name',
            minWidth: 210,
            sort: {
              direction: uiGridConstants.ASC,
              priority: 1
            }
          }, {
            field: 'reqStr',
            displayName: 'RS',
            type: 'number'
          }, {
            field: 'reqDex',
            displayName: 'RD'
          }, {
            field: 'reqInt',
            displayName: 'RI'
          }, {
            field: 'reqFai',
            displayName: 'RF'
          }, {
            field: 'atkPhy',
            displayName: 'AP'
          }, {
            field: 'atkMag',
            displayName: 'AM'
          }, {
            field: 'atkFir',
            displayName: 'AF'
          }, {
            field: 'atkLit',
            displayName: 'AL'
          }, {
            field: 'bonusStr',
            displayName: 'SS',
            minWidth: percentFieldMinWidth,
            cellFilter: 'percentage'
          }, {
            field: 'bonusDex',
            displayName: 'SD',
            minWidth: percentFieldMinWidth,
            cellFilter: 'percentage'
          }, {
            field: 'bonusInt',
            displayName: 'SI',
            minWidth: percentFieldMinWidth,
            cellFilter: 'percentage'
          }, {
            field: 'bonusFai',
            displayName: 'SF',
            minWidth: percentFieldMinWidth,
            cellFilter: 'percentage'
          }, {
            field: 'defPhy',
            displayName: 'DP'
          }, {
            field: 'defMag',
            displayName: 'DM'
          }, {
            field: 'defFir',
            displayName: 'DF'
          }, {
            field: 'defLit',
            displayName: 'DL'
          }, {
            field: 'defTox',
            displayName: 'DT'
          }, {
            field: 'defBlo',
            displayName: 'DB'
          }, {
            field: 'defCur',
            displayName: 'DC'
          }, {
            field: 'defSta',
            displayName: 'St'
          }, {
            field: 'divine',
            minWidth: percentFieldMinWidth,
            displayName: 'Div',
            cellFilter: 'percentage'
          }, {
            field: 'occult',
            minWidth: percentFieldMinWidth,
            displayName: 'Occ',
            cellFilter: 'percentage'
          }, {
            field: 'weight',
            displayName: 'Wt',
            cellFilter: "number:2",
            type: 'number'
          }, {
            field: 'atkStaCost',
            displayNamo: 'Sta',
            cellFilter: "number:2",
            type: 'number'
          }, {
            field: 'dpsPhy',
            displayNamo: 'dpsP',
            cellFilter: "number:2",
            type: 'number'
          }, {
            field: 'dpsMag',
            displayNamo: 'dpsM',
            cellFilter: "number:2",
            type: 'number'
          }, {
            field: 'dpsFir',
            displayNamo: 'dpsF',
            cellFilter: "number:2",
            type: 'number'
          }, {
            field: 'dpsLit',
            displayNamo: 'dpsL',
            cellFilter: "number:2",
            type: 'number'
          }
        ],
        'armor': [
          {
            name: 'armorSet',
            displayName: 'Set',
            minWidth: 150,
            sort: {
              direction: uiGridConstants.ASC,
              priority: 0
            }
          }, {
            name: 'armorType',
            displayName: 'Type',
            sort: {
              direction: uiGridConstants.ASC,
              priority: 1
            },
            sortingAlgorithm: function(a, b){
              var values;
              values = {
                'head': 1,
                'chest': 2,
                'hands': 3,
                'legs': 4
              };
              return values[a] > values[b]
                ? 1
                : values[a] < values[b] ? -1 : 0;
            }
          }, {
            field: 'name',
            minWidth: 250
          }, {
            name: 'defN',
            type: 'number',
            displayName: 'DN'
          }, {
            name: 'defSl',
            type: 'number',
            displayName: 'DSl'
          }, {
            name: 'defSt',
            type: 'number',
            displayName: 'DSt'
          }, {
            name: 'defTh',
            type: 'number',
            displayName: 'DTh'
          }, {
            name: 'defM',
            type: 'number',
            displayName: 'DM'
          }, {
            name: 'defF',
            type: 'number',
            displayName: 'DF'
          }, {
            name: 'defL',
            type: 'number',
            displayName: 'DL'
          }, {
            name: 'defP',
            type: 'number',
            displayName: 'DP'
          }, {
            name: 'defT',
            type: 'number',
            displayName: 'RP'
          }, {
            name: 'defB',
            type: 'number',
            displayName: 'RB'
          }, {
            name: 'defC',
            type: 'number',
            displayName: 'RC'
          }, {
            name: 'stRec',
            type: 'number',
            displayName: 'Sr'
          }, {
            name: 'weight',
            type: 'number',
            displayName: 'Wt'
          }
        ]
      };
      for (i$ = 0, len$ = (ref$ = ['item', 'rings']).length; i$ < len$; ++i$) {
        itemType = ref$[i$];
        $scope.columnConfigs[itemType] = [{
          field: 'name',
          sort: {
            direction: uiGridConstants.ASC,
            priority: 0
          }
        }];
      }
    };
  }
}).call(this);

},{}],22:[function(require,module,exports){
(function(){
  var ItemIndexService;
  if (typeof angular != 'undefined' && angular !== null) {
    angular.module("dsc").service("itemIndexSvc", function(externalDataSvc){
      return new ItemIndexService(externalDataSvc);
    });
  }
  ItemIndexService = (function(){
    ItemIndexService.displayName = 'ItemIndexService';
    var prototype = ItemIndexService.prototype, constructor = ItemIndexService;
    function ItemIndexService(externalDataSvc){
      this.externalDataSvc = externalDataSvc;
      this.loadAllEntries = bind$(this, 'loadAllEntries', prototype);
      this.loadAllArmorSetEntries = bind$(this, 'loadAllArmorSetEntries', prototype);
      this.findByArmorSet = bind$(this, 'findByArmorSet', prototype);
      this.findArmorSetFor = bind$(this, 'findArmorSetFor', prototype);
      this.findEntries = bind$(this, 'findEntries', prototype);
      this.findEntryByUid = bind$(this, 'findEntryByUid', prototype);
      this.clear = bind$(this, 'clear', prototype);
      this._index = [];
      this._armorSetIndex = [];
    }
    prototype.clear = function(){
      this._index.length = 0;
      delete this._index.$promise;
      this._armorSetIndex.length = 0;
      delete this._armorSetIndex.$promise;
      return this;
    };
    /**
     * Finds the first item matching a given filter.
     * @param byFilter Function filter function that takes item as
     * a parameter and returns true/false if it matches/doesn't.
     * @returns Promise that resolves with the found value.
     */
    prototype.findEntryByUid = function(uid){
      var this$ = this;
      return this.loadAllEntries().then(function(entries){
        var entry;
        entry = find(function(it){
          return it.uid === uid;
        })(
        entries);
        if (entry == null) {
          throw new Error("Failed to find index entry with UID [" + uid + "].");
        }
        return entry;
      });
    };
    prototype.findEntries = function(byFilter){
      var this$ = this;
      if (typeof byFilter !== 'function') {
        throw new Error("[byFilter] is not a function.");
      }
      return this.loadAllEntries().then(function(it){
        return filter(byFilter)(
        it);
      });
    };
    prototype.findArmorSetFor = function(item){
      var this$ = this;
      return this.loadAllArmorSetEntries().then(function(it){
        return find(function(it){
          return it.uid === item.uid;
        })(
        it);
      });
    };
    prototype.findByArmorSet = function(setName){
      var this$ = this;
      if (typeof setName === 'object') {
        setName = setName.name;
      }
      if (typeof setName !== 'string') {
        throw new Error("Armor set name must be a string, or an object with string property [name].");
      }
      return this.loadAllArmorSetEntries().then(function(sets){
        var armorIds, ref$;
        armorIds = (ref$ = find(function(it){
          return it.name === setName;
        })(
        sets)) != null ? ref$.armors : void 8;
        return this$.findEntries(function(entry){
          return any((function(it){
            return it === entry.id;
          }))(
          armorIds);
        });
      });
    };
    prototype.loadAllArmorSetEntries = function(returnPromise){
      returnPromise == null && (returnPromise = true);
      if (this._armorSetIndex.$promise == null) {
        this._armorSetIndex = this.externalDataSvc.loadJson('/modules/items/content/armor-set-index.json', false);
      }
      return returnPromise
        ? this._armorSetIndex.$promise
        : this._armorSetIndex;
    };
    prototype.loadAllEntries = function(returnPromise){
      returnPromise == null && (returnPromise = true);
      if (this._index.$promise == null) {
        this._index = this.externalDataSvc.loadJson('/modules/items/content/index.json', false);
      }
      return returnPromise
        ? this._index.$promise
        : this._index;
    };
    return ItemIndexService;
  }());
  if (typeof module != 'undefined' && module !== null) {
    module.exports = ItemIndexService;
  }
  function bind$(obj, key, target){
    return function(){ return (target || obj)[key].apply(obj, arguments) };
  }
}).call(this);

},{}],23:[function(require,module,exports){
(function(){
  var ItemService;
  if (typeof angular != 'undefined' && angular !== null) {
    angular.module("dsc").service("itemSvc", function(externalDataSvc, itemIndexSvc, inventorySvc, $q){
      return (function(func, args, ctor) {
        ctor.prototype = func.prototype;
        var child = new ctor, result = func.apply(child, args), t;
        return (t = typeof result)  == "object" || t == "function" ? result || child : child;
  })(ItemService, arguments, function(){});
    });
  }
  ItemService = (function(){
    ItemService.displayName = 'ItemService';
    var prototype = ItemService.prototype, constructor = ItemService;
    function ItemService(_externalDataSvc, _itemIndexSvc, _inventorySvc, $q){
      this._externalDataSvc = _externalDataSvc;
      this._itemIndexSvc = _itemIndexSvc;
      this._inventorySvc = _inventorySvc;
      this.$q = $q;
      this.getUpgraded = bind$(this, 'getUpgraded', prototype);
      this.loadAllItems = bind$(this, 'loadAllItems', prototype);
      this.createItemModelFrom = bind$(this, 'createItemModelFrom', prototype);
      this.findItemsFromInventory = bind$(this, 'findItemsFromInventory', prototype);
      this.findAnyItemByUid = bind$(this, 'findAnyItemByUid', prototype);
      this.findItemById = bind$(this, 'findItemById', prototype);
      this.findItem = bind$(this, 'findItem', prototype);
      this.clear = bind$(this, 'clear', prototype);
      this.upgradeComp = new (require('./components/item-service-upgrade-component'));
      this.upgradeComp.constructor.apply(this.upgradeComp || (this.upgradeComp = {}), [this].concat(map(function(it){
        return it;
      })(
      arguments)));
      this._storage = {};
      this._models = require('./models/item-models');
    }
    prototype.clear = function(){
      this._storage = {};
      return this;
    };
    /**
     * Return the first item matching a given filter
     * @param itemType String type of item to find.
     * @param filterFn Function Filter function
     * @return Promise that resolves with the found item, or null if nothing found.
     */
    prototype.findItem = function(itemType, filterFn){
      var this$ = this;
      if (typeof itemType !== 'string') {
        throw new Error("Item type is invalid or not provided");
      }
      return this.loadAllItems(itemType).then(function(items){
        var item;
        item = find(filterFn)(
        items);
        return item;
      });
    };
    prototype.findItemById = function(itemType, id){
      var this$ = this;
      return this.loadAllItems(itemType).then(function(items){
        var item;
        item = find(function(it){
          return it.id === id;
        })(
        items);
        if (item == null) {
          throw new Error("Failed to find [" + itemType + "] with ID [" + id + "].");
        }
        return item;
      });
    };
    /**
     * Finds any item, regardless of type, but can only
     * check fields that are in the index.
     */
    prototype.findAnyItemByUid = function(uid){
      var this$ = this;
      return this._itemIndexSvc.findEntryByUid(uid).then(function(item){
        var baseId, upLevel;
        if (item == null) {
          throw new Error("Failed to find item with UID [" + uid + "] in the item index.");
        }
        if (this$.upgradeComp.isUpgraded(item)) {
          baseId = this$.upgradeComp.getBaseIdFrom(item.id);
          upLevel = this$.upgradeComp.getUpgradeLevelFrom(item.id);
          return function(item, baseId, upLevel){
            return this$.findItemById(item.itemType, baseId).then(function(baseItem){
              return this$.getUpgraded(baseItem, upLevel);
            });
          }(item, baseId, upLevel);
        } else {
          return this$.findItem(item.itemType, function(it){
            return it.id === item.id;
          });
        }
      });
    };
    /**
     * Filter inventory entries by a given filter and then return the real item data
     * for them.
     */
    prototype.findItemsFromInventory = function(typeOrFilter){
      var this$ = this;
      return this._inventorySvc.load().then(function(inventory){
        var promises, i$, len$, itemEntry;
        if (typeof typeOrFilter === 'string') {
          inventory = filter(function(it){
            return it.itemType === typeOrFilter;
          })(
          inventory);
        } else {
          inventory = filter(byFilter)(
          inventory);
        }
        promises = [];
        for (i$ = 0, len$ = inventory.length; i$ < len$; ++i$) {
          itemEntry = inventory[i$];
          promises.push(this$.findAnyItemByUid(itemEntry.uid));
        }
        return this$.$q.all(promises);
      });
    };
    /**
     * Create a model from given item data
     */
    prototype.createItemModelFrom = function(data){
      return (function(){
        switch (data.itemType) {
        case 'weapon':
          return new this._models.Weapon;
        case 'armor':
          return new this._models.Armor;
        case 'item':
          return new this._models.Item;
        default:
          throw new Error("Cannot create item model from data with .itemType == " + data.itemType + ".");
        }
      }.call(this)).useDataFrom(data);
    };
    /**
     * Load item data of a given item type.
     * @returns Promise or populated array, depending on returnPromise setting.
     */
    prototype.loadAllItems = function(itemType, returnPromise){
      var ref$, test, this$ = this;
      returnPromise == null && (returnPromise = true);
      if (((ref$ = this._storage)[itemType] || (ref$[itemType] = [])).$promise == null) {
        this._storage[itemType].$promise = test = this._externalDataSvc.loadJson("/modules/items/content/" + itemType + "s.json").then(function(itemData){
          each(function(it){
            var ref$;
            ((ref$ = this$._storage)[itemType] || (ref$[itemType] = [])).push(this$.createItemModelFrom(it));
          })(
          itemData);
          return this$._storage[itemType];
        });
      }
      return returnPromise
        ? this._storage[itemType].$promise
        : this._storage[itemType];
    };
    prototype.getUpgraded = function(item, level){
      var this$ = this;
      level == null && (level = true);
      if (level === true) {
        level = item.upgradeId + 1;
      }
      return this.upgradeComp.findUpgradeFor(item, level).then(function(upgrade){
        if (upgrade == null) {
          return null;
        }
        return this$.upgradeComp.findBaseItem(
        item).then(function(baseItem){
          return this$.createItemModelFrom(baseItem);
        }).then(function(newItem){
          return this$.upgradeComp.apply(upgrade).to(newItem);
        }).then(function(newItem){
          return this$._itemIndexSvc.findEntryByUid(newItem.uid).then(function(entry){
            newItem.name = entry.name;
            return newItem;
          });
        }).then(function(newItem){
          if (newItem.itemType === 'armor') {
            newItem.armorSet = this$._itemIndexSvc.findArmorSetFor(newItem).name;
          }
          return newItem;
        });
      });
    };
    return ItemService;
  }());
  if (typeof module != 'undefined' && module !== null) {
    module.exports = ItemService;
  }
  function bind$(obj, key, target){
    return function(){ return (target || obj)[key].apply(obj, arguments) };
  }
}).call(this);

},{"./components/item-service-upgrade-component":20,"./models/item-models":26}],24:[function(require,module,exports){
(function(){
  angular.module("dsc").controller("ItemsController", function($scope, dataExportSvc, itemSvc, uiGridConstants){
    var i$, ref$, len$, itemType;
    $scope.itemTypes = [];
    for (i$ = 0, len$ = (ref$ = ['none', 'item', 'weapon', 'armor']).length; i$ < len$; ++i$) {
      itemType = ref$[i$];
      $scope.itemTypes.push(itemType);
    }
    require('./config/items-grid-options')($scope, uiGridConstants);
    $scope.selectedItemTypeChanged = function(){
      if ($scope.selectedItemType === 'none') {
        $scope.gridOptions.data = [];
        $scope.gridOptions.columnDefs = [];
        return;
      }
      $scope.gridOptions.columnDefs = $scope.columnConfigs[$scope.selectedItemType];
      itemSvc.loadAllItems($scope.selectedItemType).then(function(itemData){
        var i$, len$, weapon;
        if ($scope.selectedItemType === 'weapon') {
          for (i$ = 0, len$ = itemData.length; i$ < len$; ++i$) {
            weapon = itemData[i$];
            (fn$.call(this, weapon));
          }
        }
        $scope.gridOptions.data = itemData;
        function fn$(weapon){
          itemSvc.getUpgraded(weapon, 0).then(function(up){
            import$(weapon, up);
          });
        }
      });
    };
    $scope.exportAsJson = function(){
      dataExportSvc.exportJson(map(function(it){
        delete it.$$hashKey;
        return it;
      })(
      $scope.gridOptions.data));
    };
    $scope.exportAsCsv = function(){
      var outputData;
      outputData = map(function(it){
        var item;
        item = import$({}, it);
        delete item.$$hashKey;
        return item;
      })(
      $scope.gridOptions.data);
      dataExportSvc.exportCsv(outputData);
    };
    $scope.selectedItemType = 'none';
  });
  function import$(obj, src){
    var own = {}.hasOwnProperty;
    for (var key in src) if (own.call(src, key)) obj[key] = src[key];
    return obj;
  }
}).call(this);

},{"./config/items-grid-options":21}],25:[function(require,module,exports){
(function(){
  require('./items-controller');
  require('./item-service');
  require('./item-index-service');
}).call(this);

},{"./item-index-service":22,"./item-service":23,"./items-controller":24}],26:[function(require,module,exports){
(function(){
  var ItemModel, EquipmentModel, WeaponModel, ArmorModel;
  if (typeof module != 'undefined' && module !== null) {
    module.exports = {
      'Item': ItemModel = (function(){
        ItemModel.displayName = 'ItemModel';
        var prototype = ItemModel.prototype, constructor = ItemModel;
        function ItemModel(){
          this.useDataFrom = bind$(this, 'useDataFrom', prototype);
          this.id = 0;
          this.itemType = 'item';
          this.itemSubtype = '';
          this.name = '';
          this.sellValue = 0;
          this.iconId = 0;
        }
        /**
         * A unique ID that doesn't overlap between item types.
         */
        Object.defineProperty(prototype, 'uid', {
          get: function(){
            return this.itemType + this.id;
          },
          configurable: true,
          enumerable: true
        });
        prototype.useDataFrom = function(itemData){
          return import$(this, itemData);
        };
        return ItemModel;
      }()),
      'Equipment': EquipmentModel = (function(superclass){
        var prototype = extend$((import$(EquipmentModel, superclass).displayName = 'EquipmentModel', EquipmentModel), superclass).prototype, constructor = EquipmentModel;
        function EquipmentModel(){
          EquipmentModel.superclass.call(this);
          this.weight = 0.0;
          this.durability = 0;
          this.defPhy = 0;
          this.defMag = 0;
          this.defFir = 0;
          this.defLit = 0;
          this.defTox = 0;
          this.defBlo = 0;
          this.defCur = 0;
          this.matSetId = 0;
          this.upgradeCost = 0;
          this.upgradeId = -1;
        }
        return EquipmentModel;
      }(ItemModel)),
      'Weapon': WeaponModel = (function(superclass){
        var prototype = extend$((import$(WeaponModel, superclass).displayName = 'WeaponModel', WeaponModel), superclass).prototype, constructor = WeaponModel;
        function WeaponModel(){
          this._dpsFor = bind$(this, '_dpsFor', prototype);
          WeaponModel.superclass.call(this);
          this.itemType = 'weapon';
          this.weaponType = '';
          this.weaponSubtype = '';
          this.path = '';
          this.canBlock = false;
          this.canParry = false;
          this.castsMagic = false;
          this.castsPyromancy = false;
          this.castsMiracles = false;
          this.damagesGhosts = false;
          this.isAugmentable = false;
          this.doesRegularDamage = false;
          this.doesStrikeDamage = false;
          this.doesSlashDamage = false;
          this.doesThrustDamage = false;
          this.reqStr = 0;
          this.reqDex = 0;
          this.reqInt = 0;
          this.reqFai = 0;
          this.atkPhy = 0;
          this.atkMag = 0;
          this.atkFir = 0;
          this.atkLit = 0;
          this.atkStaCost = 0;
          this.bonusStr = 0;
          this.bonusDex = 0;
          this.bonusInt = 0;
          this.bonusFai = 0;
          this.defSta = 0;
          this.divine = 0;
          this.occult = 0;
          this.range = 0;
          this.atkBlo = 0;
          this.dmgBlo = 0;
          this.atkTox = 0;
          this.dmgTox = 0;
          this.atkHeal = 0;
        }
        prototype._dpsFor = function(stat){
          if (this.atkStaCost > 1) {
            return stat / (this.atkStaCost * 1.8);
          } else {
            return 0;
          }
        };
        Object.defineProperty(prototype, 'dpsPhy', {
          get: function(){
            return this._dpsFor(this.atkPhy);
          },
          configurable: true,
          enumerable: true
        });
        Object.defineProperty(prototype, 'dpsMag', {
          get: function(){
            return this._dpsFor(this.atkMag);
          },
          configurable: true,
          enumerable: true
        });
        Object.defineProperty(prototype, 'dpsFir', {
          get: function(){
            return this._dpsFor(this.atkFir);
          },
          configurable: true,
          enumerable: true
        });
        Object.defineProperty(prototype, 'dpsLit', {
          get: function(){
            return this._dpsFor(this.atkLit);
          },
          configurable: true,
          enumerable: true
        });
        return WeaponModel;
      }(EquipmentModel)),
      'Armor': ArmorModel = (function(superclass){
        var prototype = extend$((import$(ArmorModel, superclass).displayName = 'ArmorModel', ArmorModel), superclass).prototype, constructor = ArmorModel;
        function ArmorModel(){
          ArmorModel.superclass.call(this);
          this.itemType = 'armor';
          this.armorType = '';
          this.armorSet = '';
          this.defSlash = 0;
          this.defStrike = 0;
          this.defThrust = 0;
          this.defPoise = 0;
          this.staRegenMod = 0;
        }
        Object.defineProperty(prototype, 'sortType', {
          get: function(){
            switch (this.armorType) {
            case 'head':
              return 1;
            case 'chest':
              return 2;
            case 'hands':
              return 3;
            case 'legs':
              return 4;
            }
          },
          configurable: true,
          enumerable: true
        });
        return ArmorModel;
      }(EquipmentModel))
    };
  }
  function bind$(obj, key, target){
    return function(){ return (target || obj)[key].apply(obj, arguments) };
  }
  function import$(obj, src){
    var own = {}.hasOwnProperty;
    for (var key in src) if (own.call(src, key)) obj[key] = src[key];
    return obj;
  }
  function extend$(sub, sup){
    function fun(){} fun.prototype = (sub.superclass = sup).prototype;
    (sub.prototype = new fun).constructor = sub;
    if (typeof sup.extended == 'function') sup.extended(sub);
    return sub;
  }
}).call(this);

},{}],27:[function(require,module,exports){
(function(){
  if (typeof module != 'undefined' && module !== null) {
    module.exports = function(uiGridConstants){
      return {
        enableFiltering: true,
        columnDefs: [
          {
            field: 'name',
            sort: {
              direction: uiGridConstants.ASC
            }
          }, {
            field: 'itemType',
            displayName: 'Type',
            filter: {
              type: uiGridConstants.filter.SELECT,
              selectOptions: [
                {
                  value: 'weapon',
                  label: "Weapons"
                }, {
                  value: 'armor',
                  label: "Armor"
                }, {
                  value: 'item',
                  label: "Items"
                }
              ]
            }
          }, {
            field: 'amount',
            width: 50
          }
        ],
        onRegisterApi: function(gridApi){
          gridApi.core.addRowHeaderColumn({
            name: 'rowHeaderCol',
            displayName: '',
            width: 100,
            cellTemplate: 'GridRowHeader.html'
          });
        }
      };
    };
  }
}).call(this);

},{}],28:[function(require,module,exports){
(function(){
  angular.module("dsc").filter("toStatArray", function(statSvc){
    var output;
    output = [];
    return function(model){
      if (output.length > 0) {
        return output;
      }
      statSvc.forEachStat(model, function(stat, name){
        output.push(model[name]);
      });
      return output;
    };
  });
}).call(this);

},{}],29:[function(require,module,exports){
(function(){
  var InventorySvc;
  if (typeof angular != 'undefined' && angular !== null) {
    angular.module("dsc").service("inventorySvc", function(storageSvc, itemIndexSvc, $q){
      return (function(func, args, ctor) {
        ctor.prototype = func.prototype;
        var child = new ctor, result = func.apply(child, args), t;
        return (t = typeof result)  == "object" || t == "function" ? result || child : child;
  })(InventorySvc, arguments, function(){});
    });
  }
  InventorySvc = (function(){
    InventorySvc.displayName = 'InventorySvc';
    var prototype = InventorySvc.prototype, constructor = InventorySvc;
    function InventorySvc(_storageSvc, _itemIndexSvc, $q){
      this._storageSvc = _storageSvc;
      this._itemIndexSvc = _itemIndexSvc;
      this.$q = $q;
      this.clear = bind$(this, 'clear', prototype);
      this.remove = bind$(this, 'remove', prototype);
      this.add = bind$(this, 'add', prototype);
      this.createInventoryItemFrom = bind$(this, 'createInventoryItemFrom', prototype);
      this.findItemByUid = bind$(this, 'findItemByUid', prototype);
      this.load = bind$(this, 'load', prototype);
      this.save = bind$(this, 'save', prototype);
      this._inventory = [];
      this._models = require('./models/inventory-models');
    }
    prototype.save = function(){
      var data, i$, ref$, len$, item;
      data = [];
      for (i$ = 0, len$ = (ref$ = this._inventory).length; i$ < len$; ++i$) {
        item = ref$[i$];
        data.push({
          'uid': item.uid,
          'amount': item.amount
        });
      }
      this._storageSvc.save('inventory', data);
    };
    prototype.load = function(returnPromise){
      var promises, i$, ref$, len$, data, promise, this$ = this;
      returnPromise == null && (returnPromise = true);
      if (this._inventory.$promise == null) {
        this.clear();
        promises = [];
        for (i$ = 0, len$ = (ref$ = this._storageSvc.load('inventory')).length; i$ < len$; ++i$) {
          data = ref$[i$];
          promise = fn$(data);
          promises.push(promise);
        }
        this._inventory.$promise = this.$q.all(promises).then(function(){
          return this$._inventory;
        });
      }
      return returnPromise
        ? this._inventory.$promise
        : this._inventory;
      function fn$(data){
        var item;
        item = new this$._models.InventoryItem(data);
        return this$._itemIndexSvc.findEntryByUid(data.uid).then(function(indexEntry){
          item.useDataFrom(indexEntry);
          this$._inventory.push(item);
          return item;
        });
      }
    };
    prototype.findItemByUid = function(uid){
      var this$ = this;
      return this.load().then(function(inventory){
        return find(function(it){
          return it.uid === uid;
        })(
        inventory);
      });
    };
    prototype.createInventoryItemFrom = function(item, amount){
      var x$;
      amount == null && (amount = 1);
      x$ = new this._models.InventoryItem;
      x$.useDataFrom(item);
      x$.amount = amount;
      return x$;
    };
    prototype.add = function(item, amount){
      var this$ = this;
      amount == null && (amount = 1);
      return this.findItemByUid(item.uid).then(function(invItem){
        var x$;
        if (invItem != null) {
          invItem.amount += amount;
        } else {
          x$ = invItem = this$.createInventoryItemFrom(item, amount);
          this$._inventory.push(
          x$);
        }
        this$.save();
        return invItem;
      });
    };
    prototype.remove = function(item, amount){
      var this$ = this;
      amount == null && (amount = 1);
      return this.findItemByUid(item.uid).then(function(entry){
        if (entry == null) {
          throw new Error("Failed to remove the above item because couldn't find it in the inventory.");
        }
        entry.amount = amount === true
          ? 0
          : entry.amount -= amount;
        if (entry.amount < 1) {
          this$._inventory.splice(this$._inventory.indexOf(entry), 1);
        }
        this$.save();
        return entry;
      });
    };
    prototype.clear = function(){
      this._inventory.length = 0;
      delete this._inventory.$promise;
      return this;
    };
    return InventorySvc;
  }());
  if (typeof module != 'undefined' && module !== null) {
    module.exports = InventorySvc;
  }
  function bind$(obj, key, target){
    return function(){ return (target || obj)[key].apply(obj, arguments) };
  }
}).call(this);

},{"./models/inventory-models":33}],30:[function(require,module,exports){
(function(){
  angular.module("dsc");
  require("./inventory-service");
  require("./stat-service");
  require("./filters/stat-filters");
  require("./pc-controller");
}).call(this);

},{"./filters/stat-filters":28,"./inventory-service":29,"./pc-controller":34,"./stat-service":35}],31:[function(require,module,exports){
(function(){
  var PcModel;
  if (typeof module != 'undefined' && module !== null) {
    module.exports = PcModel = (function(){
      PcModel.displayName = 'PcModel';
      var prototype = PcModel.prototype, constructor = PcModel;
      PcModel.Stats = ['vitality', 'attunement', 'endurance', 'strength', 'dexterity', 'resistance', 'intelligence', 'faith', 'humanity'];
      function PcModel(statSvc){
        this.statSvc = statSvc;
        this.validate = bind$(this, 'validate', prototype);
        this.forEachStat = bind$(this, 'forEachStat', prototype);
        this.forEachStat(function(stat, name){
          return new (require('./PcStatModel'))(name);
        });
      }
      prototype.forEachStat = function(func){
        this.statSvc.forEachStat(func, this);
      };
      prototype.validate = function(){
        this.forEachStat(function(it){
          it.base = max(8, min(99, it.base));
        });
      };
      return PcModel;
    }());
  }
  function bind$(obj, key, target){
    return function(){ return (target || obj)[key].apply(obj, arguments) };
  }
}).call(this);

},{"./PcStatModel":32}],32:[function(require,module,exports){
(function(){
  var PcStatModel;
  if (typeof module != 'undefined' && module !== null) {
    module.exports = PcStatModel = (function(){
      PcStatModel.displayName = 'PcStatModel';
      var prototype = PcStatModel.prototype, constructor = PcStatModel;
      function PcStatModel(name, base){
        this.name = name;
        this.base = base != null ? base : 0;
        this.bonus = 0;
      }
      Object.defineProperty(prototype, 'total', {
        get: function(){
          return this.base + this.bonus;
        },
        configurable: true,
        enumerable: true
      });
      Object.defineProperty(prototype, 'displayName', {
        get: function(){
          return capitalize(this.name);
        },
        configurable: true,
        enumerable: true
      });
      return PcStatModel;
    }());
  }
}).call(this);

},{}],33:[function(require,module,exports){
(function(){
  var InventoryItemModel;
  InventoryItemModel = (function(){
    InventoryItemModel.displayName = 'InventoryItemModel';
    var prototype = InventoryItemModel.prototype, constructor = InventoryItemModel;
    function InventoryItemModel(item){
      this.useDataFrom = bind$(this, 'useDataFrom', prototype);
      this.amount = 1;
      this.name = '';
      this.itemType = '';
      this.id = '';
      this.uid = '';
      this.useDataFrom(item);
    }
    prototype.useDataFrom = function(item){
      var i$, ref$, len$, field;
      if (item == null) {
        return;
      }
      for (i$ = 0, len$ = (ref$ = ['amount', 'uid', 'name', 'itemType', 'id']).length; i$ < len$; ++i$) {
        field = ref$[i$];
        if (item[field] != null) {
          this[field] = item[field];
        }
      }
      return this;
    };
    return InventoryItemModel;
  }());
  if (typeof module != 'undefined' && module !== null) {
    module.exports = {
      'InventoryItem': InventoryItemModel
    };
  }
  function bind$(obj, key, target){
    return function(){ return (target || obj)[key].apply(obj, arguments) };
  }
}).call(this);

},{}],34:[function(require,module,exports){
(function(){
  angular.module("dsc").controller("pcController", function($scope, uiGridConstants, statSvc, itemSvc, itemIndexSvc, storageSvc, inventorySvc, dataExportSvc){
    $scope.model = statSvc.loadUserData();
    $scope.saveStats = function(){
      statSvc.saveUserData($scope.model);
    };
    $scope.selectedItem = null;
    $scope.armorSets = [];
    $scope.allItems = [];
    $scope.itemTypes = ['weapon', 'armor', 'item'];
    $scope.gridOptions = require('./config/inventory-grid-opts')(uiGridConstants);
    $scope.allItems = itemIndexSvc.loadAllEntries(false);
    $scope.armorSets = itemIndexSvc.loadAllArmorSetEntries(false);
    $scope.gridOptions.data = inventorySvc.load(false);
    $scope['export'] = function(){};
    $scope.canUpgrade = function(item){
      return itemSvc.upgradeComp.canBeUpgraded(
      item);
    };
    $scope.upgrade = function(invEntry){
      return itemSvc.findAnyItemByUid(invEntry.uid).then(function(item){
        return itemSvc.getUpgraded(item);
      }).then(function(upItem){
        if (upItem == null) {
          return;
        }
        $scope.remove(invEntry);
        $scope.add(upItem);
      });
    };
    $scope.addNewItem = function(selection){
      $scope.add(selection.originalObject);
    };
    $scope.add = inventorySvc.add;
    $scope.remove = inventorySvc.remove;
    $scope.addArmorSet = function(selection){
      var armorSet;
      armorSet = selection.originalObject;
      itemIndexSvc.findByArmorSet(armorSet).then(function(armors){
        each($scope.add)(
        armors);
      });
    };
  });
}).call(this);

},{"./config/inventory-grid-opts":27}],35:[function(require,module,exports){
(function(){
  var StatService;
  if (typeof angular != 'undefined' && angular !== null) {
    angular.module("dsc").service("statSvc", function(storageSvc){
      return (function(func, args, ctor) {
        ctor.prototype = func.prototype;
        var child = new ctor, result = func.apply(child, args), t;
        return (t = typeof result)  == "object" || t == "function" ? result || child : child;
  })(StatService, arguments, function(){});
    });
  }
  StatService = (function(){
    StatService.displayName = 'StatService';
    var prototype = StatService.prototype, constructor = StatService;
    function StatService(_storageSvc){
      this._storageSvc = _storageSvc;
      this.statScalingFactorOf = bind$(this, 'statScalingFactorOf', prototype);
      this.saveUserData = bind$(this, 'saveUserData', prototype);
      this.loadUserData = bind$(this, 'loadUserData', prototype);
      this.forEachStat = bind$(this, 'forEachStat', prototype);
      this.statValueOf = bind$(this, 'statValueOf', prototype);
      this.data = {};
      this.PcModel = require('./models/PcModel');
      this.PcStatModel = require('./models/PcStatModel');
    }
    prototype.statValueOf = function(name){
      this.loadUserData();
      return this.data.stats[name].total;
    };
    prototype.forEachStat = function(func, model){
      var i$, ref$, len$, statName, stat, ref1$;
      model == null && (model = this.data);
      for (i$ = 0, len$ = (ref$ = this.PcModel.Stats).length; i$ < len$; ++i$) {
        statName = ref$[i$];
        stat = (model.stats || (model.stats = {}))[statName];
        (model.stats || (model.stats = {}))[statName] = (ref1$ = func(stat, statName)) != null ? ref1$ : stat;
      }
    };
    prototype.loadUserData = function(){
      var data, model, this$ = this;
      data = this._storageSvc.load('pc' != null
        ? 'pc'
        : {});
      model = import$(new this.PcModel(this), data);
      model.forEachStat(function(stat, name){
        var x$, ref$;
        x$ = import$(new this$.PcStatModel, data != null ? (ref$ = data.stats) != null ? ref$[name] : void 8 : void 8);
        x$.name = name;
        return x$;
      });
      model.validate();
      return this.data = model;
    };
    prototype.saveUserData = function(model){
      var data, key, value;
      model == null && (model = this.data);
      model.validate();
      data = import$({}, model);
      for (key in model) {
        value = model[key];
        if (key !== 'stats') {
          delete data[key];
        }
      }
      this._storageSvc.save('pc', data);
    };
    prototype.statScalingFactorOf = function(name){
      var statValue, thresholds, result, i$, len$, threshold;
      statValue = this.statValueOf(name);
      thresholds = (function(){
        switch (name) {
        case 'strength':
          // fallthrough
        case 'dexterity':
          return [[10, 0.5], [10, 3.5], [20, 2.25]];
        case 'intelligence':
          // fallthrough
        case 'faith':
          return [[10, 0.5], [20, 2.25], [20, 1.5]];
        default:
          throw Error('unimplemented');
        }
      }());
      result = 0;
      for (i$ = 0, len$ = thresholds.length; i$ < len$; ++i$) {
        threshold = thresholds[i$];
        if (statValue >= threshold[0]) {
          result += threshold[0] * threshold[1];
        } else {
          result += statValue * threshold[1];
        }
        statValue -= threshold[0];
        if (statValue < 1) {
          break;
        }
      }
      result /= 100;
      return result;
    };
    return StatService;
  }());
  if (typeof module != 'undefined' && module !== null) {
    module.exports = StatService;
  }
  function bind$(obj, key, target){
    return function(){ return (target || obj)[key].apply(obj, arguments) };
  }
  function import$(obj, src){
    var own = {}.hasOwnProperty;
    for (var key in src) if (own.call(src, key)) obj[key] = src[key];
    return obj;
  }
}).call(this);

},{"./models/PcModel":31,"./models/PcStatModel":32}],36:[function(require,module,exports){
(function(){
  if (typeof module != 'undefined' && module !== null) {
    module.exports = function(uiGridConstants){
      var percentFieldMinWidth;
      percentFieldMinWidth = 45;
      return {
        columnDefs: [
          {
            field: 'score',
            minWidth: 50,
            cellFilter: 'number:2',
            sort: {
              direction: uiGridConstants.DESC,
              priority: 1
            },
            type: 'number'
          }, {
            field: 'weapon.name',
            minWidth: 210
          }, {
            field: 'weapon.reqStr',
            displayName: 'RS',
            type: 'number'
          }, {
            field: 'weapon.reqDex',
            displayName: 'RD',
            type: 'number'
          }, {
            field: 'weapon.reqInt',
            displayName: 'RI',
            type: 'number'
          }, {
            field: 'weapon.reqFai',
            displayName: 'RF',
            type: 'number'
          }, {
            field: 'weapon.atkPhy',
            displayName: 'AP',
            type: 'number',
            cellFilter: "number:0"
          }, {
            field: 'weapon.atkMag',
            displayName: 'AM',
            type: 'number',
            cellFilter: "number:0"
          }, {
            field: 'weapon.atkFir',
            displayName: 'AF',
            type: 'number',
            cellFilter: "number:0"
          }, {
            field: 'weapon.atkLit',
            displayName: 'AL',
            type: 'number',
            cellFilter: "number:0"
          }, {
            field: 'weapon.atkStaCost',
            displayName: 'AS',
            type: 'number',
            cellFilter: "number:0"
          }, {
            field: 'weapon.bonusStr',
            displayName: 'SS',
            minWidth: percentFieldMinWidth,
            cellFilter: 'percentage',
            type: 'number'
          }, {
            field: 'weapon.bonusDex',
            displayName: 'SD',
            minWidth: percentFieldMinWidth,
            cellFilter: 'percentage',
            type: 'number'
          }, {
            field: 'weapon.bonusInt',
            displayName: 'SI',
            minWidth: percentFieldMinWidth,
            cellFilter: 'percentage',
            type: 'number'
          }, {
            field: 'weapon.bonusFai',
            displayName: 'SF',
            minWidth: percentFieldMinWidth,
            cellFilter: 'percentage',
            type: 'number'
          }, {
            field: 'weapon.defPhy',
            displayName: 'DP',
            type: 'number'
          }, {
            field: 'weapon.defMag',
            displayName: 'DM',
            type: 'number'
          }, {
            field: 'weapon.defFir',
            displayName: 'DF',
            type: 'number'
          }, {
            field: 'weapon.defLit',
            displayName: 'DL',
            type: 'number'
          }, {
            field: 'weapon.defTox',
            displayName: 'DT',
            type: 'number'
          }, {
            field: 'weapon.defBlo',
            displayName: 'DB',
            type: 'number'
          }, {
            field: 'weapon.defCur',
            displayName: 'DC',
            type: 'number'
          }, {
            field: 'weapon.defSta',
            displayName: 'St',
            type: 'number'
          }, {
            field: 'weapon.divine',
            minWidth: percentFieldMinWidth,
            displayName: 'Div',
            cellFilter: 'percentage',
            type: 'number'
          }, {
            field: 'weapon.occult',
            minWidth: percentFieldMinWidth,
            displayName: 'Occ',
            cellFilter: 'percentage',
            type: 'number'
          }, {
            field: 'weapon.weight',
            displayName: 'Wt',
            type: 'number'
          }
        ]
      };
    };
  }
}).call(this);

},{}],37:[function(require,module,exports){
(function(){
  require('./weapon-finder-service');
  require('./weapon-finder-controller');
}).call(this);

},{"./weapon-finder-controller":38,"./weapon-finder-service":39}],38:[function(require,module,exports){
(function(){
  angular.module("dsc").controller("weaponFinderController", function($scope, weaponFinderSvc, uiGridConstants){
    $scope.results = [];
    $scope.gridOptions = require('./config/weapon-finder-grid-options')(uiGridConstants);
    $scope.findWeapons = function(){
      weaponFinderSvc.findBestWeapons().then(function(results){
        $scope.results = map(function(result){
          return {
            score: result.score,
            weapon: result
          };
        })(
        results);
        $scope.gridOptions.data = $scope.results;
      });
    };
  });
}).call(this);

},{"./config/weapon-finder-grid-options":36}],39:[function(require,module,exports){
(function(){
  var WeaponFinderService;
  if (typeof angular != 'undefined' && angular !== null) {
    angular.module("dsc").service("weaponFinderSvc", function(itemSvc, statSvc, $q){
      return (function(func, args, ctor) {
        ctor.prototype = func.prototype;
        var child = new ctor, result = func.apply(child, args), t;
        return (t = typeof result)  == "object" || t == "function" ? result || child : child;
  })(WeaponFinderService, arguments, function(){});
    });
  }
  WeaponFinderService = (function(){
    WeaponFinderService.displayName = 'WeaponFinderService';
    var prototype = WeaponFinderService.prototype, constructor = WeaponFinderService;
    function WeaponFinderService(_itemSvc, _statSvc, $q){
      this._itemSvc = _itemSvc;
      this._statSvc = _statSvc;
      this.$q = $q;
      this.calculateScoreFor = bind$(this, 'calculateScoreFor', prototype);
      this.findFittingWeapons = bind$(this, 'findFittingWeapons', prototype);
      this.findBestWeapons = bind$(this, 'findBestWeapons', prototype);
      this.params = {
        statBonus: 0
      };
    }
    prototype.findBestWeapons = function(){
      var allWeapons, this$ = this;
      allWeapons = [];
      return this.findFittingWeapons().then(function(weapons){
        allWeapons = allWeapons.concat(weapons);
        return map(function(it){
          return this$._itemSvc.upgradeComp.findAllAvailableUpgradesFor(it);
        })(
        this$.$q.all(weapons));
      }).then(function(upWeapons){
        allWeapons = allWeapons.concat(upWeapons);
        each(function(it){
          return it.score = this$.calculateScoreFor(it);
        })(
        allWeapons);
        return allWeapons;
      });
    };
    prototype.findFittingWeapons = function(){
      var this$ = this;
      return this._itemSvc.findItemsFromInventory('weapon').then(function(weapons){
        return weapons;
      });
    };
    prototype.calculateScoreFor = function(weapon){
      var scS, scD, scI, scF, str, dex, int, fai, score;
      scS = this._statSvc.statScalingFactorOf('strength');
      scD = this._statSvc.statScalingFactorOf('dexterity');
      scI = this._statSvc.statScalingFactorOf('intelligence');
      scF = this._statSvc.statScalingFactorOf('faith');
      str = this.params.statBonus + this._statSvc.statValueOf('strength');
      dex = this.params.statBonus + this._statSvc.statValueOf('dexterity');
      int = this.params.statBonus + this._statSvc.statValueOf('intelligence');
      fai = this.params.statBonus + this._statSvc.statValueOf('faith');
      weapon.atkPhy *= 1 + (weapon.bonusStr * scS + weapon.bonusDex * scD);
      weapon.atkMag *= 1 + (weapon.bonusInt * scI + weapon.bonusFai * scF);
      return score = weapon.atkPhy;
    };
    return WeaponFinderService;
  }());
  if (typeof module != 'undefined' && module !== null) {
    module.exports = WeaponFinderService;
  }
  function bind$(obj, key, target){
    return function(){ return (target || obj)[key].apply(obj, arguments) };
  }
}).call(this);

},{}]},{},[7])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL1VzZXJzL01hcnRpbi9BcHBEYXRhL1JvYW1pbmcvbnBtL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIuLi9ub2RlX21vZHVsZXMvcHJlbHVkZS1scy9saWIvRnVuYy5qcyIsIi4uL25vZGVfbW9kdWxlcy9wcmVsdWRlLWxzL2xpYi9MaXN0LmpzIiwiLi4vbm9kZV9tb2R1bGVzL3ByZWx1ZGUtbHMvbGliL051bS5qcyIsIi4uL25vZGVfbW9kdWxlcy9wcmVsdWRlLWxzL2xpYi9PYmouanMiLCIuLi9ub2RlX21vZHVsZXMvcHJlbHVkZS1scy9saWIvU3RyLmpzIiwiLi4vbm9kZV9tb2R1bGVzL3ByZWx1ZGUtbHMvbGliL2luZGV4LmpzIiwiLi4vcHViL190ZW1wXy9hcHAuanMiLCIuLi9wdWIvX3RlbXBfL2FwcC9tYWluLWNvbnRyb2xsZXIuanMiLCIuLi9wdWIvX3RlbXBfL2FwcC9yb3V0ZXMuanMiLCIuLi9wdWIvX3RlbXBfL2FwcC9zZXJ2aWNlcy9kYXRhLWV4cG9ydC1zZXJ2aWNlLmpzIiwiLi4vcHViL190ZW1wXy9hcHAvc2VydmljZXMvZXh0ZXJuYWwtZGF0YS1zZXJ2aWNlLmpzIiwiLi4vcHViL190ZW1wXy9hcHAvc2VydmljZXMvc3RvcmFnZS1zZXJ2aWNlLmpzIiwiLi4vcHViL190ZW1wXy9tb2R1bGVzL2FybW9yLWNhbGMvYXJtb3ItY2FsYy1jb250cm9sbGVyLmpzIiwiLi4vcHViL190ZW1wXy9tb2R1bGVzL2FybW9yLWNhbGMvYXJtb3ItY2FsYy1zZXJ2aWNlLmpzIiwiLi4vcHViL190ZW1wXy9tb2R1bGVzL2FybW9yLWNhbGMvY29udHJvbGxlci9ncmlkT3B0aW9ucy5qcyIsIi4uL3B1Yi9fdGVtcF8vbW9kdWxlcy9hcm1vci1jYWxjL21haW4uanMiLCIuLi9wdWIvX3RlbXBfL21vZHVsZXMvZ3VpZGUvZ3VpZGUtY29udHJvbGxlci5qcyIsIi4uL3B1Yi9fdGVtcF8vbW9kdWxlcy9ndWlkZS9ndWlkZS1zZXJ2aWNlLmpzIiwiLi4vcHViL190ZW1wXy9tb2R1bGVzL2d1aWRlL21haW4uanMiLCIuLi9wdWIvX3RlbXBfL21vZHVsZXMvaXRlbXMvY29tcG9uZW50cy9pdGVtLXNlcnZpY2UtdXBncmFkZS1jb21wb25lbnQuanMiLCIuLi9wdWIvX3RlbXBfL21vZHVsZXMvaXRlbXMvY29uZmlnL2l0ZW1zLWdyaWQtb3B0aW9ucy5qcyIsIi4uL3B1Yi9fdGVtcF8vbW9kdWxlcy9pdGVtcy9pdGVtLWluZGV4LXNlcnZpY2UuanMiLCIuLi9wdWIvX3RlbXBfL21vZHVsZXMvaXRlbXMvaXRlbS1zZXJ2aWNlLmpzIiwiLi4vcHViL190ZW1wXy9tb2R1bGVzL2l0ZW1zL2l0ZW1zLWNvbnRyb2xsZXIuanMiLCIuLi9wdWIvX3RlbXBfL21vZHVsZXMvaXRlbXMvbWFpbi5qcyIsIi4uL3B1Yi9fdGVtcF8vbW9kdWxlcy9pdGVtcy9tb2RlbHMvaXRlbS1tb2RlbHMuanMiLCIuLi9wdWIvX3RlbXBfL21vZHVsZXMvcGMvY29uZmlnL2ludmVudG9yeS1ncmlkLW9wdHMuanMiLCIuLi9wdWIvX3RlbXBfL21vZHVsZXMvcGMvZmlsdGVycy9zdGF0LWZpbHRlcnMuanMiLCIuLi9wdWIvX3RlbXBfL21vZHVsZXMvcGMvaW52ZW50b3J5LXNlcnZpY2UuanMiLCIuLi9wdWIvX3RlbXBfL21vZHVsZXMvcGMvbWFpbi5qcyIsIi4uL3B1Yi9fdGVtcF8vbW9kdWxlcy9wYy9tb2RlbHMvUGNNb2RlbC5qcyIsIi4uL3B1Yi9fdGVtcF8vbW9kdWxlcy9wYy9tb2RlbHMvUGNTdGF0TW9kZWwuanMiLCIuLi9wdWIvX3RlbXBfL21vZHVsZXMvcGMvbW9kZWxzL2ludmVudG9yeS1tb2RlbHMuanMiLCIuLi9wdWIvX3RlbXBfL21vZHVsZXMvcGMvcGMtY29udHJvbGxlci5qcyIsIi4uL3B1Yi9fdGVtcF8vbW9kdWxlcy9wYy9zdGF0LXNlcnZpY2UuanMiLCIuLi9wdWIvX3RlbXBfL21vZHVsZXMvd2VhcG9uLWZpbmRlci9jb25maWcvd2VhcG9uLWZpbmRlci1ncmlkLW9wdGlvbnMuanMiLCIuLi9wdWIvX3RlbXBfL21vZHVsZXMvd2VhcG9uLWZpbmRlci9tYWluLmpzIiwiLi4vcHViL190ZW1wXy9tb2R1bGVzL3dlYXBvbi1maW5kZXIvd2VhcG9uLWZpbmRlci1jb250cm9sbGVyLmpzIiwiLi4vcHViL190ZW1wXy9tb2R1bGVzL3dlYXBvbi1maW5kZXIvd2VhcG9uLWZpbmRlci1zZXJ2aWNlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3cUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ2pMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM09BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDck1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvLyBHZW5lcmF0ZWQgYnkgTGl2ZVNjcmlwdCAxLjQuMFxudmFyIGFwcGx5LCBjdXJyeSwgZmxpcCwgZml4LCBvdmVyLCBtZW1vaXplLCBzbGljZSQgPSBbXS5zbGljZSwgdG9TdHJpbmckID0ge30udG9TdHJpbmc7XG5hcHBseSA9IGN1cnJ5JChmdW5jdGlvbihmLCBsaXN0KXtcbiAgcmV0dXJuIGYuYXBwbHkobnVsbCwgbGlzdCk7XG59KTtcbmN1cnJ5ID0gZnVuY3Rpb24oZil7XG4gIHJldHVybiBjdXJyeSQoZik7XG59O1xuZmxpcCA9IGN1cnJ5JChmdW5jdGlvbihmLCB4LCB5KXtcbiAgcmV0dXJuIGYoeSwgeCk7XG59KTtcbmZpeCA9IGZ1bmN0aW9uKGYpe1xuICByZXR1cm4gZnVuY3Rpb24oZyl7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gZihnKGcpKS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuICAgIH07XG4gIH0oZnVuY3Rpb24oZyl7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gZihnKGcpKS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuICAgIH07XG4gIH0pO1xufTtcbm92ZXIgPSBjdXJyeSQoZnVuY3Rpb24oZiwgZywgeCwgeSl7XG4gIHJldHVybiBmKGcoeCksIGcoeSkpO1xufSk7XG5tZW1vaXplID0gZnVuY3Rpb24oZil7XG4gIHZhciBtZW1vO1xuICBtZW1vID0ge307XG4gIHJldHVybiBmdW5jdGlvbigpe1xuICAgIHZhciBhcmdzLCBrZXksIGFyZztcbiAgICBhcmdzID0gc2xpY2UkLmNhbGwoYXJndW1lbnRzKTtcbiAgICBrZXkgPSAoZnVuY3Rpb24oKXtcbiAgICAgIHZhciBpJCwgcmVmJCwgbGVuJCwgcmVzdWx0cyQgPSBbXTtcbiAgICAgIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZiQgPSBhcmdzKS5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgICBhcmcgPSByZWYkW2kkXTtcbiAgICAgICAgcmVzdWx0cyQucHVzaChhcmcgKyB0b1N0cmluZyQuY2FsbChhcmcpLnNsaWNlKDgsIC0xKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0cyQ7XG4gICAgfSgpKS5qb2luKCcnKTtcbiAgICByZXR1cm4gbWVtb1trZXldID0ga2V5IGluIG1lbW9cbiAgICAgID8gbWVtb1trZXldXG4gICAgICA6IGYuYXBwbHkobnVsbCwgYXJncyk7XG4gIH07XG59O1xubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGN1cnJ5OiBjdXJyeSxcbiAgZmxpcDogZmxpcCxcbiAgZml4OiBmaXgsXG4gIGFwcGx5OiBhcHBseSxcbiAgb3Zlcjogb3ZlcixcbiAgbWVtb2l6ZTogbWVtb2l6ZVxufTtcbmZ1bmN0aW9uIGN1cnJ5JChmLCBib3VuZCl7XG4gIHZhciBjb250ZXh0LFxuICBfY3VycnkgPSBmdW5jdGlvbihhcmdzKSB7XG4gICAgcmV0dXJuIGYubGVuZ3RoID4gMSA/IGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgcGFyYW1zID0gYXJncyA/IGFyZ3MuY29uY2F0KCkgOiBbXTtcbiAgICAgIGNvbnRleHQgPSBib3VuZCA/IGNvbnRleHQgfHwgdGhpcyA6IHRoaXM7XG4gICAgICByZXR1cm4gcGFyYW1zLnB1c2guYXBwbHkocGFyYW1zLCBhcmd1bWVudHMpIDxcbiAgICAgICAgICBmLmxlbmd0aCAmJiBhcmd1bWVudHMubGVuZ3RoID9cbiAgICAgICAgX2N1cnJ5LmNhbGwoY29udGV4dCwgcGFyYW1zKSA6IGYuYXBwbHkoY29udGV4dCwgcGFyYW1zKTtcbiAgICB9IDogZjtcbiAgfTtcbiAgcmV0dXJuIF9jdXJyeSgpO1xufSIsIi8vIEdlbmVyYXRlZCBieSBMaXZlU2NyaXB0IDEuNC4wXG52YXIgZWFjaCwgbWFwLCBjb21wYWN0LCBmaWx0ZXIsIHJlamVjdCwgcGFydGl0aW9uLCBmaW5kLCBoZWFkLCBmaXJzdCwgdGFpbCwgbGFzdCwgaW5pdGlhbCwgZW1wdHksIHJldmVyc2UsIHVuaXF1ZSwgdW5pcXVlQnksIGZvbGQsIGZvbGRsLCBmb2xkMSwgZm9sZGwxLCBmb2xkciwgZm9sZHIxLCB1bmZvbGRyLCBjb25jYXQsIGNvbmNhdE1hcCwgZmxhdHRlbiwgZGlmZmVyZW5jZSwgaW50ZXJzZWN0aW9uLCB1bmlvbiwgY291bnRCeSwgZ3JvdXBCeSwgYW5kTGlzdCwgb3JMaXN0LCBhbnksIGFsbCwgc29ydCwgc29ydFdpdGgsIHNvcnRCeSwgc3VtLCBwcm9kdWN0LCBtZWFuLCBhdmVyYWdlLCBtYXhpbXVtLCBtaW5pbXVtLCBtYXhpbXVtQnksIG1pbmltdW1CeSwgc2Nhbiwgc2NhbmwsIHNjYW4xLCBzY2FubDEsIHNjYW5yLCBzY2FucjEsIHNsaWNlLCB0YWtlLCBkcm9wLCBzcGxpdEF0LCB0YWtlV2hpbGUsIGRyb3BXaGlsZSwgc3BhbiwgYnJlYWtMaXN0LCB6aXAsIHppcFdpdGgsIHppcEFsbCwgemlwQWxsV2l0aCwgYXQsIGVsZW1JbmRleCwgZWxlbUluZGljZXMsIGZpbmRJbmRleCwgZmluZEluZGljZXMsIHRvU3RyaW5nJCA9IHt9LnRvU3RyaW5nLCBzbGljZSQgPSBbXS5zbGljZTtcbmVhY2ggPSBjdXJyeSQoZnVuY3Rpb24oZiwgeHMpe1xuICB2YXIgaSQsIGxlbiQsIHg7XG4gIGZvciAoaSQgPSAwLCBsZW4kID0geHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICB4ID0geHNbaSRdO1xuICAgIGYoeCk7XG4gIH1cbiAgcmV0dXJuIHhzO1xufSk7XG5tYXAgPSBjdXJyeSQoZnVuY3Rpb24oZiwgeHMpe1xuICB2YXIgaSQsIGxlbiQsIHgsIHJlc3VsdHMkID0gW107XG4gIGZvciAoaSQgPSAwLCBsZW4kID0geHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICB4ID0geHNbaSRdO1xuICAgIHJlc3VsdHMkLnB1c2goZih4KSk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdHMkO1xufSk7XG5jb21wYWN0ID0gZnVuY3Rpb24oeHMpe1xuICB2YXIgaSQsIGxlbiQsIHgsIHJlc3VsdHMkID0gW107XG4gIGZvciAoaSQgPSAwLCBsZW4kID0geHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICB4ID0geHNbaSRdO1xuICAgIGlmICh4KSB7XG4gICAgICByZXN1bHRzJC5wdXNoKHgpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0cyQ7XG59O1xuZmlsdGVyID0gY3VycnkkKGZ1bmN0aW9uKGYsIHhzKXtcbiAgdmFyIGkkLCBsZW4kLCB4LCByZXN1bHRzJCA9IFtdO1xuICBmb3IgKGkkID0gMCwgbGVuJCA9IHhzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgeCA9IHhzW2kkXTtcbiAgICBpZiAoZih4KSkge1xuICAgICAgcmVzdWx0cyQucHVzaCh4KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdHMkO1xufSk7XG5yZWplY3QgPSBjdXJyeSQoZnVuY3Rpb24oZiwgeHMpe1xuICB2YXIgaSQsIGxlbiQsIHgsIHJlc3VsdHMkID0gW107XG4gIGZvciAoaSQgPSAwLCBsZW4kID0geHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICB4ID0geHNbaSRdO1xuICAgIGlmICghZih4KSkge1xuICAgICAgcmVzdWx0cyQucHVzaCh4KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdHMkO1xufSk7XG5wYXJ0aXRpb24gPSBjdXJyeSQoZnVuY3Rpb24oZiwgeHMpe1xuICB2YXIgcGFzc2VkLCBmYWlsZWQsIGkkLCBsZW4kLCB4O1xuICBwYXNzZWQgPSBbXTtcbiAgZmFpbGVkID0gW107XG4gIGZvciAoaSQgPSAwLCBsZW4kID0geHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICB4ID0geHNbaSRdO1xuICAgIChmKHgpID8gcGFzc2VkIDogZmFpbGVkKS5wdXNoKHgpO1xuICB9XG4gIHJldHVybiBbcGFzc2VkLCBmYWlsZWRdO1xufSk7XG5maW5kID0gY3VycnkkKGZ1bmN0aW9uKGYsIHhzKXtcbiAgdmFyIGkkLCBsZW4kLCB4O1xuICBmb3IgKGkkID0gMCwgbGVuJCA9IHhzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgeCA9IHhzW2kkXTtcbiAgICBpZiAoZih4KSkge1xuICAgICAgcmV0dXJuIHg7XG4gICAgfVxuICB9XG59KTtcbmhlYWQgPSBmaXJzdCA9IGZ1bmN0aW9uKHhzKXtcbiAgcmV0dXJuIHhzWzBdO1xufTtcbnRhaWwgPSBmdW5jdGlvbih4cyl7XG4gIGlmICgheHMubGVuZ3RoKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHJldHVybiB4cy5zbGljZSgxKTtcbn07XG5sYXN0ID0gZnVuY3Rpb24oeHMpe1xuICByZXR1cm4geHNbeHMubGVuZ3RoIC0gMV07XG59O1xuaW5pdGlhbCA9IGZ1bmN0aW9uKHhzKXtcbiAgaWYgKCF4cy5sZW5ndGgpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgcmV0dXJuIHhzLnNsaWNlKDAsIC0xKTtcbn07XG5lbXB0eSA9IGZ1bmN0aW9uKHhzKXtcbiAgcmV0dXJuICF4cy5sZW5ndGg7XG59O1xucmV2ZXJzZSA9IGZ1bmN0aW9uKHhzKXtcbiAgcmV0dXJuIHhzLmNvbmNhdCgpLnJldmVyc2UoKTtcbn07XG51bmlxdWUgPSBmdW5jdGlvbih4cyl7XG4gIHZhciByZXN1bHQsIGkkLCBsZW4kLCB4O1xuICByZXN1bHQgPSBbXTtcbiAgZm9yIChpJCA9IDAsIGxlbiQgPSB4cy5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgIHggPSB4c1tpJF07XG4gICAgaWYgKCFpbiQoeCwgcmVzdWx0KSkge1xuICAgICAgcmVzdWx0LnB1c2goeCk7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xudW5pcXVlQnkgPSBjdXJyeSQoZnVuY3Rpb24oZiwgeHMpe1xuICB2YXIgc2VlbiwgaSQsIGxlbiQsIHgsIHZhbCwgcmVzdWx0cyQgPSBbXTtcbiAgc2VlbiA9IFtdO1xuICBmb3IgKGkkID0gMCwgbGVuJCA9IHhzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgeCA9IHhzW2kkXTtcbiAgICB2YWwgPSBmKHgpO1xuICAgIGlmIChpbiQodmFsLCBzZWVuKSkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIHNlZW4ucHVzaCh2YWwpO1xuICAgIHJlc3VsdHMkLnB1c2goeCk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdHMkO1xufSk7XG5mb2xkID0gZm9sZGwgPSBjdXJyeSQoZnVuY3Rpb24oZiwgbWVtbywgeHMpe1xuICB2YXIgaSQsIGxlbiQsIHg7XG4gIGZvciAoaSQgPSAwLCBsZW4kID0geHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICB4ID0geHNbaSRdO1xuICAgIG1lbW8gPSBmKG1lbW8sIHgpO1xuICB9XG4gIHJldHVybiBtZW1vO1xufSk7XG5mb2xkMSA9IGZvbGRsMSA9IGN1cnJ5JChmdW5jdGlvbihmLCB4cyl7XG4gIHJldHVybiBmb2xkKGYsIHhzWzBdLCB4cy5zbGljZSgxKSk7XG59KTtcbmZvbGRyID0gY3VycnkkKGZ1bmN0aW9uKGYsIG1lbW8sIHhzKXtcbiAgdmFyIGkkLCB4O1xuICBmb3IgKGkkID0geHMubGVuZ3RoIC0gMTsgaSQgPj0gMDsgLS1pJCkge1xuICAgIHggPSB4c1tpJF07XG4gICAgbWVtbyA9IGYoeCwgbWVtbyk7XG4gIH1cbiAgcmV0dXJuIG1lbW87XG59KTtcbmZvbGRyMSA9IGN1cnJ5JChmdW5jdGlvbihmLCB4cyl7XG4gIHJldHVybiBmb2xkcihmLCB4c1t4cy5sZW5ndGggLSAxXSwgeHMuc2xpY2UoMCwgLTEpKTtcbn0pO1xudW5mb2xkciA9IGN1cnJ5JChmdW5jdGlvbihmLCBiKXtcbiAgdmFyIHJlc3VsdCwgeCwgdGhhdDtcbiAgcmVzdWx0ID0gW107XG4gIHggPSBiO1xuICB3aGlsZSAoKHRoYXQgPSBmKHgpKSAhPSBudWxsKSB7XG4gICAgcmVzdWx0LnB1c2godGhhdFswXSk7XG4gICAgeCA9IHRoYXRbMV07XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn0pO1xuY29uY2F0ID0gZnVuY3Rpb24oeHNzKXtcbiAgcmV0dXJuIFtdLmNvbmNhdC5hcHBseShbXSwgeHNzKTtcbn07XG5jb25jYXRNYXAgPSBjdXJyeSQoZnVuY3Rpb24oZiwgeHMpe1xuICB2YXIgeDtcbiAgcmV0dXJuIFtdLmNvbmNhdC5hcHBseShbXSwgKGZ1bmN0aW9uKCl7XG4gICAgdmFyIGkkLCByZWYkLCBsZW4kLCByZXN1bHRzJCA9IFtdO1xuICAgIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZiQgPSB4cykubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgIHggPSByZWYkW2kkXTtcbiAgICAgIHJlc3VsdHMkLnB1c2goZih4KSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzJDtcbiAgfSgpKSk7XG59KTtcbmZsYXR0ZW4gPSBmdW5jdGlvbih4cyl7XG4gIHZhciB4O1xuICByZXR1cm4gW10uY29uY2F0LmFwcGx5KFtdLCAoZnVuY3Rpb24oKXtcbiAgICB2YXIgaSQsIHJlZiQsIGxlbiQsIHJlc3VsdHMkID0gW107XG4gICAgZm9yIChpJCA9IDAsIGxlbiQgPSAocmVmJCA9IHhzKS5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgeCA9IHJlZiRbaSRdO1xuICAgICAgaWYgKHRvU3RyaW5nJC5jYWxsKHgpLnNsaWNlKDgsIC0xKSA9PT0gJ0FycmF5Jykge1xuICAgICAgICByZXN1bHRzJC5wdXNoKGZsYXR0ZW4oeCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0cyQucHVzaCh4KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdHMkO1xuICB9KCkpKTtcbn07XG5kaWZmZXJlbmNlID0gZnVuY3Rpb24oeHMpe1xuICB2YXIgeXNzLCByZXN1bHRzLCBpJCwgbGVuJCwgeCwgaiQsIGxlbjEkLCB5cztcbiAgeXNzID0gc2xpY2UkLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgcmVzdWx0cyA9IFtdO1xuICBvdXRlcjogZm9yIChpJCA9IDAsIGxlbiQgPSB4cy5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgIHggPSB4c1tpJF07XG4gICAgZm9yIChqJCA9IDAsIGxlbjEkID0geXNzLmxlbmd0aDsgaiQgPCBsZW4xJDsgKytqJCkge1xuICAgICAgeXMgPSB5c3NbaiRdO1xuICAgICAgaWYgKGluJCh4LCB5cykpIHtcbiAgICAgICAgY29udGludWUgb3V0ZXI7XG4gICAgICB9XG4gICAgfVxuICAgIHJlc3VsdHMucHVzaCh4KTtcbiAgfVxuICByZXR1cm4gcmVzdWx0cztcbn07XG5pbnRlcnNlY3Rpb24gPSBmdW5jdGlvbih4cyl7XG4gIHZhciB5c3MsIHJlc3VsdHMsIGkkLCBsZW4kLCB4LCBqJCwgbGVuMSQsIHlzO1xuICB5c3MgPSBzbGljZSQuY2FsbChhcmd1bWVudHMsIDEpO1xuICByZXN1bHRzID0gW107XG4gIG91dGVyOiBmb3IgKGkkID0gMCwgbGVuJCA9IHhzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgeCA9IHhzW2kkXTtcbiAgICBmb3IgKGokID0gMCwgbGVuMSQgPSB5c3MubGVuZ3RoOyBqJCA8IGxlbjEkOyArK2okKSB7XG4gICAgICB5cyA9IHlzc1tqJF07XG4gICAgICBpZiAoIWluJCh4LCB5cykpIHtcbiAgICAgICAgY29udGludWUgb3V0ZXI7XG4gICAgICB9XG4gICAgfVxuICAgIHJlc3VsdHMucHVzaCh4KTtcbiAgfVxuICByZXR1cm4gcmVzdWx0cztcbn07XG51bmlvbiA9IGZ1bmN0aW9uKCl7XG4gIHZhciB4c3MsIHJlc3VsdHMsIGkkLCBsZW4kLCB4cywgaiQsIGxlbjEkLCB4O1xuICB4c3MgPSBzbGljZSQuY2FsbChhcmd1bWVudHMpO1xuICByZXN1bHRzID0gW107XG4gIGZvciAoaSQgPSAwLCBsZW4kID0geHNzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgeHMgPSB4c3NbaSRdO1xuICAgIGZvciAoaiQgPSAwLCBsZW4xJCA9IHhzLmxlbmd0aDsgaiQgPCBsZW4xJDsgKytqJCkge1xuICAgICAgeCA9IHhzW2okXTtcbiAgICAgIGlmICghaW4kKHgsIHJlc3VsdHMpKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaCh4KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdHM7XG59O1xuY291bnRCeSA9IGN1cnJ5JChmdW5jdGlvbihmLCB4cyl7XG4gIHZhciByZXN1bHRzLCBpJCwgbGVuJCwgeCwga2V5O1xuICByZXN1bHRzID0ge307XG4gIGZvciAoaSQgPSAwLCBsZW4kID0geHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICB4ID0geHNbaSRdO1xuICAgIGtleSA9IGYoeCk7XG4gICAgaWYgKGtleSBpbiByZXN1bHRzKSB7XG4gICAgICByZXN1bHRzW2tleV0gKz0gMTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzdWx0c1trZXldID0gMTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdHM7XG59KTtcbmdyb3VwQnkgPSBjdXJyeSQoZnVuY3Rpb24oZiwgeHMpe1xuICB2YXIgcmVzdWx0cywgaSQsIGxlbiQsIHgsIGtleTtcbiAgcmVzdWx0cyA9IHt9O1xuICBmb3IgKGkkID0gMCwgbGVuJCA9IHhzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgeCA9IHhzW2kkXTtcbiAgICBrZXkgPSBmKHgpO1xuICAgIGlmIChrZXkgaW4gcmVzdWx0cykge1xuICAgICAgcmVzdWx0c1trZXldLnB1c2goeCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdHNba2V5XSA9IFt4XTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdHM7XG59KTtcbmFuZExpc3QgPSBmdW5jdGlvbih4cyl7XG4gIHZhciBpJCwgbGVuJCwgeDtcbiAgZm9yIChpJCA9IDAsIGxlbiQgPSB4cy5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgIHggPSB4c1tpJF07XG4gICAgaWYgKCF4KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufTtcbm9yTGlzdCA9IGZ1bmN0aW9uKHhzKXtcbiAgdmFyIGkkLCBsZW4kLCB4O1xuICBmb3IgKGkkID0gMCwgbGVuJCA9IHhzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgeCA9IHhzW2kkXTtcbiAgICBpZiAoeCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5hbnkgPSBjdXJyeSQoZnVuY3Rpb24oZiwgeHMpe1xuICB2YXIgaSQsIGxlbiQsIHg7XG4gIGZvciAoaSQgPSAwLCBsZW4kID0geHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICB4ID0geHNbaSRdO1xuICAgIGlmIChmKHgpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufSk7XG5hbGwgPSBjdXJyeSQoZnVuY3Rpb24oZiwgeHMpe1xuICB2YXIgaSQsIGxlbiQsIHg7XG4gIGZvciAoaSQgPSAwLCBsZW4kID0geHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICB4ID0geHNbaSRdO1xuICAgIGlmICghZih4KSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn0pO1xuc29ydCA9IGZ1bmN0aW9uKHhzKXtcbiAgcmV0dXJuIHhzLmNvbmNhdCgpLnNvcnQoZnVuY3Rpb24oeCwgeSl7XG4gICAgaWYgKHggPiB5KSB7XG4gICAgICByZXR1cm4gMTtcbiAgICB9IGVsc2UgaWYgKHggPCB5KSB7XG4gICAgICByZXR1cm4gLTE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfSk7XG59O1xuc29ydFdpdGggPSBjdXJyeSQoZnVuY3Rpb24oZiwgeHMpe1xuICByZXR1cm4geHMuY29uY2F0KCkuc29ydChmKTtcbn0pO1xuc29ydEJ5ID0gY3VycnkkKGZ1bmN0aW9uKGYsIHhzKXtcbiAgcmV0dXJuIHhzLmNvbmNhdCgpLnNvcnQoZnVuY3Rpb24oeCwgeSl7XG4gICAgaWYgKGYoeCkgPiBmKHkpKSB7XG4gICAgICByZXR1cm4gMTtcbiAgICB9IGVsc2UgaWYgKGYoeCkgPCBmKHkpKSB7XG4gICAgICByZXR1cm4gLTE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfSk7XG59KTtcbnN1bSA9IGZ1bmN0aW9uKHhzKXtcbiAgdmFyIHJlc3VsdCwgaSQsIGxlbiQsIHg7XG4gIHJlc3VsdCA9IDA7XG4gIGZvciAoaSQgPSAwLCBsZW4kID0geHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICB4ID0geHNbaSRdO1xuICAgIHJlc3VsdCArPSB4O1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xucHJvZHVjdCA9IGZ1bmN0aW9uKHhzKXtcbiAgdmFyIHJlc3VsdCwgaSQsIGxlbiQsIHg7XG4gIHJlc3VsdCA9IDE7XG4gIGZvciAoaSQgPSAwLCBsZW4kID0geHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICB4ID0geHNbaSRdO1xuICAgIHJlc3VsdCAqPSB4O1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xubWVhbiA9IGF2ZXJhZ2UgPSBmdW5jdGlvbih4cyl7XG4gIHZhciBzdW0sIGkkLCBsZW4kLCB4O1xuICBzdW0gPSAwO1xuICBmb3IgKGkkID0gMCwgbGVuJCA9IHhzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgeCA9IHhzW2kkXTtcbiAgICBzdW0gKz0geDtcbiAgfVxuICByZXR1cm4gc3VtIC8geHMubGVuZ3RoO1xufTtcbm1heGltdW0gPSBmdW5jdGlvbih4cyl7XG4gIHZhciBtYXgsIGkkLCByZWYkLCBsZW4kLCB4O1xuICBtYXggPSB4c1swXTtcbiAgZm9yIChpJCA9IDAsIGxlbiQgPSAocmVmJCA9IHhzLnNsaWNlKDEpKS5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgIHggPSByZWYkW2kkXTtcbiAgICBpZiAoeCA+IG1heCkge1xuICAgICAgbWF4ID0geDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG1heDtcbn07XG5taW5pbXVtID0gZnVuY3Rpb24oeHMpe1xuICB2YXIgbWluLCBpJCwgcmVmJCwgbGVuJCwgeDtcbiAgbWluID0geHNbMF07XG4gIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZiQgPSB4cy5zbGljZSgxKSkubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICB4ID0gcmVmJFtpJF07XG4gICAgaWYgKHggPCBtaW4pIHtcbiAgICAgIG1pbiA9IHg7XG4gICAgfVxuICB9XG4gIHJldHVybiBtaW47XG59O1xubWF4aW11bUJ5ID0gY3VycnkkKGZ1bmN0aW9uKGYsIHhzKXtcbiAgdmFyIG1heCwgaSQsIHJlZiQsIGxlbiQsIHg7XG4gIG1heCA9IHhzWzBdO1xuICBmb3IgKGkkID0gMCwgbGVuJCA9IChyZWYkID0geHMuc2xpY2UoMSkpLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgeCA9IHJlZiRbaSRdO1xuICAgIGlmIChmKHgpID4gZihtYXgpKSB7XG4gICAgICBtYXggPSB4O1xuICAgIH1cbiAgfVxuICByZXR1cm4gbWF4O1xufSk7XG5taW5pbXVtQnkgPSBjdXJyeSQoZnVuY3Rpb24oZiwgeHMpe1xuICB2YXIgbWluLCBpJCwgcmVmJCwgbGVuJCwgeDtcbiAgbWluID0geHNbMF07XG4gIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZiQgPSB4cy5zbGljZSgxKSkubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICB4ID0gcmVmJFtpJF07XG4gICAgaWYgKGYoeCkgPCBmKG1pbikpIHtcbiAgICAgIG1pbiA9IHg7XG4gICAgfVxuICB9XG4gIHJldHVybiBtaW47XG59KTtcbnNjYW4gPSBzY2FubCA9IGN1cnJ5JChmdW5jdGlvbihmLCBtZW1vLCB4cyl7XG4gIHZhciBsYXN0LCB4O1xuICBsYXN0ID0gbWVtbztcbiAgcmV0dXJuIFttZW1vXS5jb25jYXQoKGZ1bmN0aW9uKCl7XG4gICAgdmFyIGkkLCByZWYkLCBsZW4kLCByZXN1bHRzJCA9IFtdO1xuICAgIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZiQgPSB4cykubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgIHggPSByZWYkW2kkXTtcbiAgICAgIHJlc3VsdHMkLnB1c2gobGFzdCA9IGYobGFzdCwgeCkpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0cyQ7XG4gIH0oKSkpO1xufSk7XG5zY2FuMSA9IHNjYW5sMSA9IGN1cnJ5JChmdW5jdGlvbihmLCB4cyl7XG4gIGlmICgheHMubGVuZ3RoKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHJldHVybiBzY2FuKGYsIHhzWzBdLCB4cy5zbGljZSgxKSk7XG59KTtcbnNjYW5yID0gY3VycnkkKGZ1bmN0aW9uKGYsIG1lbW8sIHhzKXtcbiAgeHMgPSB4cy5jb25jYXQoKS5yZXZlcnNlKCk7XG4gIHJldHVybiBzY2FuKGYsIG1lbW8sIHhzKS5yZXZlcnNlKCk7XG59KTtcbnNjYW5yMSA9IGN1cnJ5JChmdW5jdGlvbihmLCB4cyl7XG4gIGlmICgheHMubGVuZ3RoKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHhzID0geHMuY29uY2F0KCkucmV2ZXJzZSgpO1xuICByZXR1cm4gc2NhbihmLCB4c1swXSwgeHMuc2xpY2UoMSkpLnJldmVyc2UoKTtcbn0pO1xuc2xpY2UgPSBjdXJyeSQoZnVuY3Rpb24oeCwgeSwgeHMpe1xuICByZXR1cm4geHMuc2xpY2UoeCwgeSk7XG59KTtcbnRha2UgPSBjdXJyeSQoZnVuY3Rpb24obiwgeHMpe1xuICBpZiAobiA8PSAwKSB7XG4gICAgcmV0dXJuIHhzLnNsaWNlKDAsIDApO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB4cy5zbGljZSgwLCBuKTtcbiAgfVxufSk7XG5kcm9wID0gY3VycnkkKGZ1bmN0aW9uKG4sIHhzKXtcbiAgaWYgKG4gPD0gMCkge1xuICAgIHJldHVybiB4cztcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4geHMuc2xpY2Uobik7XG4gIH1cbn0pO1xuc3BsaXRBdCA9IGN1cnJ5JChmdW5jdGlvbihuLCB4cyl7XG4gIHJldHVybiBbdGFrZShuLCB4cyksIGRyb3AobiwgeHMpXTtcbn0pO1xudGFrZVdoaWxlID0gY3VycnkkKGZ1bmN0aW9uKHAsIHhzKXtcbiAgdmFyIGxlbiwgaTtcbiAgbGVuID0geHMubGVuZ3RoO1xuICBpZiAoIWxlbikge1xuICAgIHJldHVybiB4cztcbiAgfVxuICBpID0gMDtcbiAgd2hpbGUgKGkgPCBsZW4gJiYgcCh4c1tpXSkpIHtcbiAgICBpICs9IDE7XG4gIH1cbiAgcmV0dXJuIHhzLnNsaWNlKDAsIGkpO1xufSk7XG5kcm9wV2hpbGUgPSBjdXJyeSQoZnVuY3Rpb24ocCwgeHMpe1xuICB2YXIgbGVuLCBpO1xuICBsZW4gPSB4cy5sZW5ndGg7XG4gIGlmICghbGVuKSB7XG4gICAgcmV0dXJuIHhzO1xuICB9XG4gIGkgPSAwO1xuICB3aGlsZSAoaSA8IGxlbiAmJiBwKHhzW2ldKSkge1xuICAgIGkgKz0gMTtcbiAgfVxuICByZXR1cm4geHMuc2xpY2UoaSk7XG59KTtcbnNwYW4gPSBjdXJyeSQoZnVuY3Rpb24ocCwgeHMpe1xuICByZXR1cm4gW3Rha2VXaGlsZShwLCB4cyksIGRyb3BXaGlsZShwLCB4cyldO1xufSk7XG5icmVha0xpc3QgPSBjdXJyeSQoZnVuY3Rpb24ocCwgeHMpe1xuICByZXR1cm4gc3Bhbihjb21wb3NlJChwLCBub3QkKSwgeHMpO1xufSk7XG56aXAgPSBjdXJyeSQoZnVuY3Rpb24oeHMsIHlzKXtcbiAgdmFyIHJlc3VsdCwgbGVuLCBpJCwgbGVuJCwgaSwgeDtcbiAgcmVzdWx0ID0gW107XG4gIGxlbiA9IHlzLmxlbmd0aDtcbiAgZm9yIChpJCA9IDAsIGxlbiQgPSB4cy5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgIGkgPSBpJDtcbiAgICB4ID0geHNbaSRdO1xuICAgIGlmIChpID09PSBsZW4pIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXN1bHQucHVzaChbeCwgeXNbaV1dKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufSk7XG56aXBXaXRoID0gY3VycnkkKGZ1bmN0aW9uKGYsIHhzLCB5cyl7XG4gIHZhciByZXN1bHQsIGxlbiwgaSQsIGxlbiQsIGksIHg7XG4gIHJlc3VsdCA9IFtdO1xuICBsZW4gPSB5cy5sZW5ndGg7XG4gIGZvciAoaSQgPSAwLCBsZW4kID0geHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICBpID0gaSQ7XG4gICAgeCA9IHhzW2kkXTtcbiAgICBpZiAoaSA9PT0gbGVuKSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgcmVzdWx0LnB1c2goZih4LCB5c1tpXSkpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59KTtcbnppcEFsbCA9IGZ1bmN0aW9uKCl7XG4gIHZhciB4c3MsIG1pbkxlbmd0aCwgaSQsIGxlbiQsIHhzLCByZWYkLCBpLCBscmVzdWx0JCwgaiQsIHJlc3VsdHMkID0gW107XG4gIHhzcyA9IHNsaWNlJC5jYWxsKGFyZ3VtZW50cyk7XG4gIG1pbkxlbmd0aCA9IHVuZGVmaW5lZDtcbiAgZm9yIChpJCA9IDAsIGxlbiQgPSB4c3MubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICB4cyA9IHhzc1tpJF07XG4gICAgbWluTGVuZ3RoIDw9IChyZWYkID0geHMubGVuZ3RoKSB8fCAobWluTGVuZ3RoID0gcmVmJCk7XG4gIH1cbiAgZm9yIChpJCA9IDA7IGkkIDwgbWluTGVuZ3RoOyArK2kkKSB7XG4gICAgaSA9IGkkO1xuICAgIGxyZXN1bHQkID0gW107XG4gICAgZm9yIChqJCA9IDAsIGxlbiQgPSB4c3MubGVuZ3RoOyBqJCA8IGxlbiQ7ICsraiQpIHtcbiAgICAgIHhzID0geHNzW2okXTtcbiAgICAgIGxyZXN1bHQkLnB1c2goeHNbaV0pO1xuICAgIH1cbiAgICByZXN1bHRzJC5wdXNoKGxyZXN1bHQkKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0cyQ7XG59O1xuemlwQWxsV2l0aCA9IGZ1bmN0aW9uKGYpe1xuICB2YXIgeHNzLCBtaW5MZW5ndGgsIGkkLCBsZW4kLCB4cywgcmVmJCwgaSwgcmVzdWx0cyQgPSBbXTtcbiAgeHNzID0gc2xpY2UkLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgbWluTGVuZ3RoID0gdW5kZWZpbmVkO1xuICBmb3IgKGkkID0gMCwgbGVuJCA9IHhzcy5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgIHhzID0geHNzW2kkXTtcbiAgICBtaW5MZW5ndGggPD0gKHJlZiQgPSB4cy5sZW5ndGgpIHx8IChtaW5MZW5ndGggPSByZWYkKTtcbiAgfVxuICBmb3IgKGkkID0gMDsgaSQgPCBtaW5MZW5ndGg7ICsraSQpIHtcbiAgICBpID0gaSQ7XG4gICAgcmVzdWx0cyQucHVzaChmLmFwcGx5KG51bGwsIChmbiQoKSkpKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0cyQ7XG4gIGZ1bmN0aW9uIGZuJCgpe1xuICAgIHZhciBpJCwgcmVmJCwgbGVuJCwgcmVzdWx0cyQgPSBbXTtcbiAgICBmb3IgKGkkID0gMCwgbGVuJCA9IChyZWYkID0geHNzKS5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgeHMgPSByZWYkW2kkXTtcbiAgICAgIHJlc3VsdHMkLnB1c2goeHNbaV0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0cyQ7XG4gIH1cbn07XG5hdCA9IGN1cnJ5JChmdW5jdGlvbihuLCB4cyl7XG4gIGlmIChuIDwgMCkge1xuICAgIHJldHVybiB4c1t4cy5sZW5ndGggKyBuXTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4geHNbbl07XG4gIH1cbn0pO1xuZWxlbUluZGV4ID0gY3VycnkkKGZ1bmN0aW9uKGVsLCB4cyl7XG4gIHZhciBpJCwgbGVuJCwgaSwgeDtcbiAgZm9yIChpJCA9IDAsIGxlbiQgPSB4cy5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgIGkgPSBpJDtcbiAgICB4ID0geHNbaSRdO1xuICAgIGlmICh4ID09PSBlbCkge1xuICAgICAgcmV0dXJuIGk7XG4gICAgfVxuICB9XG59KTtcbmVsZW1JbmRpY2VzID0gY3VycnkkKGZ1bmN0aW9uKGVsLCB4cyl7XG4gIHZhciBpJCwgbGVuJCwgaSwgeCwgcmVzdWx0cyQgPSBbXTtcbiAgZm9yIChpJCA9IDAsIGxlbiQgPSB4cy5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgIGkgPSBpJDtcbiAgICB4ID0geHNbaSRdO1xuICAgIGlmICh4ID09PSBlbCkge1xuICAgICAgcmVzdWx0cyQucHVzaChpKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdHMkO1xufSk7XG5maW5kSW5kZXggPSBjdXJyeSQoZnVuY3Rpb24oZiwgeHMpe1xuICB2YXIgaSQsIGxlbiQsIGksIHg7XG4gIGZvciAoaSQgPSAwLCBsZW4kID0geHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICBpID0gaSQ7XG4gICAgeCA9IHhzW2kkXTtcbiAgICBpZiAoZih4KSkge1xuICAgICAgcmV0dXJuIGk7XG4gICAgfVxuICB9XG59KTtcbmZpbmRJbmRpY2VzID0gY3VycnkkKGZ1bmN0aW9uKGYsIHhzKXtcbiAgdmFyIGkkLCBsZW4kLCBpLCB4LCByZXN1bHRzJCA9IFtdO1xuICBmb3IgKGkkID0gMCwgbGVuJCA9IHhzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgaSA9IGkkO1xuICAgIHggPSB4c1tpJF07XG4gICAgaWYgKGYoeCkpIHtcbiAgICAgIHJlc3VsdHMkLnB1c2goaSk7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHRzJDtcbn0pO1xubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGVhY2g6IGVhY2gsXG4gIG1hcDogbWFwLFxuICBmaWx0ZXI6IGZpbHRlcixcbiAgY29tcGFjdDogY29tcGFjdCxcbiAgcmVqZWN0OiByZWplY3QsXG4gIHBhcnRpdGlvbjogcGFydGl0aW9uLFxuICBmaW5kOiBmaW5kLFxuICBoZWFkOiBoZWFkLFxuICBmaXJzdDogZmlyc3QsXG4gIHRhaWw6IHRhaWwsXG4gIGxhc3Q6IGxhc3QsXG4gIGluaXRpYWw6IGluaXRpYWwsXG4gIGVtcHR5OiBlbXB0eSxcbiAgcmV2ZXJzZTogcmV2ZXJzZSxcbiAgZGlmZmVyZW5jZTogZGlmZmVyZW5jZSxcbiAgaW50ZXJzZWN0aW9uOiBpbnRlcnNlY3Rpb24sXG4gIHVuaW9uOiB1bmlvbixcbiAgY291bnRCeTogY291bnRCeSxcbiAgZ3JvdXBCeTogZ3JvdXBCeSxcbiAgZm9sZDogZm9sZCxcbiAgZm9sZDE6IGZvbGQxLFxuICBmb2xkbDogZm9sZGwsXG4gIGZvbGRsMTogZm9sZGwxLFxuICBmb2xkcjogZm9sZHIsXG4gIGZvbGRyMTogZm9sZHIxLFxuICB1bmZvbGRyOiB1bmZvbGRyLFxuICBhbmRMaXN0OiBhbmRMaXN0LFxuICBvckxpc3Q6IG9yTGlzdCxcbiAgYW55OiBhbnksXG4gIGFsbDogYWxsLFxuICB1bmlxdWU6IHVuaXF1ZSxcbiAgdW5pcXVlQnk6IHVuaXF1ZUJ5LFxuICBzb3J0OiBzb3J0LFxuICBzb3J0V2l0aDogc29ydFdpdGgsXG4gIHNvcnRCeTogc29ydEJ5LFxuICBzdW06IHN1bSxcbiAgcHJvZHVjdDogcHJvZHVjdCxcbiAgbWVhbjogbWVhbixcbiAgYXZlcmFnZTogYXZlcmFnZSxcbiAgY29uY2F0OiBjb25jYXQsXG4gIGNvbmNhdE1hcDogY29uY2F0TWFwLFxuICBmbGF0dGVuOiBmbGF0dGVuLFxuICBtYXhpbXVtOiBtYXhpbXVtLFxuICBtaW5pbXVtOiBtaW5pbXVtLFxuICBtYXhpbXVtQnk6IG1heGltdW1CeSxcbiAgbWluaW11bUJ5OiBtaW5pbXVtQnksXG4gIHNjYW46IHNjYW4sXG4gIHNjYW4xOiBzY2FuMSxcbiAgc2Nhbmw6IHNjYW5sLFxuICBzY2FubDE6IHNjYW5sMSxcbiAgc2NhbnI6IHNjYW5yLFxuICBzY2FucjE6IHNjYW5yMSxcbiAgc2xpY2U6IHNsaWNlLFxuICB0YWtlOiB0YWtlLFxuICBkcm9wOiBkcm9wLFxuICBzcGxpdEF0OiBzcGxpdEF0LFxuICB0YWtlV2hpbGU6IHRha2VXaGlsZSxcbiAgZHJvcFdoaWxlOiBkcm9wV2hpbGUsXG4gIHNwYW46IHNwYW4sXG4gIGJyZWFrTGlzdDogYnJlYWtMaXN0LFxuICB6aXA6IHppcCxcbiAgemlwV2l0aDogemlwV2l0aCxcbiAgemlwQWxsOiB6aXBBbGwsXG4gIHppcEFsbFdpdGg6IHppcEFsbFdpdGgsXG4gIGF0OiBhdCxcbiAgZWxlbUluZGV4OiBlbGVtSW5kZXgsXG4gIGVsZW1JbmRpY2VzOiBlbGVtSW5kaWNlcyxcbiAgZmluZEluZGV4OiBmaW5kSW5kZXgsXG4gIGZpbmRJbmRpY2VzOiBmaW5kSW5kaWNlc1xufTtcbmZ1bmN0aW9uIGN1cnJ5JChmLCBib3VuZCl7XG4gIHZhciBjb250ZXh0LFxuICBfY3VycnkgPSBmdW5jdGlvbihhcmdzKSB7XG4gICAgcmV0dXJuIGYubGVuZ3RoID4gMSA/IGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgcGFyYW1zID0gYXJncyA/IGFyZ3MuY29uY2F0KCkgOiBbXTtcbiAgICAgIGNvbnRleHQgPSBib3VuZCA/IGNvbnRleHQgfHwgdGhpcyA6IHRoaXM7XG4gICAgICByZXR1cm4gcGFyYW1zLnB1c2guYXBwbHkocGFyYW1zLCBhcmd1bWVudHMpIDxcbiAgICAgICAgICBmLmxlbmd0aCAmJiBhcmd1bWVudHMubGVuZ3RoID9cbiAgICAgICAgX2N1cnJ5LmNhbGwoY29udGV4dCwgcGFyYW1zKSA6IGYuYXBwbHkoY29udGV4dCwgcGFyYW1zKTtcbiAgICB9IDogZjtcbiAgfTtcbiAgcmV0dXJuIF9jdXJyeSgpO1xufVxuZnVuY3Rpb24gaW4kKHgsIHhzKXtcbiAgdmFyIGkgPSAtMSwgbCA9IHhzLmxlbmd0aCA+Pj4gMDtcbiAgd2hpbGUgKCsraSA8IGwpIGlmICh4ID09PSB4c1tpXSkgcmV0dXJuIHRydWU7XG4gIHJldHVybiBmYWxzZTtcbn1cbmZ1bmN0aW9uIGNvbXBvc2UkKCkge1xuICB2YXIgZnVuY3Rpb25zID0gYXJndW1lbnRzO1xuICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGksIHJlc3VsdDtcbiAgICByZXN1bHQgPSBmdW5jdGlvbnNbMF0uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICBmb3IgKGkgPSAxOyBpIDwgZnVuY3Rpb25zLmxlbmd0aDsgKytpKSB7XG4gICAgICByZXN1bHQgPSBmdW5jdGlvbnNbaV0ocmVzdWx0KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbn1cbmZ1bmN0aW9uIG5vdCQoeCl7IHJldHVybiAheDsgfSIsIi8vIEdlbmVyYXRlZCBieSBMaXZlU2NyaXB0IDEuNC4wXG52YXIgbWF4LCBtaW4sIG5lZ2F0ZSwgYWJzLCBzaWdudW0sIHF1b3QsIHJlbSwgZGl2LCBtb2QsIHJlY2lwLCBwaSwgdGF1LCBleHAsIHNxcnQsIGxuLCBwb3csIHNpbiwgdGFuLCBjb3MsIGFzaW4sIGFjb3MsIGF0YW4sIGF0YW4yLCB0cnVuY2F0ZSwgcm91bmQsIGNlaWxpbmcsIGZsb29yLCBpc0l0TmFOLCBldmVuLCBvZGQsIGdjZCwgbGNtO1xubWF4ID0gY3VycnkkKGZ1bmN0aW9uKHgkLCB5JCl7XG4gIHJldHVybiB4JCA+IHkkID8geCQgOiB5JDtcbn0pO1xubWluID0gY3VycnkkKGZ1bmN0aW9uKHgkLCB5JCl7XG4gIHJldHVybiB4JCA8IHkkID8geCQgOiB5JDtcbn0pO1xubmVnYXRlID0gZnVuY3Rpb24oeCl7XG4gIHJldHVybiAteDtcbn07XG5hYnMgPSBNYXRoLmFicztcbnNpZ251bSA9IGZ1bmN0aW9uKHgpe1xuICBpZiAoeCA8IDApIHtcbiAgICByZXR1cm4gLTE7XG4gIH0gZWxzZSBpZiAoeCA+IDApIHtcbiAgICByZXR1cm4gMTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gMDtcbiAgfVxufTtcbnF1b3QgPSBjdXJyeSQoZnVuY3Rpb24oeCwgeSl7XG4gIHJldHVybiB+fih4IC8geSk7XG59KTtcbnJlbSA9IGN1cnJ5JChmdW5jdGlvbih4JCwgeSQpe1xuICByZXR1cm4geCQgJSB5JDtcbn0pO1xuZGl2ID0gY3VycnkkKGZ1bmN0aW9uKHgsIHkpe1xuICByZXR1cm4gTWF0aC5mbG9vcih4IC8geSk7XG59KTtcbm1vZCA9IGN1cnJ5JChmdW5jdGlvbih4JCwgeSQpe1xuICB2YXIgcmVmJDtcbiAgcmV0dXJuICgoKHgkKSAlIChyZWYkID0geSQpICsgcmVmJCkgJSByZWYkKTtcbn0pO1xucmVjaXAgPSAoZnVuY3Rpb24oaXQpe1xuICByZXR1cm4gMSAvIGl0O1xufSk7XG5waSA9IE1hdGguUEk7XG50YXUgPSBwaSAqIDI7XG5leHAgPSBNYXRoLmV4cDtcbnNxcnQgPSBNYXRoLnNxcnQ7XG5sbiA9IE1hdGgubG9nO1xucG93ID0gY3VycnkkKGZ1bmN0aW9uKHgkLCB5JCl7XG4gIHJldHVybiBNYXRoLnBvdyh4JCwgeSQpO1xufSk7XG5zaW4gPSBNYXRoLnNpbjtcbnRhbiA9IE1hdGgudGFuO1xuY29zID0gTWF0aC5jb3M7XG5hc2luID0gTWF0aC5hc2luO1xuYWNvcyA9IE1hdGguYWNvcztcbmF0YW4gPSBNYXRoLmF0YW47XG5hdGFuMiA9IGN1cnJ5JChmdW5jdGlvbih4LCB5KXtcbiAgcmV0dXJuIE1hdGguYXRhbjIoeCwgeSk7XG59KTtcbnRydW5jYXRlID0gZnVuY3Rpb24oeCl7XG4gIHJldHVybiB+fng7XG59O1xucm91bmQgPSBNYXRoLnJvdW5kO1xuY2VpbGluZyA9IE1hdGguY2VpbDtcbmZsb29yID0gTWF0aC5mbG9vcjtcbmlzSXROYU4gPSBmdW5jdGlvbih4KXtcbiAgcmV0dXJuIHggIT09IHg7XG59O1xuZXZlbiA9IGZ1bmN0aW9uKHgpe1xuICByZXR1cm4geCAlIDIgPT09IDA7XG59O1xub2RkID0gZnVuY3Rpb24oeCl7XG4gIHJldHVybiB4ICUgMiAhPT0gMDtcbn07XG5nY2QgPSBjdXJyeSQoZnVuY3Rpb24oeCwgeSl7XG4gIHZhciB6O1xuICB4ID0gTWF0aC5hYnMoeCk7XG4gIHkgPSBNYXRoLmFicyh5KTtcbiAgd2hpbGUgKHkgIT09IDApIHtcbiAgICB6ID0geCAlIHk7XG4gICAgeCA9IHk7XG4gICAgeSA9IHo7XG4gIH1cbiAgcmV0dXJuIHg7XG59KTtcbmxjbSA9IGN1cnJ5JChmdW5jdGlvbih4LCB5KXtcbiAgcmV0dXJuIE1hdGguYWJzKE1hdGguZmxvb3IoeCAvIGdjZCh4LCB5KSAqIHkpKTtcbn0pO1xubW9kdWxlLmV4cG9ydHMgPSB7XG4gIG1heDogbWF4LFxuICBtaW46IG1pbixcbiAgbmVnYXRlOiBuZWdhdGUsXG4gIGFiczogYWJzLFxuICBzaWdudW06IHNpZ251bSxcbiAgcXVvdDogcXVvdCxcbiAgcmVtOiByZW0sXG4gIGRpdjogZGl2LFxuICBtb2Q6IG1vZCxcbiAgcmVjaXA6IHJlY2lwLFxuICBwaTogcGksXG4gIHRhdTogdGF1LFxuICBleHA6IGV4cCxcbiAgc3FydDogc3FydCxcbiAgbG46IGxuLFxuICBwb3c6IHBvdyxcbiAgc2luOiBzaW4sXG4gIHRhbjogdGFuLFxuICBjb3M6IGNvcyxcbiAgYWNvczogYWNvcyxcbiAgYXNpbjogYXNpbixcbiAgYXRhbjogYXRhbixcbiAgYXRhbjI6IGF0YW4yLFxuICB0cnVuY2F0ZTogdHJ1bmNhdGUsXG4gIHJvdW5kOiByb3VuZCxcbiAgY2VpbGluZzogY2VpbGluZyxcbiAgZmxvb3I6IGZsb29yLFxuICBpc0l0TmFOOiBpc0l0TmFOLFxuICBldmVuOiBldmVuLFxuICBvZGQ6IG9kZCxcbiAgZ2NkOiBnY2QsXG4gIGxjbTogbGNtXG59O1xuZnVuY3Rpb24gY3VycnkkKGYsIGJvdW5kKXtcbiAgdmFyIGNvbnRleHQsXG4gIF9jdXJyeSA9IGZ1bmN0aW9uKGFyZ3MpIHtcbiAgICByZXR1cm4gZi5sZW5ndGggPiAxID8gZnVuY3Rpb24oKXtcbiAgICAgIHZhciBwYXJhbXMgPSBhcmdzID8gYXJncy5jb25jYXQoKSA6IFtdO1xuICAgICAgY29udGV4dCA9IGJvdW5kID8gY29udGV4dCB8fCB0aGlzIDogdGhpcztcbiAgICAgIHJldHVybiBwYXJhbXMucHVzaC5hcHBseShwYXJhbXMsIGFyZ3VtZW50cykgPFxuICAgICAgICAgIGYubGVuZ3RoICYmIGFyZ3VtZW50cy5sZW5ndGggP1xuICAgICAgICBfY3VycnkuY2FsbChjb250ZXh0LCBwYXJhbXMpIDogZi5hcHBseShjb250ZXh0LCBwYXJhbXMpO1xuICAgIH0gOiBmO1xuICB9O1xuICByZXR1cm4gX2N1cnJ5KCk7XG59IiwiLy8gR2VuZXJhdGVkIGJ5IExpdmVTY3JpcHQgMS40LjBcbnZhciB2YWx1ZXMsIGtleXMsIHBhaXJzVG9PYmosIG9ialRvUGFpcnMsIGxpc3RzVG9PYmosIG9ialRvTGlzdHMsIGVtcHR5LCBlYWNoLCBtYXAsIGNvbXBhY3QsIGZpbHRlciwgcmVqZWN0LCBwYXJ0aXRpb24sIGZpbmQ7XG52YWx1ZXMgPSBmdW5jdGlvbihvYmplY3Qpe1xuICB2YXIgaSQsIHgsIHJlc3VsdHMkID0gW107XG4gIGZvciAoaSQgaW4gb2JqZWN0KSB7XG4gICAgeCA9IG9iamVjdFtpJF07XG4gICAgcmVzdWx0cyQucHVzaCh4KTtcbiAgfVxuICByZXR1cm4gcmVzdWx0cyQ7XG59O1xua2V5cyA9IGZ1bmN0aW9uKG9iamVjdCl7XG4gIHZhciB4LCByZXN1bHRzJCA9IFtdO1xuICBmb3IgKHggaW4gb2JqZWN0KSB7XG4gICAgcmVzdWx0cyQucHVzaCh4KTtcbiAgfVxuICByZXR1cm4gcmVzdWx0cyQ7XG59O1xucGFpcnNUb09iaiA9IGZ1bmN0aW9uKG9iamVjdCl7XG4gIHZhciBpJCwgbGVuJCwgeCwgcmVzdWx0T2JqJCA9IHt9O1xuICBmb3IgKGkkID0gMCwgbGVuJCA9IG9iamVjdC5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgIHggPSBvYmplY3RbaSRdO1xuICAgIHJlc3VsdE9iaiRbeFswXV0gPSB4WzFdO1xuICB9XG4gIHJldHVybiByZXN1bHRPYmokO1xufTtcbm9ialRvUGFpcnMgPSBmdW5jdGlvbihvYmplY3Qpe1xuICB2YXIga2V5LCB2YWx1ZSwgcmVzdWx0cyQgPSBbXTtcbiAgZm9yIChrZXkgaW4gb2JqZWN0KSB7XG4gICAgdmFsdWUgPSBvYmplY3Rba2V5XTtcbiAgICByZXN1bHRzJC5wdXNoKFtrZXksIHZhbHVlXSk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdHMkO1xufTtcbmxpc3RzVG9PYmogPSBjdXJyeSQoZnVuY3Rpb24oa2V5cywgdmFsdWVzKXtcbiAgdmFyIGkkLCBsZW4kLCBpLCBrZXksIHJlc3VsdE9iaiQgPSB7fTtcbiAgZm9yIChpJCA9IDAsIGxlbiQgPSBrZXlzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgaSA9IGkkO1xuICAgIGtleSA9IGtleXNbaSRdO1xuICAgIHJlc3VsdE9iaiRba2V5XSA9IHZhbHVlc1tpXTtcbiAgfVxuICByZXR1cm4gcmVzdWx0T2JqJDtcbn0pO1xub2JqVG9MaXN0cyA9IGZ1bmN0aW9uKG9iamVjdCl7XG4gIHZhciBrZXlzLCB2YWx1ZXMsIGtleSwgdmFsdWU7XG4gIGtleXMgPSBbXTtcbiAgdmFsdWVzID0gW107XG4gIGZvciAoa2V5IGluIG9iamVjdCkge1xuICAgIHZhbHVlID0gb2JqZWN0W2tleV07XG4gICAga2V5cy5wdXNoKGtleSk7XG4gICAgdmFsdWVzLnB1c2godmFsdWUpO1xuICB9XG4gIHJldHVybiBba2V5cywgdmFsdWVzXTtcbn07XG5lbXB0eSA9IGZ1bmN0aW9uKG9iamVjdCl7XG4gIHZhciB4O1xuICBmb3IgKHggaW4gb2JqZWN0KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiB0cnVlO1xufTtcbmVhY2ggPSBjdXJyeSQoZnVuY3Rpb24oZiwgb2JqZWN0KXtcbiAgdmFyIGkkLCB4O1xuICBmb3IgKGkkIGluIG9iamVjdCkge1xuICAgIHggPSBvYmplY3RbaSRdO1xuICAgIGYoeCk7XG4gIH1cbiAgcmV0dXJuIG9iamVjdDtcbn0pO1xubWFwID0gY3VycnkkKGZ1bmN0aW9uKGYsIG9iamVjdCl7XG4gIHZhciBrLCB4LCByZXN1bHRPYmokID0ge307XG4gIGZvciAoayBpbiBvYmplY3QpIHtcbiAgICB4ID0gb2JqZWN0W2tdO1xuICAgIHJlc3VsdE9iaiRba10gPSBmKHgpO1xuICB9XG4gIHJldHVybiByZXN1bHRPYmokO1xufSk7XG5jb21wYWN0ID0gZnVuY3Rpb24ob2JqZWN0KXtcbiAgdmFyIGssIHgsIHJlc3VsdE9iaiQgPSB7fTtcbiAgZm9yIChrIGluIG9iamVjdCkge1xuICAgIHggPSBvYmplY3Rba107XG4gICAgaWYgKHgpIHtcbiAgICAgIHJlc3VsdE9iaiRba10gPSB4O1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0T2JqJDtcbn07XG5maWx0ZXIgPSBjdXJyeSQoZnVuY3Rpb24oZiwgb2JqZWN0KXtcbiAgdmFyIGssIHgsIHJlc3VsdE9iaiQgPSB7fTtcbiAgZm9yIChrIGluIG9iamVjdCkge1xuICAgIHggPSBvYmplY3Rba107XG4gICAgaWYgKGYoeCkpIHtcbiAgICAgIHJlc3VsdE9iaiRba10gPSB4O1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0T2JqJDtcbn0pO1xucmVqZWN0ID0gY3VycnkkKGZ1bmN0aW9uKGYsIG9iamVjdCl7XG4gIHZhciBrLCB4LCByZXN1bHRPYmokID0ge307XG4gIGZvciAoayBpbiBvYmplY3QpIHtcbiAgICB4ID0gb2JqZWN0W2tdO1xuICAgIGlmICghZih4KSkge1xuICAgICAgcmVzdWx0T2JqJFtrXSA9IHg7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHRPYmokO1xufSk7XG5wYXJ0aXRpb24gPSBjdXJyeSQoZnVuY3Rpb24oZiwgb2JqZWN0KXtcbiAgdmFyIHBhc3NlZCwgZmFpbGVkLCBrLCB4O1xuICBwYXNzZWQgPSB7fTtcbiAgZmFpbGVkID0ge307XG4gIGZvciAoayBpbiBvYmplY3QpIHtcbiAgICB4ID0gb2JqZWN0W2tdO1xuICAgIChmKHgpID8gcGFzc2VkIDogZmFpbGVkKVtrXSA9IHg7XG4gIH1cbiAgcmV0dXJuIFtwYXNzZWQsIGZhaWxlZF07XG59KTtcbmZpbmQgPSBjdXJyeSQoZnVuY3Rpb24oZiwgb2JqZWN0KXtcbiAgdmFyIGkkLCB4O1xuICBmb3IgKGkkIGluIG9iamVjdCkge1xuICAgIHggPSBvYmplY3RbaSRdO1xuICAgIGlmIChmKHgpKSB7XG4gICAgICByZXR1cm4geDtcbiAgICB9XG4gIH1cbn0pO1xubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHZhbHVlczogdmFsdWVzLFxuICBrZXlzOiBrZXlzLFxuICBwYWlyc1RvT2JqOiBwYWlyc1RvT2JqLFxuICBvYmpUb1BhaXJzOiBvYmpUb1BhaXJzLFxuICBsaXN0c1RvT2JqOiBsaXN0c1RvT2JqLFxuICBvYmpUb0xpc3RzOiBvYmpUb0xpc3RzLFxuICBlbXB0eTogZW1wdHksXG4gIGVhY2g6IGVhY2gsXG4gIG1hcDogbWFwLFxuICBmaWx0ZXI6IGZpbHRlcixcbiAgY29tcGFjdDogY29tcGFjdCxcbiAgcmVqZWN0OiByZWplY3QsXG4gIHBhcnRpdGlvbjogcGFydGl0aW9uLFxuICBmaW5kOiBmaW5kXG59O1xuZnVuY3Rpb24gY3VycnkkKGYsIGJvdW5kKXtcbiAgdmFyIGNvbnRleHQsXG4gIF9jdXJyeSA9IGZ1bmN0aW9uKGFyZ3MpIHtcbiAgICByZXR1cm4gZi5sZW5ndGggPiAxID8gZnVuY3Rpb24oKXtcbiAgICAgIHZhciBwYXJhbXMgPSBhcmdzID8gYXJncy5jb25jYXQoKSA6IFtdO1xuICAgICAgY29udGV4dCA9IGJvdW5kID8gY29udGV4dCB8fCB0aGlzIDogdGhpcztcbiAgICAgIHJldHVybiBwYXJhbXMucHVzaC5hcHBseShwYXJhbXMsIGFyZ3VtZW50cykgPFxuICAgICAgICAgIGYubGVuZ3RoICYmIGFyZ3VtZW50cy5sZW5ndGggP1xuICAgICAgICBfY3VycnkuY2FsbChjb250ZXh0LCBwYXJhbXMpIDogZi5hcHBseShjb250ZXh0LCBwYXJhbXMpO1xuICAgIH0gOiBmO1xuICB9O1xuICByZXR1cm4gX2N1cnJ5KCk7XG59IiwiLy8gR2VuZXJhdGVkIGJ5IExpdmVTY3JpcHQgMS40LjBcbnZhciBzcGxpdCwgam9pbiwgbGluZXMsIHVubGluZXMsIHdvcmRzLCB1bndvcmRzLCBjaGFycywgdW5jaGFycywgcmV2ZXJzZSwgcmVwZWF0LCBjYXBpdGFsaXplLCBjYW1lbGl6ZSwgZGFzaGVyaXplO1xuc3BsaXQgPSBjdXJyeSQoZnVuY3Rpb24oc2VwLCBzdHIpe1xuICByZXR1cm4gc3RyLnNwbGl0KHNlcCk7XG59KTtcbmpvaW4gPSBjdXJyeSQoZnVuY3Rpb24oc2VwLCB4cyl7XG4gIHJldHVybiB4cy5qb2luKHNlcCk7XG59KTtcbmxpbmVzID0gZnVuY3Rpb24oc3RyKXtcbiAgaWYgKCFzdHIubGVuZ3RoKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG4gIHJldHVybiBzdHIuc3BsaXQoJ1xcbicpO1xufTtcbnVubGluZXMgPSBmdW5jdGlvbihpdCl7XG4gIHJldHVybiBpdC5qb2luKCdcXG4nKTtcbn07XG53b3JkcyA9IGZ1bmN0aW9uKHN0cil7XG4gIGlmICghc3RyLmxlbmd0aCkge1xuICAgIHJldHVybiBbXTtcbiAgfVxuICByZXR1cm4gc3RyLnNwbGl0KC9bIF0rLyk7XG59O1xudW53b3JkcyA9IGZ1bmN0aW9uKGl0KXtcbiAgcmV0dXJuIGl0LmpvaW4oJyAnKTtcbn07XG5jaGFycyA9IGZ1bmN0aW9uKGl0KXtcbiAgcmV0dXJuIGl0LnNwbGl0KCcnKTtcbn07XG51bmNoYXJzID0gZnVuY3Rpb24oaXQpe1xuICByZXR1cm4gaXQuam9pbignJyk7XG59O1xucmV2ZXJzZSA9IGZ1bmN0aW9uKHN0cil7XG4gIHJldHVybiBzdHIuc3BsaXQoJycpLnJldmVyc2UoKS5qb2luKCcnKTtcbn07XG5yZXBlYXQgPSBjdXJyeSQoZnVuY3Rpb24obiwgc3RyKXtcbiAgdmFyIHJlc3VsdCwgaSQ7XG4gIHJlc3VsdCA9ICcnO1xuICBmb3IgKGkkID0gMDsgaSQgPCBuOyArK2kkKSB7XG4gICAgcmVzdWx0ICs9IHN0cjtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufSk7XG5jYXBpdGFsaXplID0gZnVuY3Rpb24oc3RyKXtcbiAgcmV0dXJuIHN0ci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0ci5zbGljZSgxKTtcbn07XG5jYW1lbGl6ZSA9IGZ1bmN0aW9uKGl0KXtcbiAgcmV0dXJuIGl0LnJlcGxhY2UoL1stX10rKC4pPy9nLCBmdW5jdGlvbihhcmckLCBjKXtcbiAgICByZXR1cm4gKGMgIT0gbnVsbCA/IGMgOiAnJykudG9VcHBlckNhc2UoKTtcbiAgfSk7XG59O1xuZGFzaGVyaXplID0gZnVuY3Rpb24oc3RyKXtcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC8oW14tQS1aXSkoW0EtWl0rKS9nLCBmdW5jdGlvbihhcmckLCBsb3dlciwgdXBwZXIpe1xuICAgIHJldHVybiBsb3dlciArIFwiLVwiICsgKHVwcGVyLmxlbmd0aCA+IDFcbiAgICAgID8gdXBwZXJcbiAgICAgIDogdXBwZXIudG9Mb3dlckNhc2UoKSk7XG4gIH0pLnJlcGxhY2UoL14oW0EtWl0rKS8sIGZ1bmN0aW9uKGFyZyQsIHVwcGVyKXtcbiAgICBpZiAodXBwZXIubGVuZ3RoID4gMSkge1xuICAgICAgcmV0dXJuIHVwcGVyICsgXCItXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB1cHBlci50b0xvd2VyQ2FzZSgpO1xuICAgIH1cbiAgfSk7XG59O1xubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHNwbGl0OiBzcGxpdCxcbiAgam9pbjogam9pbixcbiAgbGluZXM6IGxpbmVzLFxuICB1bmxpbmVzOiB1bmxpbmVzLFxuICB3b3Jkczogd29yZHMsXG4gIHVud29yZHM6IHVud29yZHMsXG4gIGNoYXJzOiBjaGFycyxcbiAgdW5jaGFyczogdW5jaGFycyxcbiAgcmV2ZXJzZTogcmV2ZXJzZSxcbiAgcmVwZWF0OiByZXBlYXQsXG4gIGNhcGl0YWxpemU6IGNhcGl0YWxpemUsXG4gIGNhbWVsaXplOiBjYW1lbGl6ZSxcbiAgZGFzaGVyaXplOiBkYXNoZXJpemVcbn07XG5mdW5jdGlvbiBjdXJyeSQoZiwgYm91bmQpe1xuICB2YXIgY29udGV4dCxcbiAgX2N1cnJ5ID0gZnVuY3Rpb24oYXJncykge1xuICAgIHJldHVybiBmLmxlbmd0aCA+IDEgPyBmdW5jdGlvbigpe1xuICAgICAgdmFyIHBhcmFtcyA9IGFyZ3MgPyBhcmdzLmNvbmNhdCgpIDogW107XG4gICAgICBjb250ZXh0ID0gYm91bmQgPyBjb250ZXh0IHx8IHRoaXMgOiB0aGlzO1xuICAgICAgcmV0dXJuIHBhcmFtcy5wdXNoLmFwcGx5KHBhcmFtcywgYXJndW1lbnRzKSA8XG4gICAgICAgICAgZi5sZW5ndGggJiYgYXJndW1lbnRzLmxlbmd0aCA/XG4gICAgICAgIF9jdXJyeS5jYWxsKGNvbnRleHQsIHBhcmFtcykgOiBmLmFwcGx5KGNvbnRleHQsIHBhcmFtcyk7XG4gICAgfSA6IGY7XG4gIH07XG4gIHJldHVybiBfY3VycnkoKTtcbn0iLCIvLyBHZW5lcmF0ZWQgYnkgTGl2ZVNjcmlwdCAxLjQuMFxudmFyIEZ1bmMsIExpc3QsIE9iaiwgU3RyLCBOdW0sIGlkLCBpc1R5cGUsIHJlcGxpY2F0ZSwgcHJlbHVkZSwgdG9TdHJpbmckID0ge30udG9TdHJpbmc7XG5GdW5jID0gcmVxdWlyZSgnLi9GdW5jLmpzJyk7XG5MaXN0ID0gcmVxdWlyZSgnLi9MaXN0LmpzJyk7XG5PYmogPSByZXF1aXJlKCcuL09iai5qcycpO1xuU3RyID0gcmVxdWlyZSgnLi9TdHIuanMnKTtcbk51bSA9IHJlcXVpcmUoJy4vTnVtLmpzJyk7XG5pZCA9IGZ1bmN0aW9uKHgpe1xuICByZXR1cm4geDtcbn07XG5pc1R5cGUgPSBjdXJyeSQoZnVuY3Rpb24odHlwZSwgeCl7XG4gIHJldHVybiB0b1N0cmluZyQuY2FsbCh4KS5zbGljZSg4LCAtMSkgPT09IHR5cGU7XG59KTtcbnJlcGxpY2F0ZSA9IGN1cnJ5JChmdW5jdGlvbihuLCB4KXtcbiAgdmFyIGkkLCByZXN1bHRzJCA9IFtdO1xuICBmb3IgKGkkID0gMDsgaSQgPCBuOyArK2kkKSB7XG4gICAgcmVzdWx0cyQucHVzaCh4KTtcbiAgfVxuICByZXR1cm4gcmVzdWx0cyQ7XG59KTtcblN0ci5lbXB0eSA9IExpc3QuZW1wdHk7XG5TdHIuc2xpY2UgPSBMaXN0LnNsaWNlO1xuU3RyLnRha2UgPSBMaXN0LnRha2U7XG5TdHIuZHJvcCA9IExpc3QuZHJvcDtcblN0ci5zcGxpdEF0ID0gTGlzdC5zcGxpdEF0O1xuU3RyLnRha2VXaGlsZSA9IExpc3QudGFrZVdoaWxlO1xuU3RyLmRyb3BXaGlsZSA9IExpc3QuZHJvcFdoaWxlO1xuU3RyLnNwYW4gPSBMaXN0LnNwYW47XG5TdHIuYnJlYWtTdHIgPSBMaXN0LmJyZWFrTGlzdDtcbnByZWx1ZGUgPSB7XG4gIEZ1bmM6IEZ1bmMsXG4gIExpc3Q6IExpc3QsXG4gIE9iajogT2JqLFxuICBTdHI6IFN0cixcbiAgTnVtOiBOdW0sXG4gIGlkOiBpZCxcbiAgaXNUeXBlOiBpc1R5cGUsXG4gIHJlcGxpY2F0ZTogcmVwbGljYXRlXG59O1xucHJlbHVkZS5lYWNoID0gTGlzdC5lYWNoO1xucHJlbHVkZS5tYXAgPSBMaXN0Lm1hcDtcbnByZWx1ZGUuZmlsdGVyID0gTGlzdC5maWx0ZXI7XG5wcmVsdWRlLmNvbXBhY3QgPSBMaXN0LmNvbXBhY3Q7XG5wcmVsdWRlLnJlamVjdCA9IExpc3QucmVqZWN0O1xucHJlbHVkZS5wYXJ0aXRpb24gPSBMaXN0LnBhcnRpdGlvbjtcbnByZWx1ZGUuZmluZCA9IExpc3QuZmluZDtcbnByZWx1ZGUuaGVhZCA9IExpc3QuaGVhZDtcbnByZWx1ZGUuZmlyc3QgPSBMaXN0LmZpcnN0O1xucHJlbHVkZS50YWlsID0gTGlzdC50YWlsO1xucHJlbHVkZS5sYXN0ID0gTGlzdC5sYXN0O1xucHJlbHVkZS5pbml0aWFsID0gTGlzdC5pbml0aWFsO1xucHJlbHVkZS5lbXB0eSA9IExpc3QuZW1wdHk7XG5wcmVsdWRlLnJldmVyc2UgPSBMaXN0LnJldmVyc2U7XG5wcmVsdWRlLmRpZmZlcmVuY2UgPSBMaXN0LmRpZmZlcmVuY2U7XG5wcmVsdWRlLmludGVyc2VjdGlvbiA9IExpc3QuaW50ZXJzZWN0aW9uO1xucHJlbHVkZS51bmlvbiA9IExpc3QudW5pb247XG5wcmVsdWRlLmNvdW50QnkgPSBMaXN0LmNvdW50Qnk7XG5wcmVsdWRlLmdyb3VwQnkgPSBMaXN0Lmdyb3VwQnk7XG5wcmVsdWRlLmZvbGQgPSBMaXN0LmZvbGQ7XG5wcmVsdWRlLmZvbGRsID0gTGlzdC5mb2xkbDtcbnByZWx1ZGUuZm9sZDEgPSBMaXN0LmZvbGQxO1xucHJlbHVkZS5mb2xkbDEgPSBMaXN0LmZvbGRsMTtcbnByZWx1ZGUuZm9sZHIgPSBMaXN0LmZvbGRyO1xucHJlbHVkZS5mb2xkcjEgPSBMaXN0LmZvbGRyMTtcbnByZWx1ZGUudW5mb2xkciA9IExpc3QudW5mb2xkcjtcbnByZWx1ZGUuYW5kTGlzdCA9IExpc3QuYW5kTGlzdDtcbnByZWx1ZGUub3JMaXN0ID0gTGlzdC5vckxpc3Q7XG5wcmVsdWRlLmFueSA9IExpc3QuYW55O1xucHJlbHVkZS5hbGwgPSBMaXN0LmFsbDtcbnByZWx1ZGUudW5pcXVlID0gTGlzdC51bmlxdWU7XG5wcmVsdWRlLnVuaXF1ZUJ5ID0gTGlzdC51bmlxdWVCeTtcbnByZWx1ZGUuc29ydCA9IExpc3Quc29ydDtcbnByZWx1ZGUuc29ydFdpdGggPSBMaXN0LnNvcnRXaXRoO1xucHJlbHVkZS5zb3J0QnkgPSBMaXN0LnNvcnRCeTtcbnByZWx1ZGUuc3VtID0gTGlzdC5zdW07XG5wcmVsdWRlLnByb2R1Y3QgPSBMaXN0LnByb2R1Y3Q7XG5wcmVsdWRlLm1lYW4gPSBMaXN0Lm1lYW47XG5wcmVsdWRlLmF2ZXJhZ2UgPSBMaXN0LmF2ZXJhZ2U7XG5wcmVsdWRlLmNvbmNhdCA9IExpc3QuY29uY2F0O1xucHJlbHVkZS5jb25jYXRNYXAgPSBMaXN0LmNvbmNhdE1hcDtcbnByZWx1ZGUuZmxhdHRlbiA9IExpc3QuZmxhdHRlbjtcbnByZWx1ZGUubWF4aW11bSA9IExpc3QubWF4aW11bTtcbnByZWx1ZGUubWluaW11bSA9IExpc3QubWluaW11bTtcbnByZWx1ZGUubWF4aW11bUJ5ID0gTGlzdC5tYXhpbXVtQnk7XG5wcmVsdWRlLm1pbmltdW1CeSA9IExpc3QubWluaW11bUJ5O1xucHJlbHVkZS5zY2FuID0gTGlzdC5zY2FuO1xucHJlbHVkZS5zY2FubCA9IExpc3Quc2Nhbmw7XG5wcmVsdWRlLnNjYW4xID0gTGlzdC5zY2FuMTtcbnByZWx1ZGUuc2NhbmwxID0gTGlzdC5zY2FubDE7XG5wcmVsdWRlLnNjYW5yID0gTGlzdC5zY2FucjtcbnByZWx1ZGUuc2NhbnIxID0gTGlzdC5zY2FucjE7XG5wcmVsdWRlLnNsaWNlID0gTGlzdC5zbGljZTtcbnByZWx1ZGUudGFrZSA9IExpc3QudGFrZTtcbnByZWx1ZGUuZHJvcCA9IExpc3QuZHJvcDtcbnByZWx1ZGUuc3BsaXRBdCA9IExpc3Quc3BsaXRBdDtcbnByZWx1ZGUudGFrZVdoaWxlID0gTGlzdC50YWtlV2hpbGU7XG5wcmVsdWRlLmRyb3BXaGlsZSA9IExpc3QuZHJvcFdoaWxlO1xucHJlbHVkZS5zcGFuID0gTGlzdC5zcGFuO1xucHJlbHVkZS5icmVha0xpc3QgPSBMaXN0LmJyZWFrTGlzdDtcbnByZWx1ZGUuemlwID0gTGlzdC56aXA7XG5wcmVsdWRlLnppcFdpdGggPSBMaXN0LnppcFdpdGg7XG5wcmVsdWRlLnppcEFsbCA9IExpc3QuemlwQWxsO1xucHJlbHVkZS56aXBBbGxXaXRoID0gTGlzdC56aXBBbGxXaXRoO1xucHJlbHVkZS5hdCA9IExpc3QuYXQ7XG5wcmVsdWRlLmVsZW1JbmRleCA9IExpc3QuZWxlbUluZGV4O1xucHJlbHVkZS5lbGVtSW5kaWNlcyA9IExpc3QuZWxlbUluZGljZXM7XG5wcmVsdWRlLmZpbmRJbmRleCA9IExpc3QuZmluZEluZGV4O1xucHJlbHVkZS5maW5kSW5kaWNlcyA9IExpc3QuZmluZEluZGljZXM7XG5wcmVsdWRlLmFwcGx5ID0gRnVuYy5hcHBseTtcbnByZWx1ZGUuY3VycnkgPSBGdW5jLmN1cnJ5O1xucHJlbHVkZS5mbGlwID0gRnVuYy5mbGlwO1xucHJlbHVkZS5maXggPSBGdW5jLmZpeDtcbnByZWx1ZGUub3ZlciA9IEZ1bmMub3ZlcjtcbnByZWx1ZGUuc3BsaXQgPSBTdHIuc3BsaXQ7XG5wcmVsdWRlLmpvaW4gPSBTdHIuam9pbjtcbnByZWx1ZGUubGluZXMgPSBTdHIubGluZXM7XG5wcmVsdWRlLnVubGluZXMgPSBTdHIudW5saW5lcztcbnByZWx1ZGUud29yZHMgPSBTdHIud29yZHM7XG5wcmVsdWRlLnVud29yZHMgPSBTdHIudW53b3JkcztcbnByZWx1ZGUuY2hhcnMgPSBTdHIuY2hhcnM7XG5wcmVsdWRlLnVuY2hhcnMgPSBTdHIudW5jaGFycztcbnByZWx1ZGUucmVwZWF0ID0gU3RyLnJlcGVhdDtcbnByZWx1ZGUuY2FwaXRhbGl6ZSA9IFN0ci5jYXBpdGFsaXplO1xucHJlbHVkZS5jYW1lbGl6ZSA9IFN0ci5jYW1lbGl6ZTtcbnByZWx1ZGUuZGFzaGVyaXplID0gU3RyLmRhc2hlcml6ZTtcbnByZWx1ZGUudmFsdWVzID0gT2JqLnZhbHVlcztcbnByZWx1ZGUua2V5cyA9IE9iai5rZXlzO1xucHJlbHVkZS5wYWlyc1RvT2JqID0gT2JqLnBhaXJzVG9PYmo7XG5wcmVsdWRlLm9ialRvUGFpcnMgPSBPYmoub2JqVG9QYWlycztcbnByZWx1ZGUubGlzdHNUb09iaiA9IE9iai5saXN0c1RvT2JqO1xucHJlbHVkZS5vYmpUb0xpc3RzID0gT2JqLm9ialRvTGlzdHM7XG5wcmVsdWRlLm1heCA9IE51bS5tYXg7XG5wcmVsdWRlLm1pbiA9IE51bS5taW47XG5wcmVsdWRlLm5lZ2F0ZSA9IE51bS5uZWdhdGU7XG5wcmVsdWRlLmFicyA9IE51bS5hYnM7XG5wcmVsdWRlLnNpZ251bSA9IE51bS5zaWdudW07XG5wcmVsdWRlLnF1b3QgPSBOdW0ucXVvdDtcbnByZWx1ZGUucmVtID0gTnVtLnJlbTtcbnByZWx1ZGUuZGl2ID0gTnVtLmRpdjtcbnByZWx1ZGUubW9kID0gTnVtLm1vZDtcbnByZWx1ZGUucmVjaXAgPSBOdW0ucmVjaXA7XG5wcmVsdWRlLnBpID0gTnVtLnBpO1xucHJlbHVkZS50YXUgPSBOdW0udGF1O1xucHJlbHVkZS5leHAgPSBOdW0uZXhwO1xucHJlbHVkZS5zcXJ0ID0gTnVtLnNxcnQ7XG5wcmVsdWRlLmxuID0gTnVtLmxuO1xucHJlbHVkZS5wb3cgPSBOdW0ucG93O1xucHJlbHVkZS5zaW4gPSBOdW0uc2luO1xucHJlbHVkZS50YW4gPSBOdW0udGFuO1xucHJlbHVkZS5jb3MgPSBOdW0uY29zO1xucHJlbHVkZS5hY29zID0gTnVtLmFjb3M7XG5wcmVsdWRlLmFzaW4gPSBOdW0uYXNpbjtcbnByZWx1ZGUuYXRhbiA9IE51bS5hdGFuO1xucHJlbHVkZS5hdGFuMiA9IE51bS5hdGFuMjtcbnByZWx1ZGUudHJ1bmNhdGUgPSBOdW0udHJ1bmNhdGU7XG5wcmVsdWRlLnJvdW5kID0gTnVtLnJvdW5kO1xucHJlbHVkZS5jZWlsaW5nID0gTnVtLmNlaWxpbmc7XG5wcmVsdWRlLmZsb29yID0gTnVtLmZsb29yO1xucHJlbHVkZS5pc0l0TmFOID0gTnVtLmlzSXROYU47XG5wcmVsdWRlLmV2ZW4gPSBOdW0uZXZlbjtcbnByZWx1ZGUub2RkID0gTnVtLm9kZDtcbnByZWx1ZGUuZ2NkID0gTnVtLmdjZDtcbnByZWx1ZGUubGNtID0gTnVtLmxjbTtcbnByZWx1ZGUuVkVSU0lPTiA9ICcxLjEuMic7XG5tb2R1bGUuZXhwb3J0cyA9IHByZWx1ZGU7XG5mdW5jdGlvbiBjdXJyeSQoZiwgYm91bmQpe1xuICB2YXIgY29udGV4dCxcbiAgX2N1cnJ5ID0gZnVuY3Rpb24oYXJncykge1xuICAgIHJldHVybiBmLmxlbmd0aCA+IDEgPyBmdW5jdGlvbigpe1xuICAgICAgdmFyIHBhcmFtcyA9IGFyZ3MgPyBhcmdzLmNvbmNhdCgpIDogW107XG4gICAgICBjb250ZXh0ID0gYm91bmQgPyBjb250ZXh0IHx8IHRoaXMgOiB0aGlzO1xuICAgICAgcmV0dXJuIHBhcmFtcy5wdXNoLmFwcGx5KHBhcmFtcywgYXJndW1lbnRzKSA8XG4gICAgICAgICAgZi5sZW5ndGggJiYgYXJndW1lbnRzLmxlbmd0aCA/XG4gICAgICAgIF9jdXJyeS5jYWxsKGNvbnRleHQsIHBhcmFtcykgOiBmLmFwcGx5KGNvbnRleHQsIHBhcmFtcyk7XG4gICAgfSA6IGY7XG4gIH07XG4gIHJldHVybiBfY3VycnkoKTtcbn0iLCIoZnVuY3Rpb24oKXtcbiAgdmFyIGkkLCByZWYkLCBsZW4kLCBtb2R1bGU7XG4gIGlmICh0eXBlb2YgZ2xvYmFsICE9ICd1bmRlZmluZWQnICYmIGdsb2JhbCkge1xuICAgIGltcG9ydCQoZ2xvYmFsLCByZXF1aXJlKCdwcmVsdWRlLWxzJykpO1xuICB9XG4gIGFuZ3VsYXIubW9kdWxlKFwiZHNjXCIsIFtcIm5nUm91dGVcIiwgXCJuZ1Jlc291cmNlXCIsIFwiTG9jYWxTdG9yYWdlTW9kdWxlXCIsIFwiYW5ndWNvbXBsZXRlLWFsdFwiLCBcInVpLmdyaWRcIiwgXCJ1aS5ncmlkLmF1dG9SZXNpemVcIl0pLmZpbHRlcigncGVyY2VudGFnZScsIGZ1bmN0aW9uKCRmaWx0ZXIpe1xuICAgIHJldHVybiBmdW5jdGlvbihpbnB1dCwgZGVjaW1hbHMpe1xuICAgICAgZGVjaW1hbHMgPT0gbnVsbCAmJiAoZGVjaW1hbHMgPSAwKTtcbiAgICAgIHJldHVybiAkZmlsdGVyKCdudW1iZXInKShpbnB1dCAqIDEwMCwgZGVjaW1hbHMpICsgJyUnO1xuICAgIH07XG4gIH0pO1xuICByZXF1aXJlKCcuL2FwcC9yb3V0ZXMnKTtcbiAgcmVxdWlyZSgnLi9hcHAvc2VydmljZXMvc3RvcmFnZS1zZXJ2aWNlJyk7XG4gIHJlcXVpcmUoJy4vYXBwL3NlcnZpY2VzL2V4dGVybmFsLWRhdGEtc2VydmljZScpO1xuICByZXF1aXJlKCcuL2FwcC9zZXJ2aWNlcy9kYXRhLWV4cG9ydC1zZXJ2aWNlJyk7XG4gIHJlcXVpcmUoJy4vYXBwL21haW4tY29udHJvbGxlcicpO1xuICAoZnVuY3Rpb24oKXtcbiAgICByZXF1aXJlKCcuL21vZHVsZXMvYXJtb3ItY2FsYy9tYWluLmpzJyk7cmVxdWlyZSgnLi9tb2R1bGVzL2d1aWRlL21haW4uanMnKTtyZXF1aXJlKCcuL21vZHVsZXMvaXRlbXMvbWFpbi5qcycpO3JlcXVpcmUoJy4vbW9kdWxlcy9wYy9tYWluLmpzJyk7cmVxdWlyZSgnLi9tb2R1bGVzL3dlYXBvbi1maW5kZXIvbWFpbi5qcycpO1xuICB9KTtcbiAgZm9yIChpJCA9IDAsIGxlbiQgPSAocmVmJCA9IFsnZ3VpZGUnLCAnaXRlbXMnLCAncGMnLCAnd2VhcG9uLWZpbmRlcicsICdhcm1vci1jYWxjJ10pLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgbW9kdWxlID0gcmVmJFtpJF07XG4gICAgcmVxdWlyZShcIi4vbW9kdWxlcy9cIiArIG1vZHVsZSArIFwiL21haW4uanNcIik7XG4gIH1cbiAgZnVuY3Rpb24gaW1wb3J0JChvYmosIHNyYyl7XG4gICAgdmFyIG93biA9IHt9Lmhhc093blByb3BlcnR5O1xuICAgIGZvciAodmFyIGtleSBpbiBzcmMpIGlmIChvd24uY2FsbChzcmMsIGtleSkpIG9ialtrZXldID0gc3JjW2tleV07XG4gICAgcmV0dXJuIG9iajtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiIsIihmdW5jdGlvbigpe1xuICB2YXIgTWFpbkNvbnRyb2xsZXI7XG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPSAndW5kZWZpbmVkJyAmJiBhbmd1bGFyICE9PSBudWxsKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJkc2NcIikuY29udHJvbGxlcihcIm1haW5Db250cm9sbGVyXCIsIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uKXtcbiAgICAgIHJldHVybiBuZXcgTWFpbkNvbnRyb2xsZXIoJHNjb3BlLCAkbG9jYXRpb24pO1xuICAgIH0pO1xuICB9XG4gIE1haW5Db250cm9sbGVyID0gKGZ1bmN0aW9uKCl7XG4gICAgTWFpbkNvbnRyb2xsZXIuZGlzcGxheU5hbWUgPSAnTWFpbkNvbnRyb2xsZXInO1xuICAgIHZhciBwcm90b3R5cGUgPSBNYWluQ29udHJvbGxlci5wcm90b3R5cGUsIGNvbnN0cnVjdG9yID0gTWFpbkNvbnRyb2xsZXI7XG4gICAgZnVuY3Rpb24gTWFpbkNvbnRyb2xsZXIoJHNjb3BlLCAkbG9jYXRpb24pe1xuICAgICAgdmFyIHRoaXMkID0gdGhpcztcbiAgICAgIHRoaXMuJHNjb3BlID0gJHNjb3BlO1xuICAgICAgdGhpcy4kbG9jYXRpb24gPSAkbG9jYXRpb247XG4gICAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzJC4kbG9jYXRpb24ucGF0aCgpO1xuICAgICAgfSwgZnVuY3Rpb24oaXQpe1xuICAgICAgICAkc2NvcGUudGhpc0xvY2F0aW9uID0gaXQ7XG4gICAgICB9KTtcbiAgICAgICRzY29wZS5tZW51ID0gW1xuICAgICAgICB7XG4gICAgICAgICAgcGF0aDogXCIvZ3VpZGVcIixcbiAgICAgICAgICBuYW1lOiBcIkdhbWUgaW5mbyAmIGNoZWNrbGlzdFwiXG4gICAgICAgIH0sIHtcbiAgICAgICAgICBwYXRoOiBcIi9wY1wiLFxuICAgICAgICAgIG5hbWU6IFwiU3RhdHMgJiBpbnZlbnRvcnlcIlxuICAgICAgICB9LCB7XG4gICAgICAgICAgcGF0aDogXCIvYXJtb3ItY2FsY1wiLFxuICAgICAgICAgIG5hbWU6IFwiQXJtb3IgZmluZGVyXCJcbiAgICAgICAgfSwge1xuICAgICAgICAgIHBhdGg6IFwiL3dlYXBvbi1maW5kZXJcIixcbiAgICAgICAgICBuYW1lOiBcIldlYXBvbiBmaW5kZXJcIlxuICAgICAgICB9LCB7XG4gICAgICAgICAgcGF0aDogXCIvaXRlbXNcIixcbiAgICAgICAgICBuYW1lOiBcIkl0ZW0gZGF0YVwiXG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgfVxuICAgIHJldHVybiBNYWluQ29udHJvbGxlcjtcbiAgfSgpKTtcbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlICE9PSBudWxsKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBNYWluQ29udHJvbGxlcjtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiIsIihmdW5jdGlvbigpe1xuICBhbmd1bGFyLm1vZHVsZShcImRzY1wiKS5jb25maWcoZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIpe1xuICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy9ndWlkZS86c2VjdGlvbicsIHtcbiAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9ndWlkZS9ndWlkZS12aWV3Lmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ0d1aWRlQ29udHJvbGxlcidcbiAgICB9KS53aGVuKCcvaXRlbXMnLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvaXRlbXMvdmlldy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdJdGVtc0NvbnRyb2xsZXInXG4gICAgfSkud2hlbignL3BjJywge1xuICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL3BjL3BjLXZpZXcuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAncGNDb250cm9sbGVyJ1xuICAgIH0pLndoZW4oJy93ZWFwb24tZmluZGVyJywge1xuICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL3dlYXBvbi1maW5kZXIvd2VhcG9uLWZpbmRlci12aWV3Lmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ3dlYXBvbkZpbmRlckNvbnRyb2xsZXInXG4gICAgfSkud2hlbignL2FybW9yLWNhbGMnLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvYXJtb3ItY2FsYy9hcm1vci1jYWxjLXZpZXcuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnQXJtb3JDYWxjQ29udHJvbGxlcidcbiAgICB9KS5vdGhlcndpc2Uoe1xuICAgICAgcmVkaXJlY3RUbzogJy9ndWlkZS9pbnRybydcbiAgICB9KTtcbiAgfSk7XG59KS5jYWxsKHRoaXMpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gIGFuZ3VsYXIubW9kdWxlKFwiZHNjXCIpLnNlcnZpY2UoJ2RhdGFFeHBvcnRTdmMnLCBmdW5jdGlvbigpe1xuICAgIHJldHVybiB7XG4gICAgICBleHBvcnRKc29uOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgd2luZG93Lm9wZW4oZW5jb2RlVVJJKFwiZGF0YTphcHBsaWNhdGlvbi9qc29uLFwiICsgSlNPTi5zdHJpbmdpZnkoZGF0YSkpKTtcbiAgICAgIH0sXG4gICAgICBleHBvcnRDc3Y6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICB2YXIgZmlyc3RMaW5lLCByb3dzLCBpJCwgbGVuJCwgaXRlbSwgcm93LCBrZXksIHZhbHVlLCBvdXRwdXQ7XG4gICAgICAgIGZpcnN0TGluZSA9IGpvaW4oJywnKShcbiAgICAgICAga2V5cyhcbiAgICAgICAgZmlyc3QoXG4gICAgICAgIGRhdGEpKSk7XG4gICAgICAgIHJvd3MgPSBbXTtcbiAgICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSBkYXRhLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgICAgaXRlbSA9IGRhdGFbaSRdO1xuICAgICAgICAgIHJvdyA9IFtdO1xuICAgICAgICAgIGZvciAoa2V5IGluIGl0ZW0pIHtcbiAgICAgICAgICAgIHZhbHVlID0gaXRlbVtrZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoJ1wiJywgJ1wiXCInKS5yZXBsYWNlKC8oXFxyXFxufFxcbnxcXHIpL2csICdcXFxcbicpO1xuICAgICAgICAgICAgICB2YWx1ZSA9IFwiXFxcIlwiICsgdmFsdWUgKyBcIlxcXCJcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJvdy5wdXNoKHZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcm93ID0gam9pbignLCcpKFxuICAgICAgICAgIHJvdyk7XG4gICAgICAgICAgcm93cy5wdXNoKHJvdyk7XG4gICAgICAgIH1cbiAgICAgICAgb3V0cHV0ID0gZmlyc3RMaW5lICsgXCJcXG5cIiArIGpvaW4oXCJcXG5cIikoXG4gICAgICAgIHJvd3MpO1xuICAgICAgICB3aW5kb3cub3BlbihlbmNvZGVVUkkoXCJkYXRhOnRleHQvcGxhaW4sXCIgKyBvdXRwdXQpKTtcbiAgICAgIH1cbiAgICB9O1xuICB9KTtcbn0pLmNhbGwodGhpcyk7XG4iLCIoZnVuY3Rpb24oKXtcbiAgdmFyIEV4dGVybmFsRGF0YVNlcnZpY2U7XG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPSAndW5kZWZpbmVkJyAmJiBhbmd1bGFyICE9PSBudWxsKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJkc2NcIikuc2VydmljZShcImV4dGVybmFsRGF0YVN2Y1wiLCBmdW5jdGlvbigkcmVzb3VyY2UsICRxKXtcbiAgICAgIHJldHVybiBuZXcgRXh0ZXJuYWxEYXRhU2VydmljZSgkcmVzb3VyY2UsICRxKTtcbiAgICB9KTtcbiAgfVxuICBFeHRlcm5hbERhdGFTZXJ2aWNlID0gKGZ1bmN0aW9uKCl7XG4gICAgRXh0ZXJuYWxEYXRhU2VydmljZS5kaXNwbGF5TmFtZSA9ICdFeHRlcm5hbERhdGFTZXJ2aWNlJztcbiAgICB2YXIgcHJvdG90eXBlID0gRXh0ZXJuYWxEYXRhU2VydmljZS5wcm90b3R5cGUsIGNvbnN0cnVjdG9yID0gRXh0ZXJuYWxEYXRhU2VydmljZTtcbiAgICBmdW5jdGlvbiBFeHRlcm5hbERhdGFTZXJ2aWNlKCRyZXNvdXJjZSwgJHEpe1xuICAgICAgdGhpcy4kcmVzb3VyY2UgPSAkcmVzb3VyY2U7XG4gICAgICB0aGlzLiRxID0gJHE7XG4gICAgICB0aGlzLmxvYWRKc29uID0gYmluZCQodGhpcywgJ2xvYWRKc29uJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuX2NhY2hlID0ge307XG4gICAgfVxuICAgIC8qKlxuICAgICAqIExvYWQgYW4gZXh0ZXJuYWwgSlNPTiByZXNvdXJjZSBhbmQgcGFyc2UgaXQgaW50byBhbiBhcnJheVxuICAgICAqL1xuICAgIHByb3RvdHlwZS5sb2FkSnNvbiA9IGZ1bmN0aW9uKHVybCwgcmV0dXJuUHJvbWlzZSl7XG4gICAgICB2YXIgdGFzaywgcmVmJCwgdGhpcyQgPSB0aGlzO1xuICAgICAgcmV0dXJuUHJvbWlzZSA9PSBudWxsICYmIChyZXR1cm5Qcm9taXNlID0gdHJ1ZSk7XG4gICAgICBpZiAodXJsID09IG51bGwgfHwgdHlwZW9mIHVybCAhPT0gXCJzdHJpbmdcIiB8fCB1cmwubGVuZ3RoIDwgMSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIFVSTDogW1wiICsgdXJsICsgXCJdXCIpO1xuICAgICAgfVxuICAgICAgdGFzayA9IHRoaXMuJHEuZGVmZXIoKTtcbiAgICAgIGlmIChlbXB0eShcbiAgICAgIChyZWYkID0gdGhpcy5fY2FjaGUpW3VybF0gfHwgKHJlZiRbdXJsXSA9IFtdKSkpIHtcbiAgICAgICAgdGhpcy5fY2FjaGVbdXJsXSA9IHRoaXMuJHJlc291cmNlKHVybCkucXVlcnkoZnVuY3Rpb24oKXtcbiAgICAgICAgICB0YXNrLnJlc29sdmUodGhpcyQuX2NhY2hlW3VybF0pO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRhc2sucmVzb2x2ZSh0aGlzLl9jYWNoZVt1cmxdKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXR1cm5Qcm9taXNlXG4gICAgICAgID8gdGFzay5wcm9taXNlXG4gICAgICAgIDogdGhpcy5fY2FjaGVbdXJsXTtcbiAgICB9O1xuICAgIHJldHVybiBFeHRlcm5hbERhdGFTZXJ2aWNlO1xuICB9KCkpO1xuICBpZiAodHlwZW9mIG1vZHVsZSAhPSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09IG51bGwpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IEV4dGVybmFsRGF0YVNlcnZpY2U7XG4gIH1cbiAgZnVuY3Rpb24gYmluZCQob2JqLCBrZXksIHRhcmdldCl7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiAodGFyZ2V0IHx8IG9iailba2V5XS5hcHBseShvYmosIGFyZ3VtZW50cykgfTtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiIsIihmdW5jdGlvbigpe1xuICBhbmd1bGFyLm1vZHVsZShcImRzY1wiKS5jb25maWcoZnVuY3Rpb24obG9jYWxTdG9yYWdlU2VydmljZVByb3ZpZGVyKXtcbiAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlUHJvdmlkZXIuc2V0UHJlZml4KFwiRFNDXCIpO1xuICB9KS5zZXJ2aWNlKCdzdG9yYWdlU3ZjJywgW1xuICAgICdsb2NhbFN0b3JhZ2VTZXJ2aWNlJywgZnVuY3Rpb24obG9jYWxTdG9yYWdlKXtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNhdmU6IGZ1bmN0aW9uKGtleSwgZGF0YSl7XG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnNldChrZXksIGRhdGEpO1xuICAgICAgICB9LFxuICAgICAgICBsb2FkOiBmdW5jdGlvbihrZXkpe1xuICAgICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0KGtleSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICBdKTtcbn0pLmNhbGwodGhpcyk7XG4iLCIoZnVuY3Rpb24oKXtcbiAgYW5ndWxhci5tb2R1bGUoXCJkc2NcIikuY29udHJvbGxlcihcIkFybW9yQ2FsY0NvbnRyb2xsZXJcIiwgZnVuY3Rpb24oJHEsICRzY29wZSwgc3RvcmFnZVN2YywgaXRlbVN2YywgYXJtb3JDYWxjU3ZjLCBzdGF0U3ZjLCB1aUdyaWRDb25zdGFudHMpe1xuICAgIHZhciByZWYkLCB4JDtcbiAgICAkc2NvcGUucmVzdWx0cyA9IFtdO1xuICAgICh7XG4gICAgICBtYXhMb2FkOiAwLFxuICAgICAgYXZhaWxhYmxlTG9hZDogMFxuICAgIH0pO1xuICAgICRzY29wZS5wYXJhbXMgPSAocmVmJCA9IHN0b3JhZ2VTdmMubG9hZCgnYXJtb3ItY2FsYy1wYXJhbXMnKSkgIT0gbnVsbFxuICAgICAgPyByZWYkXG4gICAgICA6IHtcbiAgICAgICAgcmVzZXJ2ZWRXZWlnaHQ6IDE1LFxuICAgICAgICBzZWxlY3RlZFdlaWdodExpbWl0OiAwLjUwLFxuICAgICAgICBpbmNsdWRlVXBncmFkZXM6IHRydWUsXG4gICAgICAgIG1vZGlmaWVyczogWzIsIDAsIDAsIDAsIDAsIDAsIDAsIDFdLFxuICAgICAgICByZXN1bHRMaW1pdDogMTBcbiAgICAgIH07XG4gICAgJHNjb3BlLndlaWdodExpbWl0cyA9IFswLjI1LCAwLjUwLCAwLjc1LCAxLjAwXTtcbiAgICAkc2NvcGUubW9kaWZpZXJzID0gW1xuICAgICAge1xuICAgICAgICBrZXk6ICdwaHknLFxuICAgICAgICB0aXRsZTogXCJQaHlzaWNhbFwiXG4gICAgICB9LCB7XG4gICAgICAgIGtleTogJ21hZycsXG4gICAgICAgIHRpdGxlOiBcIk1hZ2ljXCJcbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiAnZmlyJyxcbiAgICAgICAgdGl0bGU6IFwiRmlyZVwiXG4gICAgICB9LCB7XG4gICAgICAgIGtleTogJ2xpdCcsXG4gICAgICAgIHRpdGxlOiBcIkxpZ2h0bmluZ1wiXG4gICAgICB9LCB7XG4gICAgICAgIGtleTogJ2JsbycsXG4gICAgICAgIHRpdGxlOiBcIkJsZWVkXCJcbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiAndG94JyxcbiAgICAgICAgdGl0bGU6IFwiUG9pc29uXCJcbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiAnY3VyJyxcbiAgICAgICAgdGl0bGU6IFwiQ3Vyc2VcIlxuICAgICAgfSwge1xuICAgICAgICBrZXk6ICdwb2lzZScsXG4gICAgICAgIHRpdGxlOiBcIlBvaXNlXCJcbiAgICAgIH1cbiAgICBdO1xuICAgICRzY29wZS5tYXhMb2FkID0gNDAgKyBzdGF0U3ZjLnN0YXRWYWx1ZU9mKCdlbmR1cmFuY2UnKTtcbiAgICAkc2NvcGUudHlwZU5hbWVzID0ge1xuICAgICAgMDogJ2hlYWQnLFxuICAgICAgMTogJ2NoZXN0JyxcbiAgICAgIDI6ICdoYW5kcycsXG4gICAgICAzOiAnbGVncydcbiAgICB9O1xuICAgICRzY29wZS5wYXJ0TmFtZXMgPSBbJ2hlYWQnLCAnY2hlc3QnLCAnaGFuZHMnLCAnbGVncyddO1xuICAgIHgkID0gJHNjb3BlLmdyaWRPcHRpb25zID0gcmVxdWlyZSgnLi9jb250cm9sbGVyL2dyaWRPcHRpb25zJykodWlHcmlkQ29uc3RhbnRzKTtcbiAgICB4JC5kYXRhID0gJHNjb3BlLnJlc3VsdHM7XG4gICAgJHNjb3BlLmNhbGN1bGF0ZSA9IGZ1bmN0aW9uKHR5cGUpe1xuICAgICAgdmFyIHgkLCBpJCwgcmVmJCwgbGVuJCwgaW5kZXgsIG1vZCwgcmVmMSQ7XG4gICAgICB0eXBlID09IG51bGwgJiYgKHR5cGUgPSAnb2ZmZW5jZScpO1xuICAgICAgYXJtb3JDYWxjU3ZjLmZyZWVXZWlnaHQgPSAkc2NvcGUuYXZhaWxhYmxlTG9hZDtcbiAgICAgIHgkID0gYXJtb3JDYWxjU3ZjLnBhcmFtcyA9IHt9O1xuICAgICAgeCQuZnJlZVdlaWdodCA9ICRzY29wZS5hdmFpbGFibGVMb2FkO1xuICAgICAgeCQuaW5jbHVkZVVwZ3JhZGVzID0gJHNjb3BlLnBhcmFtcy5pbmNsdWRlVXBncmFkZXM7XG4gICAgICBmb3IgKGkkID0gMCwgbGVuJCA9IChyZWYkID0gJHNjb3BlLm1vZGlmaWVycykubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgICAgaW5kZXggPSBpJDtcbiAgICAgICAgbW9kID0gcmVmJFtpJF07XG4gICAgICAgICgocmVmMSQgPSBhcm1vckNhbGNTdmMucGFyYW1zKS5tb2RpZmllcnMgfHwgKHJlZjEkLm1vZGlmaWVycyA9IHt9KSlbbW9kLmtleV0gPSAkc2NvcGUucGFyYW1zLm1vZGlmaWVyc1tpbmRleF07XG4gICAgICB9XG4gICAgICBhcm1vckNhbGNTdmMuZmluZEJlc3RDb21iaW5hdGlvbnMoKS50aGVuKGZ1bmN0aW9uKHJlc3VsdHMpe1xuICAgICAgICB2YXIgaSQsIGxlbiQsIHJlc3VsdDtcbiAgICAgICAgJHNjb3BlLnJlc3VsdHMgPSBbXTtcbiAgICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSByZXN1bHRzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgICAgcmVzdWx0ID0gcmVzdWx0c1tpJF07XG4gICAgICAgICAgJHNjb3BlLnJlc3VsdHMucHVzaCh7XG4gICAgICAgICAgICBzY29yZTogcmVzdWx0LnNjb3JlLFxuICAgICAgICAgICAgd2VpZ2h0OiByZXN1bHQud2VpZ2h0LFxuICAgICAgICAgICAgYXJtb3JzOiBqb2luKCcsICcpKFxuICAgICAgICAgICAgbWFwKGZuJCkoXG4gICAgICAgICAgICByZXN1bHQuYXJtb3JzKSksXG4gICAgICAgICAgICBkZXRhaWxTY29yZXM6IHJlc3VsdC5kZXRhaWxTY29yZXNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9IHRha2UoJHNjb3BlLnBhcmFtcy5yZXN1bHRMaW1pdCkoXG4gICAgICAgIHJldmVyc2UoXG4gICAgICAgIHNvcnRCeShmdW5jdGlvbihpdCl7XG4gICAgICAgICAgcmV0dXJuIGl0LnNjb3JlO1xuICAgICAgICB9KShcbiAgICAgICAgJHNjb3BlLnJlc3VsdHMpKSk7XG4gICAgICAgIGZ1bmN0aW9uIGZuJChpdCl7XG4gICAgICAgICAgcmV0dXJuIGl0Lm5hbWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgJHNjb3BlLiR3YXRjaChcInBhcmFtc1wiLCBmdW5jdGlvbigpe1xuICAgICAgJHNjb3BlLmF2YWlsYWJsZUxvYWQgPSAkc2NvcGUubWF4TG9hZCAqICRzY29wZS5wYXJhbXMuc2VsZWN0ZWRXZWlnaHRMaW1pdCAtICRzY29wZS5wYXJhbXMucmVzZXJ2ZWRXZWlnaHQ7XG4gICAgICBzdG9yYWdlU3ZjLnNhdmUoXCJhcm1vci1jYWxjLXBhcmFtc1wiLCAkc2NvcGUucGFyYW1zKTtcbiAgICB9LCB0cnVlKTtcbiAgfSk7XG59KS5jYWxsKHRoaXMpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gIHZhciBBcm1vckNhbGNTdmM7XG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPSAndW5kZWZpbmVkJyAmJiBhbmd1bGFyICE9PSBudWxsKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJkc2NcIikuc2VydmljZShcImFybW9yQ2FsY1N2Y1wiLCBmdW5jdGlvbihpbnZlbnRvcnlTdmMsIGl0ZW1TdmMsICRxKXtcbiAgICAgIHJldHVybiAoZnVuY3Rpb24oZnVuYywgYXJncywgY3Rvcikge1xuICAgICAgICBjdG9yLnByb3RvdHlwZSA9IGZ1bmMucHJvdG90eXBlO1xuICAgICAgICB2YXIgY2hpbGQgPSBuZXcgY3RvciwgcmVzdWx0ID0gZnVuYy5hcHBseShjaGlsZCwgYXJncyksIHQ7XG4gICAgICAgIHJldHVybiAodCA9IHR5cGVvZiByZXN1bHQpICA9PSBcIm9iamVjdFwiIHx8IHQgPT0gXCJmdW5jdGlvblwiID8gcmVzdWx0IHx8IGNoaWxkIDogY2hpbGQ7XG4gIH0pKEFybW9yQ2FsY1N2YywgYXJndW1lbnRzLCBmdW5jdGlvbigpe30pO1xuICAgIH0pO1xuICB9XG4gIEFybW9yQ2FsY1N2YyA9IChmdW5jdGlvbigpe1xuICAgIEFybW9yQ2FsY1N2Yy5kaXNwbGF5TmFtZSA9ICdBcm1vckNhbGNTdmMnO1xuICAgIHZhciBwcm90b3R5cGUgPSBBcm1vckNhbGNTdmMucHJvdG90eXBlLCBjb25zdHJ1Y3RvciA9IEFybW9yQ2FsY1N2YztcbiAgICBmdW5jdGlvbiBBcm1vckNhbGNTdmMoX2ludmVudG9yeVN2YywgX2l0ZW1TdmMsICRxKXtcbiAgICAgIHRoaXMuX2ludmVudG9yeVN2YyA9IF9pbnZlbnRvcnlTdmM7XG4gICAgICB0aGlzLl9pdGVtU3ZjID0gX2l0ZW1TdmM7XG4gICAgICB0aGlzLiRxID0gJHE7XG4gICAgICB0aGlzLmNhbGN1bGF0ZVNjb3JlRm9yID0gYmluZCQodGhpcywgJ2NhbGN1bGF0ZVNjb3JlRm9yJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuZmluZEFsbENvbWJpbmF0aW9uc09mID0gYmluZCQodGhpcywgJ2ZpbmRBbGxDb21iaW5hdGlvbnNPZicsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmZpbmRVc2FibGVBcm1vcnMgPSBiaW5kJCh0aGlzLCAnZmluZFVzYWJsZUFybW9ycycsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLnRha2VPbmx5QWZmb3JkYWJsZSA9IGJpbmQkKHRoaXMsICd0YWtlT25seUFmZm9yZGFibGUnLCBwcm90b3R5cGUpO1xuICAgICAgdGhpcy5maW5kQmVzdENvbWJpbmF0aW9ucyA9IGJpbmQkKHRoaXMsICdmaW5kQmVzdENvbWJpbmF0aW9ucycsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmZyZWVXZWlnaHQgPSAwO1xuICAgICAgdGhpcy5wYXJhbXMgPSB7fTtcbiAgICAgIHRoaXMuYXJtb3JUeXBlcyA9IFsnaGVhZCcsICdjaGVzdCcsICdoYW5kcycsICdsZWdzJ107XG4gICAgICB0aGlzLmFybW9yVHlwZUtleXMgPSB7XG4gICAgICAgICdoZWFkJzogMCxcbiAgICAgICAgJ2NoZXN0JzogMSxcbiAgICAgICAgJ2hhbmRzJzogMixcbiAgICAgICAgJ2xlZ3MnOiAzXG4gICAgICB9O1xuICAgIH1cbiAgICBwcm90b3R5cGUuZmluZEJlc3RDb21iaW5hdGlvbnMgPSBmdW5jdGlvbigpe1xuICAgICAgdmFyIHN0YXRpY0FybW9ycywgZHluYW1pY0FybW9ycywgY2FuQWZmb3JkLCB0aGlzJCA9IHRoaXM7XG4gICAgICBpZiAoKHRoaXMucGFyYW1zIHx8ICh0aGlzLnBhcmFtcyA9IHt9KSkuaW5jbHVkZVVwZ3JhZGVzID09IG51bGwpIHtcbiAgICAgICAgdGhpcy5wYXJhbXMuaW5jbHVkZVVwZ3JhZGVzID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHN0YXRpY0FybW9ycyA9IFtdO1xuICAgICAgZHluYW1pY0FybW9ycyA9IFtdO1xuICAgICAgY2FuQWZmb3JkID0gW107XG4gICAgICByZXR1cm4gdGhpcy5maW5kVXNhYmxlQXJtb3JzKCkudGhlbihmdW5jdGlvbihhcm1vcnMpe1xuICAgICAgICBzdGF0aWNBcm1vcnMgPSBmaWx0ZXIoZnVuY3Rpb24oaXQpe1xuICAgICAgICAgIHJldHVybiBpdC5tYXRTZXRJZCA8IDA7XG4gICAgICAgIH0pKFxuICAgICAgICBhcm1vcnMpO1xuICAgICAgICBkeW5hbWljQXJtb3JzID0gcmVqZWN0KGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgICByZXR1cm4gaXQudXBncmFkZUlkIDwgMDtcbiAgICAgICAgfSkoXG4gICAgICAgIGFybW9ycyk7XG4gICAgICAgIHJldHVybiB0aGlzJC5maW5kQWxsQ29tYmluYXRpb25zT2YoZHluYW1pY0FybW9ycyk7XG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKGNvbWJpbmF0aW9ucyl7XG4gICAgICAgIHZhciBpJCwgbGVuJCwgY29tYiwgYmVzdCwgaiQsIHJlZiQsIGxlbjEkLCBhcm1vcjtcbiAgICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSBjb21iaW5hdGlvbnMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgICAgICBjb21iID0gY29tYmluYXRpb25zW2kkXTtcbiAgICAgICAgICBjb21iLnNjb3JlID0gdGhpcyQuY2FsY3VsYXRlU2NvcmVGb3IoY29tYik7XG4gICAgICAgIH1cbiAgICAgICAgYmVzdCA9IHRha2UodGhpcyQucGFyYW1zLmluY2x1ZGVVcGdyYWRlcyA/IDEwIDogMTAwKShcbiAgICAgICAgcmV2ZXJzZShcbiAgICAgICAgc29ydEJ5KGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgICByZXR1cm4gaXQuc2NvcmU7XG4gICAgICAgIH0pKFxuICAgICAgICBjb21iaW5hdGlvbnMpKSk7XG4gICAgICAgIGR5bmFtaWNBcm1vcnMgPSBbXTtcbiAgICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSBiZXN0Lmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgICAgY29tYiA9IGJlc3RbaSRdO1xuICAgICAgICAgIGZvciAoaiQgPSAwLCBsZW4xJCA9IChyZWYkID0gY29tYi5hcm1vcnMpLmxlbmd0aDsgaiQgPCBsZW4xJDsgKytqJCkge1xuICAgICAgICAgICAgYXJtb3IgPSByZWYkW2okXTtcbiAgICAgICAgICAgIGR5bmFtaWNBcm1vcnMucHVzaChhcm1vcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGR5bmFtaWNBcm1vcnMgPSB1bmlxdWUoXG4gICAgICAgIGR5bmFtaWNBcm1vcnMpO1xuICAgICAgfSkudGhlbihmdW5jdGlvbigpe1xuICAgICAgICB2YXIgcHJvbWlzZXMsIGkkLCByZWYkLCBsZW4kLCBhcm1vcjtcbiAgICAgICAgaWYgKCF0aGlzJC5wYXJhbXMuaW5jbHVkZVVwZ3JhZGVzKSB7XG4gICAgICAgICAgcmV0dXJuIGR5bmFtaWNBcm1vcnM7XG4gICAgICAgIH1cbiAgICAgICAgcHJvbWlzZXMgPSBbXTtcbiAgICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSAocmVmJCA9IGR5bmFtaWNBcm1vcnMpLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgICAgYXJtb3IgPSByZWYkW2kkXTtcbiAgICAgICAgICBwcm9taXNlcy5wdXNoKHRoaXMkLl9pdGVtU3ZjLnVwZ3JhZGVDb21wLmZpbmRBbGxBdmFpbGFibGVVcGdyYWRlc0Zvcihhcm1vcikudGhlbihmbiQpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcyQuJHEuYWxsKHByb21pc2VzKTtcbiAgICAgICAgZnVuY3Rpb24gZm4kKHVwZ3JhZGVzKXtcbiAgICAgICAgICByZXR1cm4gZHluYW1pY0FybW9ycyA9IGR5bmFtaWNBcm1vcnMuY29uY2F0KHVwZ3JhZGVzKTtcbiAgICAgICAgfVxuICAgICAgfSkudGhlbihmdW5jdGlvbigpe1xuICAgICAgICB0aGlzJC5fZGVidWdMb2cgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRoaXMkLmZpbmRBbGxDb21iaW5hdGlvbnNPZihkeW5hbWljQXJtb3JzKTtcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24oY29tYmluYXRpb25zKXtcbiAgICAgICAgcmV0dXJuIHRoaXMkLnRha2VPbmx5QWZmb3JkYWJsZShjb21iaW5hdGlvbnMpO1xuICAgICAgfSkudGhlbihmdW5jdGlvbihjb21icyl7XG4gICAgICAgIHZhciBzZXRzLCBiZXN0LCBpJCwgbGVuJCwgc2V0LCBiZXN0QXJtb3JzO1xuICAgICAgICBzZXRzID0gT2JqLnZhbHVlcyhcbiAgICAgICAgZ3JvdXBCeShmdW5jdGlvbihpdCl7XG4gICAgICAgICAgcmV0dXJuIGl0LnBpZWNlcztcbiAgICAgICAgfSkoXG4gICAgICAgIGNvbWJzKSk7XG4gICAgICAgIGJlc3QgPSBbXTtcbiAgICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSBzZXRzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgICAgc2V0ID0gc2V0c1tpJF07XG4gICAgICAgICAgYmVzdC5wdXNoKGZpcnN0KFxuICAgICAgICAgIHJldmVyc2UoXG4gICAgICAgICAgc29ydEJ5KGZuJCkoXG4gICAgICAgICAgc2V0KSkpKTtcbiAgICAgICAgfVxuICAgICAgICBiZXN0QXJtb3JzID0gW107XG4gICAgICAgIGZvciAoaSQgPSAwLCBsZW4kID0gYmVzdC5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgICAgIHNldCA9IGJlc3RbaSRdO1xuICAgICAgICAgIGJlc3RBcm1vcnMgPSBiZXN0QXJtb3JzLmNvbmNhdChzZXQuYXJtb3JzKTtcbiAgICAgICAgfVxuICAgICAgICBiZXN0QXJtb3JzID0gdW5pcXVlKFxuICAgICAgICBiZXN0QXJtb3JzKS5jb25jYXQoc3RhdGljQXJtb3JzKTtcbiAgICAgICAgcmV0dXJuIHRoaXMkLmZpbmRBbGxDb21iaW5hdGlvbnNPZihiZXN0QXJtb3JzKTtcbiAgICAgICAgZnVuY3Rpb24gZm4kKGl0KXtcbiAgICAgICAgICByZXR1cm4gaXQudXBncmFkZUxldmVsO1xuICAgICAgICB9XG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKGNvbWJzKXtcbiAgICAgICAgcmV0dXJuIHRoaXMkLnRha2VPbmx5QWZmb3JkYWJsZShjb21icyk7XG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKGNvbWJzKXtcbiAgICAgICAgcmV0dXJuIGVhY2godGhpcyQuY2FsY3VsYXRlU2NvcmVGb3IpKFxuICAgICAgICBjb21icyk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEdpdmVuIGEgbGlzdCBvZiBjb21iaW5hdGlvbnMsIG9ubHkgdGFrZSB0aG9zZSB0aGF0IHRoZSB1c2VyIGNhbiBhZmZvcmQuXG4gICAgICovXG4gICAgcHJvdG90eXBlLnRha2VPbmx5QWZmb3JkYWJsZSA9IGZ1bmN0aW9uKGNvbWJpbmF0aW9ucyl7XG4gICAgICB2YXIgY2FuQWZmb3JkLCBpJCwgbGVuJCwgY29tYiwgcHJvbWlzZXMsIGokLCByZWYkLCBsZW4xJCwgYXJtb3IsIGskLCByZWYxJCwgbGVuMiQsIGFDb3N0LCBjQ29zdCwgdGhpcyQgPSB0aGlzO1xuICAgICAgY2FuQWZmb3JkID0gW107XG4gICAgICBmb3IgKGkkID0gMCwgbGVuJCA9IGNvbWJpbmF0aW9ucy5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgICBjb21iID0gY29tYmluYXRpb25zW2kkXTtcbiAgICAgICAgY29tYi50b3RhbENvc3QgPSBbXTtcbiAgICAgICAgcHJvbWlzZXMgPSBbXTtcbiAgICAgICAgZm9yIChqJCA9IDAsIGxlbjEkID0gKHJlZiQgPSBmaWx0ZXIoZm4kKShcbiAgICAgICAgY29tYi5hcm1vcnMpKS5sZW5ndGg7IGokIDwgbGVuMSQ7ICsraiQpIHtcbiAgICAgICAgICBhcm1vciA9IHJlZiRbaiRdO1xuICAgICAgICAgIGZvciAoayQgPSAwLCBsZW4yJCA9IChyZWYxJCA9IGFybW9yLnRvdGFsQ29zdCkubGVuZ3RoOyBrJCA8IGxlbjIkOyArK2skKSB7XG4gICAgICAgICAgICBhQ29zdCA9IHJlZjEkW2skXTtcbiAgICAgICAgICAgIGNDb3N0ID0gZmluZChmbjEkKShcbiAgICAgICAgICAgIGNvbWIudG90YWxDb3N0KTtcbiAgICAgICAgICAgIGlmIChjQ29zdCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgIGNDb3N0ID0ge1xuICAgICAgICAgICAgICAgIG1hdElkOiBhQ29zdC5tYXRJZCxcbiAgICAgICAgICAgICAgICBtYXRDb3N0OiAwXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGNvbWIudG90YWxDb3N0LnB1c2goY0Nvc3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY0Nvc3QubWF0Q29zdCArPSBhQ29zdC5tYXRDb3N0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwcm9taXNlcy5wdXNoKGZuMiQoY29tYikpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuJHEuYWxsKHByb21pc2VzKS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBjYW5BZmZvcmQ7XG4gICAgICB9KTtcbiAgICAgIGZ1bmN0aW9uIGZuJChpdCl7XG4gICAgICAgIHJldHVybiBpdC50b3RhbENvc3QgIT0gbnVsbDtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIGZuMSQoaXQpe1xuICAgICAgICByZXR1cm4gaXQubWF0SWQgPT09IGFDb3N0Lm1hdElkO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gZm4yJChjb21iKXtcbiAgICAgICAgcmV0dXJuIHRoaXMkLl9pbnZlbnRvcnlTdmMubG9hZCgpLnRoZW4oZnVuY3Rpb24oaW52ZW50b3J5KXtcbiAgICAgICAgICB2YXIgbWF0ZXJpYWxzLCBjYW4sIGkkLCByZWYkLCBsZW4kLCBjb3N0LCBtYXRlcmlhbDtcbiAgICAgICAgICBtYXRlcmlhbHMgPSBmaWx0ZXIoZnVuY3Rpb24oaXQpe1xuICAgICAgICAgICAgcmV0dXJuIGl0Lml0ZW1UeXBlID09PSAnaXRlbSc7XG4gICAgICAgICAgfSkoXG4gICAgICAgICAgaW52ZW50b3J5KTtcbiAgICAgICAgICBjYW4gPSB0cnVlO1xuICAgICAgICAgIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZiQgPSBjb21iLnRvdGFsQ29zdCkubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgICAgICAgIGNvc3QgPSByZWYkW2kkXTtcbiAgICAgICAgICAgIG1hdGVyaWFsID0gZmluZChmbiQpKFxuICAgICAgICAgICAgbWF0ZXJpYWxzKTtcbiAgICAgICAgICAgIGlmICghKG1hdGVyaWFsICE9IG51bGwgJiYgbWF0ZXJpYWwuYW1vdW50ID49IGNvc3QubWF0Q29zdCkpIHtcbiAgICAgICAgICAgICAgY2FuID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjYW4pIHtcbiAgICAgICAgICAgIGNhbkFmZm9yZC5wdXNoKGNvbWIpO1xuICAgICAgICAgICAgcmV0dXJuIGNvbWI7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmdW5jdGlvbiBmbiQoaXQpe1xuICAgICAgICAgICAgcmV0dXJuIGl0LmlkID09PSBjb3N0Lm1hdElkO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBGaW5kIGFybW9ycyBmaXQgZm9yIHVzaW5nIGluIGNhbGN1bGF0aW9ucy5cbiAgICAgKi9cbiAgICBwcm90b3R5cGUuZmluZFVzYWJsZUFybW9ycyA9IGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgdGhpcyQgPSB0aGlzO1xuICAgICAgcmV0dXJuIHRoaXMuX2ludmVudG9yeVN2Yy5sb2FkKCkudGhlbihmdW5jdGlvbihpbnZlbnRvcnkpe1xuICAgICAgICByZXR1cm4gdGhpcyQuJHEuYWxsKG1hcChmdW5jdGlvbihlbnRyeSl7XG4gICAgICAgICAgcmV0dXJuIHRoaXMkLl9pdGVtU3ZjLmZpbmRBbnlJdGVtQnlVaWQoZW50cnkudWlkKTtcbiAgICAgICAgfSkoXG4gICAgICAgIGZpbHRlcihmdW5jdGlvbihpdCl7XG4gICAgICAgICAgcmV0dXJuIGl0Lml0ZW1UeXBlID09PSAnYXJtb3InO1xuICAgICAgICB9KShcbiAgICAgICAgaW52ZW50b3J5KSkpO1xuICAgICAgfSkudGhlbihmdW5jdGlvbihhcm1vcnMpe1xuICAgICAgICByZXR1cm4gZmlsdGVyKGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgICByZXR1cm4gaXQud2VpZ2h0IDw9IHRoaXMkLmZyZWVXZWlnaHQ7XG4gICAgICAgIH0pKFxuICAgICAgICBhcm1vcnMpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBUYWtlIGEgbGlzdCBvZiBhcm1vcnMgYW5kIGdlbmVyYXRlIGV2ZXJ5IHBvc3NpYmxlIGNvbWJpbmF0aW9uIG9mIHRoZW1cbiAgICAgKiB3aXRoaW4gdGhlIGN1cnJlbnQgd2VpZ2h0IGxpbWl0LlxuICAgICAqIEByZXR1cm5zIFByb21pc2UgdGhhdCB3aWxsIGJlIHJlc29sdmVkIHdpdGggYW4gYXJyYXkgb2YgY29tYmluYXRpb25zLlxuICAgICAqL1xuICAgIHByb3RvdHlwZS5maW5kQWxsQ29tYmluYXRpb25zT2YgPSBmdW5jdGlvbihhcm1vcnMpe1xuICAgICAgdmFyIGRlZiwgY29tYmluYXRpb25zLCBlbXB0aWVzLCBpJCwgcmVmJCwgbGVuJCwgaW5kZXgsIHR5cGUsIGVtcHR5LCBncm91cE9mLCBsZW5ndGhzLCBjb21iQ291bnQsIHByb2QsIHNwbGl0QXQsIGIsIGNvbWJpbmF0aW9uSW5kZXgsIGluZGV4ZXMsIGEsIGNvbWJpbmF0aW9uLCBsb2csIGNpS2V5LCBzZXEsIGtleSwgcGllY2UsIHgkLCBzcGxpdCwganVtcFRvLCBjb21iLCB0aGlzJCA9IHRoaXM7XG4gICAgICBkZWYgPSB0aGlzLiRxLmRlZmVyKCk7XG4gICAgICBjb21iaW5hdGlvbnMgPSBbXTtcbiAgICAgIGVtcHRpZXMgPSBbXTtcbiAgICAgIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZiQgPSB0aGlzLmFybW9yVHlwZXMpLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgIGluZGV4ID0gaSQ7XG4gICAgICAgIHR5cGUgPSByZWYkW2kkXTtcbiAgICAgICAgZW1wdHkgPSBmaW5kKGZuJCkoXG4gICAgICAgIGFybW9ycyk7XG4gICAgICAgIGlmIChlbXB0eSA9PSBudWxsKSB7XG4gICAgICAgICAgZW1wdHkgPSB0aGlzLl9pdGVtU3ZjLmNyZWF0ZUl0ZW1Nb2RlbEZyb20oe1xuICAgICAgICAgICAgaXRlbVR5cGU6ICdhcm1vcicsXG4gICAgICAgICAgICBuYW1lOiBcIihiYXJlIFwiICsgdHlwZSArIFwiKVwiLFxuICAgICAgICAgICAgYXJtb3JUeXBlOiB0eXBlLFxuICAgICAgICAgICAgd2VpZ2h0OiAwLFxuICAgICAgICAgICAgdXBncmFkZUlkOiAtMSxcbiAgICAgICAgICAgIGlkOiAtKGluZGV4ICsgMSlcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBhcm1vcnMucHVzaChlbXB0eSk7XG4gICAgICAgIH1cbiAgICAgICAgZW1wdGllcy5wdXNoKGVtcHR5KTtcbiAgICAgIH1cbiAgICAgIGdyb3VwT2YgPSBncm91cEJ5KGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgcmV0dXJuIGl0LmFybW9yVHlwZTtcbiAgICAgIH0pKFxuICAgICAgYXJtb3JzKTtcbiAgICAgIGxlbmd0aHMgPSBtYXAoZnVuY3Rpb24oaXQpe1xuICAgICAgICByZXR1cm4gKGl0ICE9IG51bGwgPyBpdC5sZW5ndGggOiB2b2lkIDgpIHx8IDA7XG4gICAgICB9KShcbiAgICAgIFtncm91cE9mWydoZWFkJ10sIGdyb3VwT2ZbJ2NoZXN0J10sIGdyb3VwT2ZbJ2hhbmRzJ10sIGdyb3VwT2ZbJ2xlZ3MnXV0pO1xuICAgICAgY29tYkNvdW50ID0gcHJvZHVjdChcbiAgICAgIGxlbmd0aHMpO1xuICAgICAgcHJvZCA9IDE7XG4gICAgICBzcGxpdEF0ID0gWzAsIDAsIDAsIDBdO1xuICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSAocmVmJCA9IFsxLCAzLCAwLCAyXSkubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgICAgYiA9IHJlZiRbaSRdO1xuICAgICAgICBwcm9kICo9IGxlbmd0aHNbYl07XG4gICAgICAgIHNwbGl0QXRbYl0gPSBjb21iQ291bnQgLyBwcm9kO1xuICAgICAgfVxuICAgICAgY29tYmluYXRpb25JbmRleCA9IHt9O1xuICAgICAgaW5kZXhlcyA9IFswLCAwLCAwLCAwXTtcbiAgICAgIGEgPSAwO1xuICAgICAgd2hpbGUgKCsrYSA8PSBjb21iQ291bnQpIHtcbiAgICAgICAgY29tYmluYXRpb24gPSB7XG4gICAgICAgICAgYXJtb3JzOiBbbnVsbCwgbnVsbCwgbnVsbCwgbnVsbF0sXG4gICAgICAgICAgd2VpZ2h0OiAwXG4gICAgICAgIH07XG4gICAgICAgIGxvZyA9IFtdO1xuICAgICAgICBsb2cucHVzaChhICsgXCIgOiBcIiArIGpvaW4oJywnKShcbiAgICAgICAgaW5kZXhlcykpO1xuICAgICAgICBjaUtleSA9IFwiXCI7XG4gICAgICAgIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZiQgPSBzZXEgPSBbMSwgMywgMCwgMl0pLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgICAga2V5ID0gaSQ7XG4gICAgICAgICAgYiA9IHJlZiRbaSRdO1xuICAgICAgICAgIGlmIChjb21iaW5hdGlvbi53ZWlnaHQgPCB0aGlzLmZyZWVXZWlnaHQpIHtcbiAgICAgICAgICAgIHBpZWNlID0gZ3JvdXBPZlt0aGlzLmFybW9yVHlwZXNbYl1dW2luZGV4ZXNbYl1dO1xuICAgICAgICAgICAgbG9nLnB1c2goY29tYmluYXRpb24ud2VpZ2h0ICsgXCIgPCBcIiArIHRoaXMuZnJlZVdlaWdodCArIFwiID0+ICtcIiArIGluZGV4ZXNbYl0gKyBcIiAoXCIgKyBwaWVjZS5uYW1lICsgXCIpXCIpO1xuICAgICAgICAgICAgeCQgPSBjb21iaW5hdGlvbjtcbiAgICAgICAgICAgIHgkLmFybW9yc1tiXSA9IHBpZWNlO1xuICAgICAgICAgICAgeCQud2VpZ2h0ICs9IHBpZWNlLndlaWdodDtcbiAgICAgICAgICAgIGNpS2V5ICs9IChwaWVjZS5pZCA+IDBcbiAgICAgICAgICAgICAgPyBpbmRleGVzW2JdXG4gICAgICAgICAgICAgIDogcGllY2UuaWQpICsgXCIsXCI7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChjb21iaW5hdGlvbi53ZWlnaHQgPT09IHRoaXMuZnJlZVdlaWdodCkge1xuICAgICAgICAgICAgICBsb2cucHVzaChjb21iaW5hdGlvbi53ZWlnaHQgKyBcIiA9PSBcIiArIHRoaXMuZnJlZVdlaWdodCArIFwiID0+ICtcIiArIGVtcHRpZXNbYl0ubmFtZSk7XG4gICAgICAgICAgICAgIGNvbWJpbmF0aW9uLmFybW9yc1tiXSA9IGVtcHRpZXNbYl07XG4gICAgICAgICAgICAgIGNpS2V5ICs9IGVtcHRpZXNbYl0uaWQgKyBcIixcIjtcbiAgICAgICAgICAgICAgaWYgKGtleSA+IDApIHtcbiAgICAgICAgICAgICAgICBzcGxpdCA9IHNwbGl0QXRbc2VxW2tleSAtIDFdXTtcbiAgICAgICAgICAgICAgICBqdW1wVG8gPSBhICsgKHNwbGl0IC0gYSAlIHNwbGl0KTtcbiAgICAgICAgICAgICAgICBpZiAoanVtcFRvICE9PSBhKSB7XG4gICAgICAgICAgICAgICAgICBsb2cucHVzaChcIkp1bXBpbmcgdG8gXCIgKyBhICsgXCIgKyAoXCIgKyBzcGxpdCArIFwiIC0gXCIgKyBhICsgXCIgJSBcIiArIHNwbGl0ICsgXCIpID0gXCIgKyBqdW1wVG8pO1xuICAgICAgICAgICAgICAgICAgYSA9IGp1bXBUbztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbWJpbmF0aW9uLndlaWdodCA8PSB0aGlzLmZyZWVXZWlnaHQpIHtcbiAgICAgICAgICBpZiAoY29tYmluYXRpb25JbmRleFtjaUtleV0gIT0gbnVsbCkge1xuICAgICAgICAgICAgbG9nLnB1c2goXCJDb21iaW5hdGlvbiBbXCIgKyBjaUtleSArIFwiXSBhbHJlYWR5IGFkZGVkLCBza2lwcGluZ1wiKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbG9nLnB1c2goXCJBZGRpbmcgY29tYmluYXRpb24gW1wiICsgY2lLZXkgKyBcIl0gdG8gbGlzdFwiKTtcbiAgICAgICAgICAgIGNvbWJpbmF0aW9uSW5kZXhbY2lLZXldID0gdHJ1ZTtcbiAgICAgICAgICAgIGNvbWJpbmF0aW9ucy5wdXNoKGNvbWJpbmF0aW9uKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHRoaXMuX2RlYnVnTG9nKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhqb2luKFwiXFxuXCIpKFxuICAgICAgICAgICAgbG9nKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZiQgPSBbMSwgMywgMCwgMl0pLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgICAgYiA9IHJlZiRbaSRdO1xuICAgICAgICAgIGlmIChhICUgc3BsaXRBdFtiXSA9PT0gMCkge1xuICAgICAgICAgICAgaW5kZXhlc1tiXSA9IChpbmRleGVzW2JdICsgMSkgJSBsZW5ndGhzW2JdO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKGkkID0gMCwgbGVuJCA9IGNvbWJpbmF0aW9ucy5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgICBjb21iID0gY29tYmluYXRpb25zW2kkXTtcbiAgICAgICAgY29tYi5uYW1lcyA9IG1hcChmbjEkKShcbiAgICAgICAgY29tYi5hcm1vcnMpO1xuICAgICAgICBjb21iLnBpZWNlcyA9IGpvaW4oJywnKShcbiAgICAgICAgbWFwKGZuMiQpKFxuICAgICAgICBjb21iLmFybW9ycykpO1xuICAgICAgICBjb21iLnVwZ3JhZGVMZXZlbCA9IHN1bShcbiAgICAgICAgbWFwKGZuMyQpKFxuICAgICAgICBjb21iLmFybW9ycykpO1xuICAgICAgfVxuICAgICAgZGVmLnJlc29sdmUoY29tYmluYXRpb25zKTtcbiAgICAgIHJldHVybiBkZWYucHJvbWlzZTtcbiAgICAgIGZ1bmN0aW9uIGZuJChpdCl7XG4gICAgICAgIHJldHVybiBpdC5hcm1vclR5cGUgPT09IHR5cGUgJiYgaXQud2VpZ2h0ID09PSAwO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gZm4xJChpdCl7XG4gICAgICAgIHJldHVybiBpdCAhPSBudWxsID8gaXQubmFtZSA6IHZvaWQgODtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIGZuMiQoaXQpe1xuICAgICAgICByZXR1cm4gdGhpcyQuX2l0ZW1TdmMudXBncmFkZUNvbXAuZ2V0QmFzZUlkRnJvbShpdC5pZCk7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBmbjMkKGl0KXtcbiAgICAgICAgdmFyIHJlZiQ7XG4gICAgICAgIHJldHVybiAocmVmJCA9IGl0LnVwZ3JhZGVMZXZlbCkgIT0gbnVsbCA/IHJlZiQgOiAwO1xuICAgICAgfVxuICAgIH07XG4gICAgcHJvdG90eXBlLmNhbGN1bGF0ZVNjb3JlRm9yID0gZnVuY3Rpb24oY29tYmluYXRpb24pe1xuICAgICAgdmFyIHJlZiQsIGkkLCBsZW4kLCBhcm1vciwgaiQsIHJlZjEkLCBsZW4xJCwgbW9kLCBtb2RpZmllciwgcmVmMiQsIGJhc2VWYWx1ZSwgc2NvcmU7XG4gICAgICBjb21iaW5hdGlvbi5zY29yZSA9IDA7XG4gICAgICBjb21iaW5hdGlvbi5kZXRhaWxTY29yZXMgPSB7fTtcbiAgICAgIChyZWYkID0gdGhpcy5wYXJhbXMpLm1vZGlmaWVycyA9PSBudWxsICYmIChyZWYkLm1vZGlmaWVycyA9IHtcbiAgICAgICAgcGh5OiAyLFxuICAgICAgICBwb2lzZTogMVxuICAgICAgfSk7XG4gICAgICBmb3IgKGkkID0gMCwgbGVuJCA9IChyZWYkID0gY29tYmluYXRpb24uYXJtb3JzKS5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgICBhcm1vciA9IHJlZiRbaSRdO1xuICAgICAgICBhcm1vci5zY29yZSA9IDA7XG4gICAgICAgIGZvciAoaiQgPSAwLCBsZW4xJCA9IChyZWYxJCA9IFsnUGh5JywgJ01hZycsICdGaXInLCAnTGl0JywgJ0JsbycsICdUb3gnLCAnQ3VyJywgJ1BvaXNlJ10pLmxlbmd0aDsgaiQgPCBsZW4xJDsgKytqJCkge1xuICAgICAgICAgIG1vZCA9IHJlZjEkW2okXTtcbiAgICAgICAgICBtb2RpZmllciA9IChyZWYyJCA9IHRoaXMucGFyYW1zLm1vZGlmaWVyc1ttb2QudG9Mb3dlckNhc2UoKV0pICE9IG51bGwgPyByZWYyJCA6IDA7XG4gICAgICAgICAgYmFzZVZhbHVlID0gKHJlZjIkID0gYXJtb3JbXCJkZWZcIiArIG1vZF0pICE9IG51bGwgPyByZWYyJCA6IDA7XG4gICAgICAgICAgc2NvcmUgPSBiYXNlVmFsdWUgKiBtb2RpZmllcjtcbiAgICAgICAgICBhcm1vci5zY29yZSArPSBzY29yZTtcbiAgICAgICAgICBjb21iaW5hdGlvbi5kZXRhaWxTY29yZXNbbW9kLnRvTG93ZXJDYXNlKCldID0gYmFzZVZhbHVlICsgKChyZWYyJCA9IGNvbWJpbmF0aW9uLmRldGFpbFNjb3Jlc1ttb2QudG9Mb3dlckNhc2UoKV0pICE9IG51bGwgPyByZWYyJCA6IDApO1xuICAgICAgICB9XG4gICAgICAgIGNvbWJpbmF0aW9uLnNjb3JlICs9IGFybW9yLnNjb3JlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNvbWJpbmF0aW9uLnNjb3JlO1xuICAgIH07XG4gICAgcmV0dXJuIEFybW9yQ2FsY1N2YztcbiAgfSgpKTtcbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlICE9PSBudWxsKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBBcm1vckNhbGNTdmM7XG4gIH1cbiAgZnVuY3Rpb24gYmluZCQob2JqLCBrZXksIHRhcmdldCl7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiAodGFyZ2V0IHx8IG9iailba2V5XS5hcHBseShvYmosIGFyZ3VtZW50cykgfTtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiIsIihmdW5jdGlvbigpe1xuICBpZiAodHlwZW9mIG1vZHVsZSAhPSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09IG51bGwpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHVpR3JpZENvbnN0YW50cyl7XG4gICAgICB2YXIgcGVyY2VudEZpZWxkTWluV2lkdGg7XG4gICAgICBwZXJjZW50RmllbGRNaW5XaWR0aCA9IDQ1O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29sdW1uRGVmczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAnc2NvcmUnLFxuICAgICAgICAgICAgd2lkdGg6IDc1LFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogJ251bWJlcjoyJyxcbiAgICAgICAgICAgIHNvcnQ6IHtcbiAgICAgICAgICAgICAgZGlyZWN0aW9uOiB1aUdyaWRDb25zdGFudHMuREVTQyxcbiAgICAgICAgICAgICAgcHJpb3JpdHk6IDBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnd2VpZ2h0JyxcbiAgICAgICAgICAgIHdpZHRoOiA1MCxcbiAgICAgICAgICAgIGNlbGxGaWx0ZXI6ICdudW1iZXI6MicsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgICAgIHNvcnQ6IHtcbiAgICAgICAgICAgICAgZGlyZWN0aW9uOiB1aUdyaWRDb25zdGFudHMuQVNDLFxuICAgICAgICAgICAgICBwcmlvcml0eTogMVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnYXJtb3JzJyxcbiAgICAgICAgICAgIG1pbldpZHRoOiA3MDBcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2RldGFpbFNjb3Jlcy5waHknLFxuICAgICAgICAgICAgbWluV2lkdGg6IDUwLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogJ251bWJlcjoyJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdQaHlzLidcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2RldGFpbFNjb3Jlcy5tYWcnLFxuICAgICAgICAgICAgbWluV2lkdGg6IDUwLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogJ251bWJlcjoyJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdNYWdpYydcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2RldGFpbFNjb3Jlcy5maXInLFxuICAgICAgICAgICAgbWluV2lkdGg6IDUwLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogJ251bWJlcjoyJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdGaXJlJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnZGV0YWlsU2NvcmVzLmxpdCcsXG4gICAgICAgICAgICBtaW5XaWR0aDogNTAsXG4gICAgICAgICAgICBjZWxsRmlsdGVyOiAnbnVtYmVyOjInLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0xpZ2h0LidcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2RldGFpbFNjb3Jlcy5ibG8nLFxuICAgICAgICAgICAgbWluV2lkdGg6IDUwLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogJ251bWJlcjoyJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdCbGVlZCdcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2RldGFpbFNjb3Jlcy50b3gnLFxuICAgICAgICAgICAgbWluV2lkdGg6IDUwLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogJ251bWJlcjoyJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdUb3guJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnZGV0YWlsU2NvcmVzLmN1cicsXG4gICAgICAgICAgICBtaW5XaWR0aDogNTAsXG4gICAgICAgICAgICBjZWxsRmlsdGVyOiAnbnVtYmVyOjInLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0N1cnNlJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnZGV0YWlsU2NvcmVzLnBvaXNlJyxcbiAgICAgICAgICAgIG1pbldpZHRoOiA1MCxcbiAgICAgICAgICAgIGNlbGxGaWx0ZXI6ICdudW1iZXI6MicsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnUG9pc2UnXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9O1xuICAgIH07XG4gIH1cbn0pLmNhbGwodGhpcyk7XG4iLCIoZnVuY3Rpb24oKXtcbiAgYW5ndWxhci5tb2R1bGUoXCJkc2NcIik7XG4gIHJlcXVpcmUoJy4vYXJtb3ItY2FsYy1zZXJ2aWNlJyk7XG4gIHJlcXVpcmUoJy4vYXJtb3ItY2FsYy1jb250cm9sbGVyJyk7XG59KS5jYWxsKHRoaXMpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gIGFuZ3VsYXIubW9kdWxlKFwiZHNjXCIpLmNvbnRyb2xsZXIoXCJHdWlkZUNvbnRyb2xsZXJcIiwgZnVuY3Rpb24oJHNjZSwgJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyZXNvdXJjZSwgZ3VpZGVTZXJ2aWNlLCBzdG9yYWdlU3ZjKXtcbiAgICB2YXIgX2dldEFycm93Rm9yLCBfcHJlcGFyZUd1aWRlQ29udGVudCwgX3NhdmVVc2VyRGF0YSwgX2xvYWRVc2VyRGF0YSwgZGF0YTtcbiAgICAkc2NvcGUuc2VjdGlvbnMgPSBbXG4gICAgICB7XG4gICAgICAgIGlkOiAnaW50cm8nLFxuICAgICAgICBuYW1lOiBcIkludHJvXCJcbiAgICAgIH0sIHtcbiAgICAgICAgaWQ6ICdhc3lsdW0nLFxuICAgICAgICBuYW1lOiBcIk5vcnRoZXJuIFVuZGVhZCBBc3lsdW1cIlxuICAgICAgfSwge1xuICAgICAgICBpZDogJ2ZpcmVsaW5rJyxcbiAgICAgICAgbmFtZTogXCJGaXJlbGluayBTaHJpbmVcIlxuICAgICAgfSwge1xuICAgICAgICBpZDogJ2J1cmcnLFxuICAgICAgICBuYW1lOiBcIlVuZGVhZCBCdXJnXCJcbiAgICAgIH0sIHtcbiAgICAgICAgaWQ6ICdwYXJpc2gnLFxuICAgICAgICBuYW1lOiBcIlVuZGVhZCBQYXJpc2hcIlxuICAgICAgfSwge1xuICAgICAgICBpZDogJ2xvdycsXG4gICAgICAgIG5hbWU6IFwiTG93ZXIgVW5kZWFkIEJ1cmdcIlxuICAgICAgfSwge1xuICAgICAgICBpZDogJ2RlcHRocycsXG4gICAgICAgIG5hbWU6IFwiVGhlIERlcHRoc1wiXG4gICAgICB9LCB7XG4gICAgICAgIGlkOiAnYmxpZ2h0JyxcbiAgICAgICAgbmFtZTogXCJCbGlnaHR0b3duXCJcbiAgICAgIH0sIHtcbiAgICAgICAgaWQ6ICdxdWVsYWFnJyxcbiAgICAgICAgbmFtZTogXCJRdWVsYWFnJ3MgRG9tYWluXCJcbiAgICAgIH1cbiAgICBdO1xuICAgICRzY29wZS5zZWN0aW9uID0gJHJvdXRlUGFyYW1zWydzZWN0aW9uJ107XG4gICAgJHNjb3BlLnVzZXJEYXRhID0gbnVsbDtcbiAgICAkc2NvcGUuZW50cnlJbmRleCA9IHt9O1xuICAgIF9nZXRBcnJvd0ZvciA9IGZ1bmN0aW9uKGVudHJ5KXtcbiAgICAgIGlmICghKGVudHJ5Lm1ldGEgfHwgKGVudHJ5Lm1ldGEgPSB7fSkpLmlzRXhwYW5kYWJsZSkge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgICB9XG4gICAgICByZXR1cm4gKGVudHJ5Lm1ldGEgfHwgKGVudHJ5Lm1ldGEgPSB7fSkpLmlzQ29sbGFwc2VkID8gJ1suLl0nIDogJyc7XG4gICAgfTtcbiAgICBfcHJlcGFyZUd1aWRlQ29udGVudCA9IGZ1bmN0aW9uKGVudHJ5KXtcbiAgICAgIHZhciB1c2VyTWV0YSwgcmVmJCwgcmVmMSQsIHgkLCBpJCwgbGVuJCwgY2hlY2ssIGNoaWxkO1xuICAgICAgaWYgKGVudHJ5LmlkICE9IG51bGwpIHtcbiAgICAgICAgJHNjb3BlLmVudHJ5SW5kZXhbZW50cnkuaWRdID0gZW50cnk7XG4gICAgICB9XG4gICAgICBpZiAoZW50cnkuY29udGVudCAhPSBudWxsKSB7XG4gICAgICAgIGVudHJ5LmNvbnRlbnQgPSAkc2NlLnRydXN0QXNIdG1sKGVudHJ5LmNvbnRlbnQpO1xuICAgICAgfVxuICAgICAgdXNlck1ldGEgPSAocmVmJCA9ICgocmVmMSQgPSAkc2NvcGUudXNlckRhdGEgfHwgKCRzY29wZS51c2VyRGF0YSA9IHt9KSkuZW50cnlNZXRhIHx8IChyZWYxJC5lbnRyeU1ldGEgPSB7fSkpW2VudHJ5LmlkXSkgIT0gbnVsbFxuICAgICAgICA/IHJlZiRcbiAgICAgICAgOiB7fTtcbiAgICAgIHgkID0gZW50cnkubWV0YSB8fCAoZW50cnkubWV0YSA9IHt9KTtcbiAgICAgIHgkLmlzQ29sbGFwc2VkID0gKHJlZiQgPSB1c2VyTWV0YS5pc0NvbGxhcHNlZCkgIT0gbnVsbFxuICAgICAgICA/IHJlZiRcbiAgICAgICAgOiBlbnRyeS5jb250ZW50ICE9IG51bGw7XG4gICAgICB4JC5pc0RvbmUgPSAocmVmJCA9IHVzZXJNZXRhLmlzRG9uZSkgIT0gbnVsbCA/IHJlZiQgOiBmYWxzZTtcbiAgICAgIHgkLmlzRXhwYW5kYWJsZSA9IGVudHJ5LmNoaWxkcmVuICE9IG51bGwgfHwgZW50cnkuY29udGVudCAhPSBudWxsO1xuICAgICAgeCQuYXJyb3cgPSBfZ2V0QXJyb3dGb3IoZW50cnkpO1xuICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSAocmVmJCA9IFsnY29udGVudCcsICdjaGlsZHJlbiddKS5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgICBjaGVjayA9IHJlZiRbaSRdO1xuICAgICAgICAoKHJlZjEkID0gZW50cnkubWV0YSB8fCAoZW50cnkubWV0YSA9IHt9KSkuYWRkaXRpb25hbENsYXNzZXMgfHwgKHJlZjEkLmFkZGl0aW9uYWxDbGFzc2VzID0gW10pKS5wdXNoKGVudHJ5W2NoZWNrXSAhPSBudWxsXG4gICAgICAgICAgPyBcIndpdGgtXCIgKyBjaGVja1xuICAgICAgICAgIDogXCJ3aXRob3V0LVwiICsgY2hlY2spO1xuICAgICAgfVxuICAgICAgaWYgKGVudHJ5LmNoaWxkcmVuICE9IG51bGwpIHtcbiAgICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSAocmVmJCA9IGVudHJ5LmNoaWxkcmVuKS5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgICAgIGNoaWxkID0gcmVmJFtpJF07XG4gICAgICAgICAgX3ByZXBhcmVHdWlkZUNvbnRlbnQoY2hpbGQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICBfc2F2ZVVzZXJEYXRhID0gZnVuY3Rpb24oKXtcbiAgICAgIHZhciBpZCwgcmVmJCwgZW50cnksIGkkLCByZWYxJCwgbGVuJCwgZmllbGQsIHJlZjIkLCByZWYzJDtcbiAgICAgIGZvciAoaWQgaW4gcmVmJCA9ICRzY29wZS5lbnRyeUluZGV4KSB7XG4gICAgICAgIGVudHJ5ID0gcmVmJFtpZF07XG4gICAgICAgIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZjEkID0gWydpc0NvbGxhcHNlZCcsICdpc0RvbmUnXSkubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgICAgICBmaWVsZCA9IHJlZjEkW2kkXTtcbiAgICAgICAgICAoKHJlZjIkID0gKHJlZjMkID0gJHNjb3BlLnVzZXJEYXRhIHx8ICgkc2NvcGUudXNlckRhdGEgPSB7fSkpLmVudHJ5TWV0YSB8fCAocmVmMyQuZW50cnlNZXRhID0ge30pKVtpZF0gfHwgKHJlZjIkW2lkXSA9IHt9KSlbZmllbGRdID0gZW50cnkubWV0YVtmaWVsZF07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHN0b3JhZ2VTdmMuc2F2ZSgnZ3VpZGU6dXNlckRhdGEnLCAkc2NvcGUudXNlckRhdGEpO1xuICAgIH07XG4gICAgX2xvYWRVc2VyRGF0YSA9IGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgcmVmJDtcbiAgICAgICRzY29wZS51c2VyRGF0YSA9IChyZWYkID0gc3RvcmFnZVN2Yy5sb2FkKCdndWlkZTp1c2VyRGF0YScpKSAhPSBudWxsXG4gICAgICAgID8gcmVmJFxuICAgICAgICA6IHt9O1xuICAgIH07XG4gICAgX2xvYWRVc2VyRGF0YSgpO1xuICAgIGRhdGEgPSBndWlkZVNlcnZpY2UuZ2V0Q29udGVudEZvcigkc2NvcGUuc2VjdGlvbik7XG4gICAgJHNjb3BlLmVudHJ5ID0ge1xuICAgICAgY2hpbGRyZW46IGRhdGFcbiAgICB9O1xuICAgIGRhdGEuJHByb21pc2UudGhlbihmdW5jdGlvbigpe1xuICAgICAgX3ByZXBhcmVHdWlkZUNvbnRlbnQoJHNjb3BlLmVudHJ5KTtcbiAgICB9KTtcbiAgICAkc2NvcGUuY2FuQWRkVG9JbnZlbnRvcnkgPSBmdW5jdGlvbihlbnRyeSl7XG4gICAgICB2YXIgY2FuO1xuICAgICAgY2FuID0gYW55KChmdW5jdGlvbihpdCl7XG4gICAgICAgIHJldHVybiBpdCA9PT0gJ2l0ZW0nO1xuICAgICAgfSkpKFxuICAgICAgZW50cnkubGFiZWxzIHx8IChlbnRyeS5sYWJlbHMgPSBbXSkpO1xuICAgICAgY2FuID0gY2FuICYmICFhbnkoKGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgcmV0dXJuIGl0ID09PSAnYWJzdHJhY3QnO1xuICAgICAgfSkpKFxuICAgICAgZW50cnkuZmxhZ3MgfHwgKGVudHJ5LmZsYWdzID0gW10pKTtcbiAgICAgIHJldHVybiBjYW47XG4gICAgfTtcbiAgICAkc2NvcGUuZW50cnlDbGlja2VkID0gZnVuY3Rpb24oJGV2ZW50LCBlbnRyeSl7XG4gICAgICB2YXIgeCQ7XG4gICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBpZiAoIShlbnRyeS5tZXRhIHx8IChlbnRyeS5tZXRhID0ge30pKS5pc0V4cGFuZGFibGUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgeCQgPSBlbnRyeS5tZXRhIHx8IChlbnRyeS5tZXRhID0ge30pO1xuICAgICAgeCQuaXNDb2xsYXBzZWQgPSAhKGVudHJ5Lm1ldGEgfHwgKGVudHJ5Lm1ldGEgPSB7fSkpLmlzQ29sbGFwc2VkO1xuICAgICAgeCQuYXJyb3cgPSBfZ2V0QXJyb3dGb3IoZW50cnkpO1xuICAgICAgX3NhdmVVc2VyRGF0YSgpO1xuICAgIH07XG4gICAgJHNjb3BlLmVudHJ5RG9uZSA9IGZ1bmN0aW9uKGVudHJ5KXtcbiAgICAgIGVudHJ5Lm1ldGEuaXNEb25lID0gdHJ1ZTtcbiAgICAgIF9zYXZlVXNlckRhdGEoKTtcbiAgICB9O1xuICB9KTtcbn0pLmNhbGwodGhpcyk7XG4iLCIoZnVuY3Rpb24oKXtcbiAgYW5ndWxhci5tb2R1bGUoXCJkc2NcIikuc2VydmljZShcImd1aWRlU2VydmljZVwiLCBmdW5jdGlvbigkcmVzb3VyY2Upe1xuICAgIHZhciBzdmM7XG4gICAgc3ZjID0ge307XG4gICAgc3ZjLmdldENvbnRlbnRGb3IgPSBmdW5jdGlvbihzZWN0aW9uKXtcbiAgICAgIHJldHVybiAkcmVzb3VyY2UoXCIvbW9kdWxlcy9ndWlkZS9jb250ZW50L1wiICsgc2VjdGlvbiArIFwiLmpzb25cIikucXVlcnkoKTtcbiAgICB9O1xuICAgIHJldHVybiBzdmM7XG4gIH0pO1xufSkuY2FsbCh0aGlzKTtcbiIsIihmdW5jdGlvbigpe1xuICByZXF1aXJlKCcuL2d1aWRlLWNvbnRyb2xsZXInKTtcbiAgcmVxdWlyZSgnLi9ndWlkZS1zZXJ2aWNlJyk7XG59KS5jYWxsKHRoaXMpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gIHZhciBJdGVtU2VydmljZVVwZ3JhZGVDb21wb25lbnQ7XG4gIEl0ZW1TZXJ2aWNlVXBncmFkZUNvbXBvbmVudCA9IChmdW5jdGlvbigpe1xuICAgIEl0ZW1TZXJ2aWNlVXBncmFkZUNvbXBvbmVudC5kaXNwbGF5TmFtZSA9ICdJdGVtU2VydmljZVVwZ3JhZGVDb21wb25lbnQnO1xuICAgIHZhciBwcm90b3R5cGUgPSBJdGVtU2VydmljZVVwZ3JhZGVDb21wb25lbnQucHJvdG90eXBlLCBjb25zdHJ1Y3RvciA9IEl0ZW1TZXJ2aWNlVXBncmFkZUNvbXBvbmVudDtcbiAgICBmdW5jdGlvbiBJdGVtU2VydmljZVVwZ3JhZGVDb21wb25lbnQoX2l0ZW1TdmMsIF9leHRlcm5hbERhdGFTdmMsIF9pdGVtSW5kZXhTdmMsIF9pbnZlbnRvcnlTdmMsICRxKXtcbiAgICAgIHRoaXMuX2l0ZW1TdmMgPSBfaXRlbVN2YztcbiAgICAgIHRoaXMuX2V4dGVybmFsRGF0YVN2YyA9IF9leHRlcm5hbERhdGFTdmM7XG4gICAgICB0aGlzLl9pdGVtSW5kZXhTdmMgPSBfaXRlbUluZGV4U3ZjO1xuICAgICAgdGhpcy5faW52ZW50b3J5U3ZjID0gX2ludmVudG9yeVN2YztcbiAgICAgIHRoaXMuJHEgPSAkcTtcbiAgICAgIHRoaXMuZmluZEFsbEF2YWlsYWJsZVVwZ3JhZGVzRm9yID0gYmluZCQodGhpcywgJ2ZpbmRBbGxBdmFpbGFibGVVcGdyYWRlc0ZvcicsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmFwcGx5ID0gYmluZCQodGhpcywgJ2FwcGx5JywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuY2FuQmVVcGdyYWRlZEZ1cnRoZXIgPSBiaW5kJCh0aGlzLCAnY2FuQmVVcGdyYWRlZEZ1cnRoZXInLCBwcm90b3R5cGUpO1xuICAgICAgdGhpcy5jYW5CZVVwZ3JhZGVkID0gYmluZCQodGhpcywgJ2NhbkJlVXBncmFkZWQnLCBwcm90b3R5cGUpO1xuICAgICAgdGhpcy5pc1VwZ3JhZGVkID0gYmluZCQodGhpcywgJ2lzVXBncmFkZWQnLCBwcm90b3R5cGUpO1xuICAgICAgdGhpcy51cGdyYWRlTGV2ZWxPZiA9IGJpbmQkKHRoaXMsICd1cGdyYWRlTGV2ZWxPZicsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmVuc3VyZUl0Q2FuQmVVcGdyYWRlZCA9IGJpbmQkKHRoaXMsICdlbnN1cmVJdENhbkJlVXBncmFkZWQnLCBwcm90b3R5cGUpO1xuICAgICAgdGhpcy5sb2FkQWxsVXBncmFkZXMgPSBiaW5kJCh0aGlzLCAnbG9hZEFsbFVwZ3JhZGVzJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMubG9hZEFsbE1hdGVyaWFsU2V0cyA9IGJpbmQkKHRoaXMsICdsb2FkQWxsTWF0ZXJpYWxTZXRzJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuZGVkdWN0RnJvbSA9IGJpbmQkKHRoaXMsICdkZWR1Y3RGcm9tJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuYXJlID0gYmluZCQodGhpcywgJ2FyZScsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmZpbmRVcGdyYWRlTWF0ZXJpYWxzRm9yID0gYmluZCQodGhpcywgJ2ZpbmRVcGdyYWRlTWF0ZXJpYWxzRm9yJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuZmluZFVwZ3JhZGVGb3IgPSBiaW5kJCh0aGlzLCAnZmluZFVwZ3JhZGVGb3InLCBwcm90b3R5cGUpO1xuICAgICAgdGhpcy5maW5kQmFzZUl0ZW0gPSBiaW5kJCh0aGlzLCAnZmluZEJhc2VJdGVtJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuZ2V0QmFzZUl0ZW1JZE9mID0gYmluZCQodGhpcywgJ2dldEJhc2VJdGVtSWRPZicsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmdldFVwZ3JhZGVMZXZlbEZyb20gPSBiaW5kJCh0aGlzLCAnZ2V0VXBncmFkZUxldmVsRnJvbScsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmdldEJhc2VJZEZyb20gPSBiaW5kJCh0aGlzLCAnZ2V0QmFzZUlkRnJvbScsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLl91cGdyYWRlcyA9IHt9O1xuICAgICAgdGhpcy5fbWF0ZXJpYWxTZXRzID0gW107XG4gICAgfVxuICAgIHByb3RvdHlwZS5nZXRCYXNlSWRGcm9tID0gZnVuY3Rpb24oaWQpe1xuICAgICAgcmV0dXJuIGlkIC0gdGhpcy5nZXRVcGdyYWRlTGV2ZWxGcm9tKGlkKTtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5nZXRVcGdyYWRlTGV2ZWxGcm9tID0gZnVuY3Rpb24oaWQpe1xuICAgICAgcmV0dXJuIGlkICUgMTAwO1xuICAgIH07XG4gICAgcHJvdG90eXBlLmdldEJhc2VJdGVtSWRPZiA9IGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0QmFzZUlkRnJvbShpdGVtLmlkKTtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5maW5kQmFzZUl0ZW0gPSBmdW5jdGlvbihpdGVtKXtcbiAgICAgIHZhciB0aGlzJCA9IHRoaXM7XG4gICAgICByZXR1cm4gdGhpcy5faXRlbVN2Yy5maW5kSXRlbShpdGVtLml0ZW1UeXBlLCBmdW5jdGlvbihpdCl7XG4gICAgICAgIHJldHVybiBpdC5pZCA9PT0gdGhpcyQuZ2V0QmFzZUlkRnJvbShpdGVtLmlkKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogR2V0IHRoZSB1cGdyYWRlIG1vZGVsIGZvciBhIGdpdmVuIHdlYXBvbiBhdCBhIGdpdmVuIHVwZ3JhZGUgbGV2ZWxcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlLCByZXNvbHZlZCB3aXRoIHRoZSB1cGdyYWRlIChvciBudWxsIGlmIG5vdGhpbmcgZm91bmQpXG4gICAgICovXG4gICAgcHJvdG90eXBlLmZpbmRVcGdyYWRlRm9yID0gZnVuY3Rpb24oaXRlbSwgbGV2ZWwpe1xuICAgICAgdmFyIHRoaXMkID0gdGhpcztcbiAgICAgIHJldHVybiB0aGlzLmxvYWRBbGxVcGdyYWRlcyhpdGVtLml0ZW1UeXBlKS50aGVuKGZ1bmN0aW9uKHVwZ3JhZGVzKXtcbiAgICAgICAgcmV0dXJuIGZpbmQoZnVuY3Rpb24oaXQpe1xuICAgICAgICAgIHJldHVybiBpdC5pZCA9PT0gdGhpcyQuZ2V0QmFzZUlkRnJvbShpdGVtLnVwZ3JhZGVJZCkgKyBsZXZlbDtcbiAgICAgICAgfSkoXG4gICAgICAgIHVwZ3JhZGVzKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogRmluZCB0aGUgbWF0ZXJpYWxzIHJlcXVpcmVkIHRvIHVwZ3JhZGUgYSBnaXZlbiBpdGVtIHVzaW5nIGEgZ2l2ZW4gdXBncmFkZSBtb2RlbC5cbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHRoYXQgaXMgcmVzb2x2ZWQgd2l0aCB0aGUgbWF0ZXJpYWwgZGF0YS5cbiAgICAgKi9cbiAgICBwcm90b3R5cGUuZmluZFVwZ3JhZGVNYXRlcmlhbHNGb3IgPSBmdW5jdGlvbihpdGVtLCB1cGdyYWRlKXtcbiAgICAgIHZhciB4JCwgdGhpcyQgPSB0aGlzO1xuICAgICAgaWYgKCEoaXRlbSAhPSBudWxsICYmIHVwZ3JhZGUgIT0gbnVsbCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3QgZmluZCB1cGdyYWRlIG1hdGVyaWFscywgZWl0aGVyIGl0ZW0gb3IgdXBncmFkZSBpcyB1bnNldC5cIik7XG4gICAgICB9XG4gICAgICBpZiAoaXRlbS5tYXRTZXRJZCA8IDApIHtcbiAgICAgICAgeCQgPSB0aGlzLiRxLmRlZmVyKCk7XG4gICAgICAgIHgkLnJlc29sdmUobnVsbCk7XG4gICAgICAgIHJldHVybiB4JC5wcm9taXNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMubG9hZEFsbE1hdGVyaWFsU2V0cygpLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIGZpbmQoZnVuY3Rpb24oaXQpe1xuICAgICAgICAgIHJldHVybiBpdC5pZCA9PT0gdGhpcyQuZ2V0QmFzZUlkRnJvbShpdGVtLm1hdFNldElkKSArIHVwZ3JhZGUubWF0U2V0SWQ7XG4gICAgICAgIH0pKFxuICAgICAgICB0aGlzJC5fbWF0ZXJpYWxTZXRzKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgcHJvdG90eXBlLmFyZSA9IGZ1bmN0aW9uKG1hdGVyaWFscyl7XG4gICAgICB2YXIgdGhpcyQgPSB0aGlzO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZW5vdWdoVG9VcGdyYWRlOiBmdW5jdGlvbihpdGVtLCBsZXZlbCl7XG4gICAgICAgICAgcmV0dXJuIHRoaXMkLmZpbmRVcGdyYWRlRm9yKGl0ZW0sIGxldmVsKS50aGVuKGZ1bmN0aW9uKHVwZ3JhZGUpe1xuICAgICAgICAgICAgaWYgKHVwZ3JhZGUgPT0gbnVsbCkge1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcyQuZmluZFVwZ3JhZGVNYXRlcmlhbHNGb3IoaXRlbSwgdXBncmFkZSk7XG4gICAgICAgICAgfSkudGhlbihmdW5jdGlvbihtYXRlcmlhbFNldCl7XG4gICAgICAgICAgICBpZiAobWF0ZXJpYWxTZXQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFueShmdW5jdGlvbihpdCl7XG4gICAgICAgICAgICAgIHJldHVybiBpdC5pZCA9PT0gbWF0ZXJpYWxTZXQubWF0SWQgJiYgaXQuYW1vdW50ID49IG1hdGVyaWFsU2V0Lm1hdENvc3Q7XG4gICAgICAgICAgICB9KShcbiAgICAgICAgICAgIG1hdGVyaWFscyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICBwcm90b3R5cGUuZGVkdWN0RnJvbSA9IGZ1bmN0aW9uKG1hdGVyaWFscyl7XG4gICAgICB2YXIgdGhpcyQgPSB0aGlzO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29zdE9mVXBncmFkZTogZnVuY3Rpb24oaXRlbSwgbGV2ZWwpe1xuICAgICAgICAgIHJldHVybiB0aGlzJC5maW5kVXBncmFkZUZvcihpdGVtLCBsZXZlbCkudGhlbihmdW5jdGlvbih1cGdyYWRlKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzJC5maW5kVXBncmFkZU1hdGVyaWFsc0ZvcihpdGVtLCB1cGdyYWRlKTtcbiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKG1hdGVyaWFsU2V0KXtcbiAgICAgICAgICAgIGZpbmQoZnVuY3Rpb24oaXQpe1xuICAgICAgICAgICAgICByZXR1cm4gaXQuaWQgPT09IG1hdGVyaWFsU2V0Lm1hdElkO1xuICAgICAgICAgICAgfSkoXG4gICAgICAgICAgICBtYXRlcmlhbHMpLmFtb3VudCAtPSBtYXRlcmlhbFNldC5tYXRDb3N0O1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgbWF0Q29zdDogbWF0ZXJpYWxTZXQubWF0Q29zdCxcbiAgICAgICAgICAgICAgbWF0SWQ6IG1hdGVyaWFsU2V0Lm1hdElkXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG4gICAgLyoqXG4gICAgICogQXN5bmNocm9ub3VzbHkgbG9hZHMgYWxsIGluZm9ybWF0aW9uIG9uIG1hdGVyaWFsIHNldHMgcmVxdWlyZWQgZm9yIHVwZ3JhZGVzXG4gICAgICogQHJldHVybnMgUHJvbWlzZSB0aGF0IHdpbGwgYmUgcmVzb2x2ZWQgd2l0aCB0aGUgbWF0ZXJpYWwgc2V0IGRhdGEuXG4gICAgICovXG4gICAgcHJvdG90eXBlLmxvYWRBbGxNYXRlcmlhbFNldHMgPSBmdW5jdGlvbigpe1xuICAgICAgaWYgKHRoaXMuX21hdGVyaWFsU2V0cy4kcHJvbWlzZSA9PSBudWxsKSB7XG4gICAgICAgIHRoaXMuX21hdGVyaWFsU2V0cyA9IHRoaXMuX2V4dGVybmFsRGF0YVN2Yy5sb2FkSnNvbihcIi9tb2R1bGVzL2l0ZW1zL2NvbnRlbnQvbWF0ZXJpYWwtc2V0cy5qc29uXCIsIGZhbHNlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLl9tYXRlcmlhbFNldHMuJHByb21pc2U7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBMb2FkIGluZm9ybWF0aW9uIG9uIGFsbCB1cGdyYWRlcyBmb3IgYSBnaXZlbiBpdGVtIHR5cGVcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmVkIHdpdGggdGhlIHVwZ3JhZGUgZGF0YVxuICAgICAqL1xuICAgIHByb3RvdHlwZS5sb2FkQWxsVXBncmFkZXMgPSBmdW5jdGlvbihpdGVtVHlwZSl7XG4gICAgICB2YXIgcmVmJDtcbiAgICAgIHRoaXMuZW5zdXJlSXRDYW5CZVVwZ3JhZGVkKFxuICAgICAgaXRlbVR5cGUpO1xuICAgICAgaWYgKCgocmVmJCA9IHRoaXMuX3VwZ3JhZGVzKVtpdGVtVHlwZV0gfHwgKHJlZiRbaXRlbVR5cGVdID0gW10pKS4kcHJvbWlzZSA9PSBudWxsKSB7XG4gICAgICAgIHRoaXMuX3VwZ3JhZGVzW2l0ZW1UeXBlXSA9IHRoaXMuX2V4dGVybmFsRGF0YVN2Yy5sb2FkSnNvbihcIi9tb2R1bGVzL2l0ZW1zL2NvbnRlbnQvXCIgKyBpdGVtVHlwZSArIFwiLXVwZ3JhZGVzLmpzb25cIiwgZmFsc2UpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuX3VwZ3JhZGVzW2l0ZW1UeXBlXS4kcHJvbWlzZTtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5lbnN1cmVJdENhbkJlVXBncmFkZWQgPSBmdW5jdGlvbihpdGVtKXtcbiAgICAgIGlmIChpdGVtID09IG51bGwpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSXRlbSAvIGl0ZW0gdHlwZSBub3QgcHJvdmlkZWQuXCIpO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJykge1xuICAgICAgICBpdGVtID0ge1xuICAgICAgICAgIGl0ZW1UeXBlOiBpdGVtXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMuY2FuQmVVcGdyYWRlZChcbiAgICAgIGl0ZW0pKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk9ubHkgd2VhcG9ucyBhbmQgYXJtb3JzIGNhbiBiZSB1cGdyYWRlZCwgdGhpcyBpcyBhIFtcIiArIGl0ZW0uaXRlbVR5cGUgKyBcIl0uXCIpO1xuICAgICAgfVxuICAgIH07XG4gICAgcHJvdG90eXBlLnVwZ3JhZGVMZXZlbE9mID0gZnVuY3Rpb24oaXRlbSl7XG4gICAgICByZXR1cm4gaXRlbS5pZCAlIDEwMDtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5pc1VwZ3JhZGVkID0gZnVuY3Rpb24oaXRlbSl7XG4gICAgICByZXR1cm4gdGhpcy51cGdyYWRlTGV2ZWxPZihpdGVtKSA+IDA7XG4gICAgfTtcbiAgICBwcm90b3R5cGUuY2FuQmVVcGdyYWRlZCA9IGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgcmV0dXJuIGl0ZW0uaXRlbVR5cGUgPT09ICd3ZWFwb24nIHx8IGl0ZW0uaXRlbVR5cGUgPT09ICdhcm1vcic7XG4gICAgfTtcbiAgICBwcm90b3R5cGUuY2FuQmVVcGdyYWRlZEZ1cnRoZXIgPSBmdW5jdGlvbihpdGVtKXtcbiAgICAgIHZhciB0aGlzJCA9IHRoaXM7XG4gICAgICBpZiAoIXRoaXMuY2FuQmVVcGdyYWRlZChpdGVtKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5maW5kVXBncmFkZUZvcihpdGVtLCB0aGlzLnVwZ3JhZGVMZXZlbE9mKGl0ZW0pKS50aGVuKGZ1bmN0aW9uKHVwZ3JhZGUpe1xuICAgICAgICByZXR1cm4gdXBncmFkZSAhPSBudWxsO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICBwcm90b3R5cGUuYXBwbHkgPSBmdW5jdGlvbih1cGdyYWRlKXtcbiAgICAgIHZhciB0aGlzJCA9IHRoaXM7XG4gICAgICBpZiAodXBncmFkZSA9PSBudWxsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHVwZ3JhZGUgZGF0YSBwcm92aWRlZC5cIik7XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0bzogZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgICAgdmFyIHgkLCBpJCwgcmVmJCwgbGVuJCwgZmllbGQ7XG4gICAgICAgICAgdGhpcyQuZW5zdXJlSXRDYW5CZVVwZ3JhZGVkKFxuICAgICAgICAgIGl0ZW0pO1xuICAgICAgICAgIHgkID0gaXRlbTtcbiAgICAgICAgICB4JC5pZCArPSB1cGdyYWRlWydpZCddICUgMTAwO1xuICAgICAgICAgIHgkLnVwZ3JhZGVJZCA9IHVwZ3JhZGVbJ2lkJ107XG4gICAgICAgICAgeCQubWF0U2V0SWQgKz0gdXBncmFkZVsnbWF0U2V0SWQnXTtcbiAgICAgICAgICBmb3IgKGkkID0gMCwgbGVuJCA9IChyZWYkID0gWydkZWZNb2RQaHknLCAnZGVmTW9kTWFnJywgJ2RlZk1vZEZpcicsICdkZWZNb2RMaXQnLCAnZGVmTW9kVG94JywgJ2RlZk1vZEJsbycsICdkZWZNb2RDdXInXSkubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgICAgICAgIGZpZWxkID0gcmVmJFtpJF07XG4gICAgICAgICAgICBpdGVtW2ZpZWxkLnJlcGxhY2UoJ01vZCcsICcnKV0gKj0gdXBncmFkZVtmaWVsZF07XG4gICAgICAgICAgfVxuICAgICAgICAgIHN3aXRjaCAoaXRlbVsnaXRlbVR5cGUnXSkge1xuICAgICAgICAgIGNhc2UgJ3dlYXBvbic6XG4gICAgICAgICAgICBmb3IgKGkkID0gMCwgbGVuJCA9IChyZWYkID0gWydhdGtNb2RQaHknLCAnYXRrTW9kTWFnJywgJ2F0a01vZEZpcicsICdhdGtNb2RMaXQnLCAnYm9udXNNb2RTdHInLCAnYm9udXNNb2REZXgnLCAnYm9udXNNb2RJbnQnLCAnYm9udXNNb2RGYWknXSkubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgICAgICAgICAgZmllbGQgPSByZWYkW2kkXTtcbiAgICAgICAgICAgICAgaXRlbVtmaWVsZC5yZXBsYWNlKCdNb2QnLCAnJyldICo9IHVwZ3JhZGVbZmllbGRdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnYXJtb3InOlxuICAgICAgICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSAocmVmJCA9IFsnZGVmTW9kU3RyaWtlJywgJ2RlZk1vZFNsYXNoJywgJ2RlZk1vZFRocnVzdCddKS5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgICAgICAgICBmaWVsZCA9IHJlZiRbaSRdO1xuICAgICAgICAgICAgICBpdGVtW2ZpZWxkLnJlcGxhY2UoJ01vZCcsICcnKV0gKj0gdXBncmFkZVtmaWVsZF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG4gICAgLyoqXG4gICAgICogRmluZCBhbGwgdXBncmFkZXMgdGhhdCBjYW4gYmUgYXBwbGllZCB0byBhIGdpdmVuIGl0ZW0sXG4gICAgICogd2l0aGluIHRoZSBsaW1pdHMgb2Ygd2hhdCBpcyBhdmFpbGFibGUgdG8gdGhlIHVzZXJcbiAgICAgKi9cbiAgICBwcm90b3R5cGUuZmluZEFsbEF2YWlsYWJsZVVwZ3JhZGVzRm9yID0gZnVuY3Rpb24oaXRlbSl7XG4gICAgICB2YXIgcmVmJCwgeCQsIHVwZ3JhZGVMaXN0LCB0aGlzJCA9IHRoaXM7XG4gICAgICBpZiAoKHJlZiQgPSAhaXRlbS5pdGVtVHlwZSkgPT09ICdhcm1vcicgfHwgcmVmJCA9PT0gJ3dlYXBvbicpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiT25seSB3ZWFwb25zIGFuZCBhcm1vciBjYW4gYmUgdXBncmFkZWQsIHRoaXMgaXMgW1wiICsgaXRlbS5pdGVtVHlwZSArIFwiXVwiKTtcbiAgICAgIH1cbiAgICAgIGlmIChpdGVtLmlkIDwgMCB8fCBpdGVtLnVwZ3JhZGVJZCA8IDApIHtcbiAgICAgICAgeCQgPSB0aGlzLiRxLmRlZmVyKCk7XG4gICAgICAgIHgkLnJlc29sdmUoW10pO1xuICAgICAgICByZXR1cm4geCQucHJvbWlzZTtcbiAgICAgIH1cbiAgICAgIHVwZ3JhZGVMaXN0ID0gW107XG4gICAgICByZXR1cm4gdGhpcy5faW52ZW50b3J5U3ZjLmxvYWQoKS50aGVuKGZ1bmN0aW9uKGludmVudG9yeSl7XG4gICAgICAgIHZhciBtYXRlcmlhbHMsIHByb21pc2UsIGkkLCBsZXZlbDtcbiAgICAgICAgbWF0ZXJpYWxzID0gbWFwKGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgICByZXR1cm4gaW1wb3J0JCh7fSwgaXQpO1xuICAgICAgICB9KShcbiAgICAgICAgZmlsdGVyKGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgICByZXR1cm4gaXQuaXRlbVR5cGUgPT09ICdpdGVtJztcbiAgICAgICAgfSkoXG4gICAgICAgIGludmVudG9yeSkpO1xuICAgICAgICBwcm9taXNlID0gdGhpcyQuJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KXtcbiAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBmb3IgKGkkID0gdGhpcyQuZ2V0VXBncmFkZUxldmVsRnJvbShpdGVtLmlkKSArIDE7IGkkIDw9IDEwOyArK2kkKSB7XG4gICAgICAgICAgbGV2ZWwgPSBpJDtcbiAgICAgICAgICBmbiQobWF0ZXJpYWxzLCBsZXZlbCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIGZ1bmN0aW9uIGZuJChtYXRlcmlhbHMsIGxldmVsKXtcbiAgICAgICAgICBwcm9taXNlID0gcHJvbWlzZS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcyQuYXJlKG1hdGVyaWFscykuZW5vdWdoVG9VcGdyYWRlKGl0ZW0sIGxldmVsKTtcbiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGNhblVwZ3JhZGUpe1xuICAgICAgICAgICAgaWYgKGNhblVwZ3JhZGUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMkLiRxLmFsbChbdGhpcyQuX2l0ZW1TdmMuZ2V0VXBncmFkZWQoaXRlbSwgbGV2ZWwpLCB0aGlzJC5kZWR1Y3RGcm9tKG1hdGVyaWFscykuY29zdE9mVXBncmFkZShpdGVtLCBsZXZlbCldKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIG1hdGVyaWFscy5sZW5ndGggPSAwO1xuICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG4gICAgICAgICAgICB2YXIgdXBJdGVtLCBjb3N0LCB0b3RhbENvc3QsIGNvc3RFbnRyeSwgeCQ7XG4gICAgICAgICAgICB1cEl0ZW0gPSByZXN1bHQgIT0gbnVsbCA/IHJlc3VsdFswXSA6IHZvaWQgODtcbiAgICAgICAgICAgIGNvc3QgPSByZXN1bHQgIT0gbnVsbCA/IHJlc3VsdFsxXSA6IHZvaWQgODtcbiAgICAgICAgICAgIGlmICh1cEl0ZW0gIT0gbnVsbCkge1xuICAgICAgICAgICAgICB0b3RhbENvc3QgPSBtYXRlcmlhbHMudG90YWxDb3N0IHx8IChtYXRlcmlhbHMudG90YWxDb3N0ID0gW10pO1xuICAgICAgICAgICAgICBjb3N0RW50cnkgPSBmaW5kKGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXQubWF0SWQgPT09IGNvc3QubWF0SWQ7XG4gICAgICAgICAgICAgIH0pKFxuICAgICAgICAgICAgICB0b3RhbENvc3QpO1xuICAgICAgICAgICAgICBpZiAoY29zdEVudHJ5ID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb3N0RW50cnkgPSB7XG4gICAgICAgICAgICAgICAgICBtYXRJZDogY29zdC5tYXRJZCxcbiAgICAgICAgICAgICAgICAgIG1hdENvc3Q6IDBcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRvdGFsQ29zdC5wdXNoKGNvc3RFbnRyeSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29zdEVudHJ5Lm1hdENvc3QgKz0gY29zdC5tYXRDb3N0O1xuICAgICAgICAgICAgICB4JCA9IHVwSXRlbTtcbiAgICAgICAgICAgICAgeCQudG90YWxDb3N0ID0gbWFwKGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgICAgICAgICByZXR1cm4gaW1wb3J0JCh7fSwgaXQpO1xuICAgICAgICAgICAgICB9KShcbiAgICAgICAgICAgICAgdG90YWxDb3N0KTtcbiAgICAgICAgICAgICAgeCQudXBncmFkZUxldmVsID0gbGV2ZWwgLSB0aGlzJC5nZXRVcGdyYWRlTGV2ZWxGcm9tKGl0ZW0uaWQpO1xuICAgICAgICAgICAgICB1cGdyYWRlTGlzdC5wdXNoKHVwSXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHVwZ3JhZGVMaXN0O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gSXRlbVNlcnZpY2VVcGdyYWRlQ29tcG9uZW50O1xuICB9KCkpO1xuICBpZiAodHlwZW9mIG1vZHVsZSAhPSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09IG51bGwpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IEl0ZW1TZXJ2aWNlVXBncmFkZUNvbXBvbmVudDtcbiAgfVxuICBmdW5jdGlvbiBiaW5kJChvYmosIGtleSwgdGFyZ2V0KXtcbiAgICByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuICh0YXJnZXQgfHwgb2JqKVtrZXldLmFwcGx5KG9iaiwgYXJndW1lbnRzKSB9O1xuICB9XG4gIGZ1bmN0aW9uIGltcG9ydCQob2JqLCBzcmMpe1xuICAgIHZhciBvd24gPSB7fS5oYXNPd25Qcm9wZXJ0eTtcbiAgICBmb3IgKHZhciBrZXkgaW4gc3JjKSBpZiAob3duLmNhbGwoc3JjLCBrZXkpKSBvYmpba2V5XSA9IHNyY1trZXldO1xuICAgIHJldHVybiBvYmo7XG4gIH1cbn0pLmNhbGwodGhpcyk7XG4iLCIoZnVuY3Rpb24oKXtcbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlICE9PSBudWxsKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigkc2NvcGUsIHVpR3JpZENvbnN0YW50cyl7XG4gICAgICB2YXIgcGVyY2VudEZpZWxkTWluV2lkdGgsIGkkLCByZWYkLCBsZW4kLCBpdGVtVHlwZTtcbiAgICAgICRzY29wZS5ncmlkT3B0aW9ucyA9IHtcbiAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiB0cnVlXG4gICAgICB9O1xuICAgICAgcGVyY2VudEZpZWxkTWluV2lkdGggPSA0NTtcbiAgICAgICRzY29wZS5jb2x1bW5Db25maWdzID0ge1xuICAgICAgICAnd2VhcG9uJzogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAnd2VhcG9uVHlwZScsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1R5cGUnLFxuICAgICAgICAgICAgbWluV2lkdGg6IDcwLFxuICAgICAgICAgICAgc29ydDoge1xuICAgICAgICAgICAgICBkaXJlY3Rpb246IHVpR3JpZENvbnN0YW50cy5BU0MsXG4gICAgICAgICAgICAgIHByaW9yaXR5OiAwXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICduYW1lJyxcbiAgICAgICAgICAgIG1pbldpZHRoOiAyMTAsXG4gICAgICAgICAgICBzb3J0OiB7XG4gICAgICAgICAgICAgIGRpcmVjdGlvbjogdWlHcmlkQ29uc3RhbnRzLkFTQyxcbiAgICAgICAgICAgICAgcHJpb3JpdHk6IDFcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ3JlcVN0cicsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1JTJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICdyZXFEZXgnLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdSRCdcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ3JlcUludCcsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1JJJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAncmVxRmFpJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnUkYnXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICdhdGtQaHknLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdBUCdcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2F0a01hZycsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0FNJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnYXRrRmlyJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnQUYnXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICdhdGtMaXQnLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdBTCdcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2JvbnVzU3RyJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnU1MnLFxuICAgICAgICAgICAgbWluV2lkdGg6IHBlcmNlbnRGaWVsZE1pbldpZHRoLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogJ3BlcmNlbnRhZ2UnXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICdib251c0RleCcsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1NEJyxcbiAgICAgICAgICAgIG1pbldpZHRoOiBwZXJjZW50RmllbGRNaW5XaWR0aCxcbiAgICAgICAgICAgIGNlbGxGaWx0ZXI6ICdwZXJjZW50YWdlJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnYm9udXNJbnQnLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdTSScsXG4gICAgICAgICAgICBtaW5XaWR0aDogcGVyY2VudEZpZWxkTWluV2lkdGgsXG4gICAgICAgICAgICBjZWxsRmlsdGVyOiAncGVyY2VudGFnZSdcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2JvbnVzRmFpJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnU0YnLFxuICAgICAgICAgICAgbWluV2lkdGg6IHBlcmNlbnRGaWVsZE1pbldpZHRoLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogJ3BlcmNlbnRhZ2UnXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICdkZWZQaHknLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdEUCdcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2RlZk1hZycsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0RNJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnZGVmRmlyJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnREYnXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICdkZWZMaXQnLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdETCdcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2RlZlRveCcsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0RUJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnZGVmQmxvJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnREInXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICdkZWZDdXInLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdEQydcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2RlZlN0YScsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1N0J1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnZGl2aW5lJyxcbiAgICAgICAgICAgIG1pbldpZHRoOiBwZXJjZW50RmllbGRNaW5XaWR0aCxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnRGl2JyxcbiAgICAgICAgICAgIGNlbGxGaWx0ZXI6ICdwZXJjZW50YWdlJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnb2NjdWx0JyxcbiAgICAgICAgICAgIG1pbldpZHRoOiBwZXJjZW50RmllbGRNaW5XaWR0aCxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnT2NjJyxcbiAgICAgICAgICAgIGNlbGxGaWx0ZXI6ICdwZXJjZW50YWdlJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnd2VpZ2h0JyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnV3QnLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogXCJudW1iZXI6MlwiLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcidcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2F0a1N0YUNvc3QnLFxuICAgICAgICAgICAgZGlzcGxheU5hbW86ICdTdGEnLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogXCJudW1iZXI6MlwiLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcidcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2Rwc1BoeScsXG4gICAgICAgICAgICBkaXNwbGF5TmFtbzogJ2Rwc1AnLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogXCJudW1iZXI6MlwiLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcidcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2Rwc01hZycsXG4gICAgICAgICAgICBkaXNwbGF5TmFtbzogJ2Rwc00nLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogXCJudW1iZXI6MlwiLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcidcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2Rwc0ZpcicsXG4gICAgICAgICAgICBkaXNwbGF5TmFtbzogJ2Rwc0YnLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogXCJudW1iZXI6MlwiLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcidcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2Rwc0xpdCcsXG4gICAgICAgICAgICBkaXNwbGF5TmFtbzogJ2Rwc0wnLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogXCJudW1iZXI6MlwiLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcidcbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgICdhcm1vcic6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnYXJtb3JTZXQnLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdTZXQnLFxuICAgICAgICAgICAgbWluV2lkdGg6IDE1MCxcbiAgICAgICAgICAgIHNvcnQ6IHtcbiAgICAgICAgICAgICAgZGlyZWN0aW9uOiB1aUdyaWRDb25zdGFudHMuQVNDLFxuICAgICAgICAgICAgICBwcmlvcml0eTogMFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICdhcm1vclR5cGUnLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdUeXBlJyxcbiAgICAgICAgICAgIHNvcnQ6IHtcbiAgICAgICAgICAgICAgZGlyZWN0aW9uOiB1aUdyaWRDb25zdGFudHMuQVNDLFxuICAgICAgICAgICAgICBwcmlvcml0eTogMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNvcnRpbmdBbGdvcml0aG06IGZ1bmN0aW9uKGEsIGIpe1xuICAgICAgICAgICAgICB2YXIgdmFsdWVzO1xuICAgICAgICAgICAgICB2YWx1ZXMgPSB7XG4gICAgICAgICAgICAgICAgJ2hlYWQnOiAxLFxuICAgICAgICAgICAgICAgICdjaGVzdCc6IDIsXG4gICAgICAgICAgICAgICAgJ2hhbmRzJzogMyxcbiAgICAgICAgICAgICAgICAnbGVncyc6IDRcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlc1thXSA+IHZhbHVlc1tiXVxuICAgICAgICAgICAgICAgID8gMVxuICAgICAgICAgICAgICAgIDogdmFsdWVzW2FdIDwgdmFsdWVzW2JdID8gLTEgOiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnbmFtZScsXG4gICAgICAgICAgICBtaW5XaWR0aDogMjUwXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgbmFtZTogJ2RlZk4nLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0ROJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICdkZWZTbCcsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnRFNsJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICdkZWZTdCcsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnRFN0J1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICdkZWZUaCcsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnRFRoJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICdkZWZNJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdETSdcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAnZGVmRicsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnREYnXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgbmFtZTogJ2RlZkwnLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0RMJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICdkZWZQJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdEUCdcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAnZGVmVCcsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnUlAnXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgbmFtZTogJ2RlZkInLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1JCJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICdkZWZDJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdSQydcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAnc3RSZWMnLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1NyJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICd3ZWlnaHQnLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1d0J1xuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfTtcbiAgICAgIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZiQgPSBbJ2l0ZW0nLCAncmluZ3MnXSkubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgICAgaXRlbVR5cGUgPSByZWYkW2kkXTtcbiAgICAgICAgJHNjb3BlLmNvbHVtbkNvbmZpZ3NbaXRlbVR5cGVdID0gW3tcbiAgICAgICAgICBmaWVsZDogJ25hbWUnLFxuICAgICAgICAgIHNvcnQ6IHtcbiAgICAgICAgICAgIGRpcmVjdGlvbjogdWlHcmlkQ29uc3RhbnRzLkFTQyxcbiAgICAgICAgICAgIHByaW9yaXR5OiAwXG4gICAgICAgICAgfVxuICAgICAgICB9XTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG59KS5jYWxsKHRoaXMpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gIHZhciBJdGVtSW5kZXhTZXJ2aWNlO1xuICBpZiAodHlwZW9mIGFuZ3VsYXIgIT0gJ3VuZGVmaW5lZCcgJiYgYW5ndWxhciAhPT0gbnVsbCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiZHNjXCIpLnNlcnZpY2UoXCJpdGVtSW5kZXhTdmNcIiwgZnVuY3Rpb24oZXh0ZXJuYWxEYXRhU3ZjKXtcbiAgICAgIHJldHVybiBuZXcgSXRlbUluZGV4U2VydmljZShleHRlcm5hbERhdGFTdmMpO1xuICAgIH0pO1xuICB9XG4gIEl0ZW1JbmRleFNlcnZpY2UgPSAoZnVuY3Rpb24oKXtcbiAgICBJdGVtSW5kZXhTZXJ2aWNlLmRpc3BsYXlOYW1lID0gJ0l0ZW1JbmRleFNlcnZpY2UnO1xuICAgIHZhciBwcm90b3R5cGUgPSBJdGVtSW5kZXhTZXJ2aWNlLnByb3RvdHlwZSwgY29uc3RydWN0b3IgPSBJdGVtSW5kZXhTZXJ2aWNlO1xuICAgIGZ1bmN0aW9uIEl0ZW1JbmRleFNlcnZpY2UoZXh0ZXJuYWxEYXRhU3ZjKXtcbiAgICAgIHRoaXMuZXh0ZXJuYWxEYXRhU3ZjID0gZXh0ZXJuYWxEYXRhU3ZjO1xuICAgICAgdGhpcy5sb2FkQWxsRW50cmllcyA9IGJpbmQkKHRoaXMsICdsb2FkQWxsRW50cmllcycsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmxvYWRBbGxBcm1vclNldEVudHJpZXMgPSBiaW5kJCh0aGlzLCAnbG9hZEFsbEFybW9yU2V0RW50cmllcycsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmZpbmRCeUFybW9yU2V0ID0gYmluZCQodGhpcywgJ2ZpbmRCeUFybW9yU2V0JywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuZmluZEFybW9yU2V0Rm9yID0gYmluZCQodGhpcywgJ2ZpbmRBcm1vclNldEZvcicsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmZpbmRFbnRyaWVzID0gYmluZCQodGhpcywgJ2ZpbmRFbnRyaWVzJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuZmluZEVudHJ5QnlVaWQgPSBiaW5kJCh0aGlzLCAnZmluZEVudHJ5QnlVaWQnLCBwcm90b3R5cGUpO1xuICAgICAgdGhpcy5jbGVhciA9IGJpbmQkKHRoaXMsICdjbGVhcicsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLl9pbmRleCA9IFtdO1xuICAgICAgdGhpcy5fYXJtb3JTZXRJbmRleCA9IFtdO1xuICAgIH1cbiAgICBwcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbigpe1xuICAgICAgdGhpcy5faW5kZXgubGVuZ3RoID0gMDtcbiAgICAgIGRlbGV0ZSB0aGlzLl9pbmRleC4kcHJvbWlzZTtcbiAgICAgIHRoaXMuX2FybW9yU2V0SW5kZXgubGVuZ3RoID0gMDtcbiAgICAgIGRlbGV0ZSB0aGlzLl9hcm1vclNldEluZGV4LiRwcm9taXNlO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBGaW5kcyB0aGUgZmlyc3QgaXRlbSBtYXRjaGluZyBhIGdpdmVuIGZpbHRlci5cbiAgICAgKiBAcGFyYW0gYnlGaWx0ZXIgRnVuY3Rpb24gZmlsdGVyIGZ1bmN0aW9uIHRoYXQgdGFrZXMgaXRlbSBhc1xuICAgICAqIGEgcGFyYW1ldGVyIGFuZCByZXR1cm5zIHRydWUvZmFsc2UgaWYgaXQgbWF0Y2hlcy9kb2Vzbid0LlxuICAgICAqIEByZXR1cm5zIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aXRoIHRoZSBmb3VuZCB2YWx1ZS5cbiAgICAgKi9cbiAgICBwcm90b3R5cGUuZmluZEVudHJ5QnlVaWQgPSBmdW5jdGlvbih1aWQpe1xuICAgICAgdmFyIHRoaXMkID0gdGhpcztcbiAgICAgIHJldHVybiB0aGlzLmxvYWRBbGxFbnRyaWVzKCkudGhlbihmdW5jdGlvbihlbnRyaWVzKXtcbiAgICAgICAgdmFyIGVudHJ5O1xuICAgICAgICBlbnRyeSA9IGZpbmQoZnVuY3Rpb24oaXQpe1xuICAgICAgICAgIHJldHVybiBpdC51aWQgPT09IHVpZDtcbiAgICAgICAgfSkoXG4gICAgICAgIGVudHJpZXMpO1xuICAgICAgICBpZiAoZW50cnkgPT0gbnVsbCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBmaW5kIGluZGV4IGVudHJ5IHdpdGggVUlEIFtcIiArIHVpZCArIFwiXS5cIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGVudHJ5O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICBwcm90b3R5cGUuZmluZEVudHJpZXMgPSBmdW5jdGlvbihieUZpbHRlcil7XG4gICAgICB2YXIgdGhpcyQgPSB0aGlzO1xuICAgICAgaWYgKHR5cGVvZiBieUZpbHRlciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJbYnlGaWx0ZXJdIGlzIG5vdCBhIGZ1bmN0aW9uLlwiKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmxvYWRBbGxFbnRyaWVzKCkudGhlbihmdW5jdGlvbihpdCl7XG4gICAgICAgIHJldHVybiBmaWx0ZXIoYnlGaWx0ZXIpKFxuICAgICAgICBpdCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5maW5kQXJtb3JTZXRGb3IgPSBmdW5jdGlvbihpdGVtKXtcbiAgICAgIHZhciB0aGlzJCA9IHRoaXM7XG4gICAgICByZXR1cm4gdGhpcy5sb2FkQWxsQXJtb3JTZXRFbnRyaWVzKCkudGhlbihmdW5jdGlvbihpdCl7XG4gICAgICAgIHJldHVybiBmaW5kKGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgICByZXR1cm4gaXQudWlkID09PSBpdGVtLnVpZDtcbiAgICAgICAgfSkoXG4gICAgICAgIGl0KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgcHJvdG90eXBlLmZpbmRCeUFybW9yU2V0ID0gZnVuY3Rpb24oc2V0TmFtZSl7XG4gICAgICB2YXIgdGhpcyQgPSB0aGlzO1xuICAgICAgaWYgKHR5cGVvZiBzZXROYW1lID09PSAnb2JqZWN0Jykge1xuICAgICAgICBzZXROYW1lID0gc2V0TmFtZS5uYW1lO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGVvZiBzZXROYW1lICE9PSAnc3RyaW5nJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBcm1vciBzZXQgbmFtZSBtdXN0IGJlIGEgc3RyaW5nLCBvciBhbiBvYmplY3Qgd2l0aCBzdHJpbmcgcHJvcGVydHkgW25hbWVdLlwiKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmxvYWRBbGxBcm1vclNldEVudHJpZXMoKS50aGVuKGZ1bmN0aW9uKHNldHMpe1xuICAgICAgICB2YXIgYXJtb3JJZHMsIHJlZiQ7XG4gICAgICAgIGFybW9ySWRzID0gKHJlZiQgPSBmaW5kKGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgICByZXR1cm4gaXQubmFtZSA9PT0gc2V0TmFtZTtcbiAgICAgICAgfSkoXG4gICAgICAgIHNldHMpKSAhPSBudWxsID8gcmVmJC5hcm1vcnMgOiB2b2lkIDg7XG4gICAgICAgIHJldHVybiB0aGlzJC5maW5kRW50cmllcyhmdW5jdGlvbihlbnRyeSl7XG4gICAgICAgICAgcmV0dXJuIGFueSgoZnVuY3Rpb24oaXQpe1xuICAgICAgICAgICAgcmV0dXJuIGl0ID09PSBlbnRyeS5pZDtcbiAgICAgICAgICB9KSkoXG4gICAgICAgICAgYXJtb3JJZHMpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgcHJvdG90eXBlLmxvYWRBbGxBcm1vclNldEVudHJpZXMgPSBmdW5jdGlvbihyZXR1cm5Qcm9taXNlKXtcbiAgICAgIHJldHVyblByb21pc2UgPT0gbnVsbCAmJiAocmV0dXJuUHJvbWlzZSA9IHRydWUpO1xuICAgICAgaWYgKHRoaXMuX2FybW9yU2V0SW5kZXguJHByb21pc2UgPT0gbnVsbCkge1xuICAgICAgICB0aGlzLl9hcm1vclNldEluZGV4ID0gdGhpcy5leHRlcm5hbERhdGFTdmMubG9hZEpzb24oJy9tb2R1bGVzL2l0ZW1zL2NvbnRlbnQvYXJtb3Itc2V0LWluZGV4Lmpzb24nLCBmYWxzZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmV0dXJuUHJvbWlzZVxuICAgICAgICA/IHRoaXMuX2FybW9yU2V0SW5kZXguJHByb21pc2VcbiAgICAgICAgOiB0aGlzLl9hcm1vclNldEluZGV4O1xuICAgIH07XG4gICAgcHJvdG90eXBlLmxvYWRBbGxFbnRyaWVzID0gZnVuY3Rpb24ocmV0dXJuUHJvbWlzZSl7XG4gICAgICByZXR1cm5Qcm9taXNlID09IG51bGwgJiYgKHJldHVyblByb21pc2UgPSB0cnVlKTtcbiAgICAgIGlmICh0aGlzLl9pbmRleC4kcHJvbWlzZSA9PSBudWxsKSB7XG4gICAgICAgIHRoaXMuX2luZGV4ID0gdGhpcy5leHRlcm5hbERhdGFTdmMubG9hZEpzb24oJy9tb2R1bGVzL2l0ZW1zL2NvbnRlbnQvaW5kZXguanNvbicsIGZhbHNlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXR1cm5Qcm9taXNlXG4gICAgICAgID8gdGhpcy5faW5kZXguJHByb21pc2VcbiAgICAgICAgOiB0aGlzLl9pbmRleDtcbiAgICB9O1xuICAgIHJldHVybiBJdGVtSW5kZXhTZXJ2aWNlO1xuICB9KCkpO1xuICBpZiAodHlwZW9mIG1vZHVsZSAhPSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09IG51bGwpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IEl0ZW1JbmRleFNlcnZpY2U7XG4gIH1cbiAgZnVuY3Rpb24gYmluZCQob2JqLCBrZXksIHRhcmdldCl7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiAodGFyZ2V0IHx8IG9iailba2V5XS5hcHBseShvYmosIGFyZ3VtZW50cykgfTtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiIsIihmdW5jdGlvbigpe1xuICB2YXIgSXRlbVNlcnZpY2U7XG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPSAndW5kZWZpbmVkJyAmJiBhbmd1bGFyICE9PSBudWxsKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJkc2NcIikuc2VydmljZShcIml0ZW1TdmNcIiwgZnVuY3Rpb24oZXh0ZXJuYWxEYXRhU3ZjLCBpdGVtSW5kZXhTdmMsIGludmVudG9yeVN2YywgJHEpe1xuICAgICAgcmV0dXJuIChmdW5jdGlvbihmdW5jLCBhcmdzLCBjdG9yKSB7XG4gICAgICAgIGN0b3IucHJvdG90eXBlID0gZnVuYy5wcm90b3R5cGU7XG4gICAgICAgIHZhciBjaGlsZCA9IG5ldyBjdG9yLCByZXN1bHQgPSBmdW5jLmFwcGx5KGNoaWxkLCBhcmdzKSwgdDtcbiAgICAgICAgcmV0dXJuICh0ID0gdHlwZW9mIHJlc3VsdCkgID09IFwib2JqZWN0XCIgfHwgdCA9PSBcImZ1bmN0aW9uXCIgPyByZXN1bHQgfHwgY2hpbGQgOiBjaGlsZDtcbiAgfSkoSXRlbVNlcnZpY2UsIGFyZ3VtZW50cywgZnVuY3Rpb24oKXt9KTtcbiAgICB9KTtcbiAgfVxuICBJdGVtU2VydmljZSA9IChmdW5jdGlvbigpe1xuICAgIEl0ZW1TZXJ2aWNlLmRpc3BsYXlOYW1lID0gJ0l0ZW1TZXJ2aWNlJztcbiAgICB2YXIgcHJvdG90eXBlID0gSXRlbVNlcnZpY2UucHJvdG90eXBlLCBjb25zdHJ1Y3RvciA9IEl0ZW1TZXJ2aWNlO1xuICAgIGZ1bmN0aW9uIEl0ZW1TZXJ2aWNlKF9leHRlcm5hbERhdGFTdmMsIF9pdGVtSW5kZXhTdmMsIF9pbnZlbnRvcnlTdmMsICRxKXtcbiAgICAgIHRoaXMuX2V4dGVybmFsRGF0YVN2YyA9IF9leHRlcm5hbERhdGFTdmM7XG4gICAgICB0aGlzLl9pdGVtSW5kZXhTdmMgPSBfaXRlbUluZGV4U3ZjO1xuICAgICAgdGhpcy5faW52ZW50b3J5U3ZjID0gX2ludmVudG9yeVN2YztcbiAgICAgIHRoaXMuJHEgPSAkcTtcbiAgICAgIHRoaXMuZ2V0VXBncmFkZWQgPSBiaW5kJCh0aGlzLCAnZ2V0VXBncmFkZWQnLCBwcm90b3R5cGUpO1xuICAgICAgdGhpcy5sb2FkQWxsSXRlbXMgPSBiaW5kJCh0aGlzLCAnbG9hZEFsbEl0ZW1zJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuY3JlYXRlSXRlbU1vZGVsRnJvbSA9IGJpbmQkKHRoaXMsICdjcmVhdGVJdGVtTW9kZWxGcm9tJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuZmluZEl0ZW1zRnJvbUludmVudG9yeSA9IGJpbmQkKHRoaXMsICdmaW5kSXRlbXNGcm9tSW52ZW50b3J5JywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuZmluZEFueUl0ZW1CeVVpZCA9IGJpbmQkKHRoaXMsICdmaW5kQW55SXRlbUJ5VWlkJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuZmluZEl0ZW1CeUlkID0gYmluZCQodGhpcywgJ2ZpbmRJdGVtQnlJZCcsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmZpbmRJdGVtID0gYmluZCQodGhpcywgJ2ZpbmRJdGVtJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuY2xlYXIgPSBiaW5kJCh0aGlzLCAnY2xlYXInLCBwcm90b3R5cGUpO1xuICAgICAgdGhpcy51cGdyYWRlQ29tcCA9IG5ldyAocmVxdWlyZSgnLi9jb21wb25lbnRzL2l0ZW0tc2VydmljZS11cGdyYWRlLWNvbXBvbmVudCcpKTtcbiAgICAgIHRoaXMudXBncmFkZUNvbXAuY29uc3RydWN0b3IuYXBwbHkodGhpcy51cGdyYWRlQ29tcCB8fCAodGhpcy51cGdyYWRlQ29tcCA9IHt9KSwgW3RoaXNdLmNvbmNhdChtYXAoZnVuY3Rpb24oaXQpe1xuICAgICAgICByZXR1cm4gaXQ7XG4gICAgICB9KShcbiAgICAgIGFyZ3VtZW50cykpKTtcbiAgICAgIHRoaXMuX3N0b3JhZ2UgPSB7fTtcbiAgICAgIHRoaXMuX21vZGVscyA9IHJlcXVpcmUoJy4vbW9kZWxzL2l0ZW0tbW9kZWxzJyk7XG4gICAgfVxuICAgIHByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLl9zdG9yYWdlID0ge307XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgZmlyc3QgaXRlbSBtYXRjaGluZyBhIGdpdmVuIGZpbHRlclxuICAgICAqIEBwYXJhbSBpdGVtVHlwZSBTdHJpbmcgdHlwZSBvZiBpdGVtIHRvIGZpbmQuXG4gICAgICogQHBhcmFtIGZpbHRlckZuIEZ1bmN0aW9uIEZpbHRlciBmdW5jdGlvblxuICAgICAqIEByZXR1cm4gUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdpdGggdGhlIGZvdW5kIGl0ZW0sIG9yIG51bGwgaWYgbm90aGluZyBmb3VuZC5cbiAgICAgKi9cbiAgICBwcm90b3R5cGUuZmluZEl0ZW0gPSBmdW5jdGlvbihpdGVtVHlwZSwgZmlsdGVyRm4pe1xuICAgICAgdmFyIHRoaXMkID0gdGhpcztcbiAgICAgIGlmICh0eXBlb2YgaXRlbVR5cGUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkl0ZW0gdHlwZSBpcyBpbnZhbGlkIG9yIG5vdCBwcm92aWRlZFwiKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmxvYWRBbGxJdGVtcyhpdGVtVHlwZSkudGhlbihmdW5jdGlvbihpdGVtcyl7XG4gICAgICAgIHZhciBpdGVtO1xuICAgICAgICBpdGVtID0gZmluZChmaWx0ZXJGbikoXG4gICAgICAgIGl0ZW1zKTtcbiAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5maW5kSXRlbUJ5SWQgPSBmdW5jdGlvbihpdGVtVHlwZSwgaWQpe1xuICAgICAgdmFyIHRoaXMkID0gdGhpcztcbiAgICAgIHJldHVybiB0aGlzLmxvYWRBbGxJdGVtcyhpdGVtVHlwZSkudGhlbihmdW5jdGlvbihpdGVtcyl7XG4gICAgICAgIHZhciBpdGVtO1xuICAgICAgICBpdGVtID0gZmluZChmdW5jdGlvbihpdCl7XG4gICAgICAgICAgcmV0dXJuIGl0LmlkID09PSBpZDtcbiAgICAgICAgfSkoXG4gICAgICAgIGl0ZW1zKTtcbiAgICAgICAgaWYgKGl0ZW0gPT0gbnVsbCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBmaW5kIFtcIiArIGl0ZW1UeXBlICsgXCJdIHdpdGggSUQgW1wiICsgaWQgKyBcIl0uXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBGaW5kcyBhbnkgaXRlbSwgcmVnYXJkbGVzcyBvZiB0eXBlLCBidXQgY2FuIG9ubHlcbiAgICAgKiBjaGVjayBmaWVsZHMgdGhhdCBhcmUgaW4gdGhlIGluZGV4LlxuICAgICAqL1xuICAgIHByb3RvdHlwZS5maW5kQW55SXRlbUJ5VWlkID0gZnVuY3Rpb24odWlkKXtcbiAgICAgIHZhciB0aGlzJCA9IHRoaXM7XG4gICAgICByZXR1cm4gdGhpcy5faXRlbUluZGV4U3ZjLmZpbmRFbnRyeUJ5VWlkKHVpZCkudGhlbihmdW5jdGlvbihpdGVtKXtcbiAgICAgICAgdmFyIGJhc2VJZCwgdXBMZXZlbDtcbiAgICAgICAgaWYgKGl0ZW0gPT0gbnVsbCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBmaW5kIGl0ZW0gd2l0aCBVSUQgW1wiICsgdWlkICsgXCJdIGluIHRoZSBpdGVtIGluZGV4LlwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcyQudXBncmFkZUNvbXAuaXNVcGdyYWRlZChpdGVtKSkge1xuICAgICAgICAgIGJhc2VJZCA9IHRoaXMkLnVwZ3JhZGVDb21wLmdldEJhc2VJZEZyb20oaXRlbS5pZCk7XG4gICAgICAgICAgdXBMZXZlbCA9IHRoaXMkLnVwZ3JhZGVDb21wLmdldFVwZ3JhZGVMZXZlbEZyb20oaXRlbS5pZCk7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGl0ZW0sIGJhc2VJZCwgdXBMZXZlbCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcyQuZmluZEl0ZW1CeUlkKGl0ZW0uaXRlbVR5cGUsIGJhc2VJZCkudGhlbihmdW5jdGlvbihiYXNlSXRlbSl7XG4gICAgICAgICAgICAgIHJldHVybiB0aGlzJC5nZXRVcGdyYWRlZChiYXNlSXRlbSwgdXBMZXZlbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KGl0ZW0sIGJhc2VJZCwgdXBMZXZlbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMkLmZpbmRJdGVtKGl0ZW0uaXRlbVR5cGUsIGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgICAgIHJldHVybiBpdC5pZCA9PT0gaXRlbS5pZDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBGaWx0ZXIgaW52ZW50b3J5IGVudHJpZXMgYnkgYSBnaXZlbiBmaWx0ZXIgYW5kIHRoZW4gcmV0dXJuIHRoZSByZWFsIGl0ZW0gZGF0YVxuICAgICAqIGZvciB0aGVtLlxuICAgICAqL1xuICAgIHByb3RvdHlwZS5maW5kSXRlbXNGcm9tSW52ZW50b3J5ID0gZnVuY3Rpb24odHlwZU9yRmlsdGVyKXtcbiAgICAgIHZhciB0aGlzJCA9IHRoaXM7XG4gICAgICByZXR1cm4gdGhpcy5faW52ZW50b3J5U3ZjLmxvYWQoKS50aGVuKGZ1bmN0aW9uKGludmVudG9yeSl7XG4gICAgICAgIHZhciBwcm9taXNlcywgaSQsIGxlbiQsIGl0ZW1FbnRyeTtcbiAgICAgICAgaWYgKHR5cGVvZiB0eXBlT3JGaWx0ZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgaW52ZW50b3J5ID0gZmlsdGVyKGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgICAgIHJldHVybiBpdC5pdGVtVHlwZSA9PT0gdHlwZU9yRmlsdGVyO1xuICAgICAgICAgIH0pKFxuICAgICAgICAgIGludmVudG9yeSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaW52ZW50b3J5ID0gZmlsdGVyKGJ5RmlsdGVyKShcbiAgICAgICAgICBpbnZlbnRvcnkpO1xuICAgICAgICB9XG4gICAgICAgIHByb21pc2VzID0gW107XG4gICAgICAgIGZvciAoaSQgPSAwLCBsZW4kID0gaW52ZW50b3J5Lmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgICAgaXRlbUVudHJ5ID0gaW52ZW50b3J5W2kkXTtcbiAgICAgICAgICBwcm9taXNlcy5wdXNoKHRoaXMkLmZpbmRBbnlJdGVtQnlVaWQoaXRlbUVudHJ5LnVpZCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzJC4kcS5hbGwocHJvbWlzZXMpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBtb2RlbCBmcm9tIGdpdmVuIGl0ZW0gZGF0YVxuICAgICAqL1xuICAgIHByb3RvdHlwZS5jcmVhdGVJdGVtTW9kZWxGcm9tID0gZnVuY3Rpb24oZGF0YSl7XG4gICAgICByZXR1cm4gKGZ1bmN0aW9uKCl7XG4gICAgICAgIHN3aXRjaCAoZGF0YS5pdGVtVHlwZSkge1xuICAgICAgICBjYXNlICd3ZWFwb24nOlxuICAgICAgICAgIHJldHVybiBuZXcgdGhpcy5fbW9kZWxzLldlYXBvbjtcbiAgICAgICAgY2FzZSAnYXJtb3InOlxuICAgICAgICAgIHJldHVybiBuZXcgdGhpcy5fbW9kZWxzLkFybW9yO1xuICAgICAgICBjYXNlICdpdGVtJzpcbiAgICAgICAgICByZXR1cm4gbmV3IHRoaXMuX21vZGVscy5JdGVtO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBjcmVhdGUgaXRlbSBtb2RlbCBmcm9tIGRhdGEgd2l0aCAuaXRlbVR5cGUgPT0gXCIgKyBkYXRhLml0ZW1UeXBlICsgXCIuXCIpO1xuICAgICAgICB9XG4gICAgICB9LmNhbGwodGhpcykpLnVzZURhdGFGcm9tKGRhdGEpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogTG9hZCBpdGVtIGRhdGEgb2YgYSBnaXZlbiBpdGVtIHR5cGUuXG4gICAgICogQHJldHVybnMgUHJvbWlzZSBvciBwb3B1bGF0ZWQgYXJyYXksIGRlcGVuZGluZyBvbiByZXR1cm5Qcm9taXNlIHNldHRpbmcuXG4gICAgICovXG4gICAgcHJvdG90eXBlLmxvYWRBbGxJdGVtcyA9IGZ1bmN0aW9uKGl0ZW1UeXBlLCByZXR1cm5Qcm9taXNlKXtcbiAgICAgIHZhciByZWYkLCB0ZXN0LCB0aGlzJCA9IHRoaXM7XG4gICAgICByZXR1cm5Qcm9taXNlID09IG51bGwgJiYgKHJldHVyblByb21pc2UgPSB0cnVlKTtcbiAgICAgIGlmICgoKHJlZiQgPSB0aGlzLl9zdG9yYWdlKVtpdGVtVHlwZV0gfHwgKHJlZiRbaXRlbVR5cGVdID0gW10pKS4kcHJvbWlzZSA9PSBudWxsKSB7XG4gICAgICAgIHRoaXMuX3N0b3JhZ2VbaXRlbVR5cGVdLiRwcm9taXNlID0gdGVzdCA9IHRoaXMuX2V4dGVybmFsRGF0YVN2Yy5sb2FkSnNvbihcIi9tb2R1bGVzL2l0ZW1zL2NvbnRlbnQvXCIgKyBpdGVtVHlwZSArIFwicy5qc29uXCIpLnRoZW4oZnVuY3Rpb24oaXRlbURhdGEpe1xuICAgICAgICAgIGVhY2goZnVuY3Rpb24oaXQpe1xuICAgICAgICAgICAgdmFyIHJlZiQ7XG4gICAgICAgICAgICAoKHJlZiQgPSB0aGlzJC5fc3RvcmFnZSlbaXRlbVR5cGVdIHx8IChyZWYkW2l0ZW1UeXBlXSA9IFtdKSkucHVzaCh0aGlzJC5jcmVhdGVJdGVtTW9kZWxGcm9tKGl0KSk7XG4gICAgICAgICAgfSkoXG4gICAgICAgICAgaXRlbURhdGEpO1xuICAgICAgICAgIHJldHVybiB0aGlzJC5fc3RvcmFnZVtpdGVtVHlwZV07XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJldHVyblByb21pc2VcbiAgICAgICAgPyB0aGlzLl9zdG9yYWdlW2l0ZW1UeXBlXS4kcHJvbWlzZVxuICAgICAgICA6IHRoaXMuX3N0b3JhZ2VbaXRlbVR5cGVdO1xuICAgIH07XG4gICAgcHJvdG90eXBlLmdldFVwZ3JhZGVkID0gZnVuY3Rpb24oaXRlbSwgbGV2ZWwpe1xuICAgICAgdmFyIHRoaXMkID0gdGhpcztcbiAgICAgIGxldmVsID09IG51bGwgJiYgKGxldmVsID0gdHJ1ZSk7XG4gICAgICBpZiAobGV2ZWwgPT09IHRydWUpIHtcbiAgICAgICAgbGV2ZWwgPSBpdGVtLnVwZ3JhZGVJZCArIDE7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy51cGdyYWRlQ29tcC5maW5kVXBncmFkZUZvcihpdGVtLCBsZXZlbCkudGhlbihmdW5jdGlvbih1cGdyYWRlKXtcbiAgICAgICAgaWYgKHVwZ3JhZGUgPT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzJC51cGdyYWRlQ29tcC5maW5kQmFzZUl0ZW0oXG4gICAgICAgIGl0ZW0pLnRoZW4oZnVuY3Rpb24oYmFzZUl0ZW0pe1xuICAgICAgICAgIHJldHVybiB0aGlzJC5jcmVhdGVJdGVtTW9kZWxGcm9tKGJhc2VJdGVtKTtcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbihuZXdJdGVtKXtcbiAgICAgICAgICByZXR1cm4gdGhpcyQudXBncmFkZUNvbXAuYXBwbHkodXBncmFkZSkudG8obmV3SXRlbSk7XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24obmV3SXRlbSl7XG4gICAgICAgICAgcmV0dXJuIHRoaXMkLl9pdGVtSW5kZXhTdmMuZmluZEVudHJ5QnlVaWQobmV3SXRlbS51aWQpLnRoZW4oZnVuY3Rpb24oZW50cnkpe1xuICAgICAgICAgICAgbmV3SXRlbS5uYW1lID0gZW50cnkubmFtZTtcbiAgICAgICAgICAgIHJldHVybiBuZXdJdGVtO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKG5ld0l0ZW0pe1xuICAgICAgICAgIGlmIChuZXdJdGVtLml0ZW1UeXBlID09PSAnYXJtb3InKSB7XG4gICAgICAgICAgICBuZXdJdGVtLmFybW9yU2V0ID0gdGhpcyQuX2l0ZW1JbmRleFN2Yy5maW5kQXJtb3JTZXRGb3IobmV3SXRlbSkubmFtZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG5ld0l0ZW07XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gSXRlbVNlcnZpY2U7XG4gIH0oKSk7XG4gIGlmICh0eXBlb2YgbW9kdWxlICE9ICd1bmRlZmluZWQnICYmIG1vZHVsZSAhPT0gbnVsbCkge1xuICAgIG1vZHVsZS5leHBvcnRzID0gSXRlbVNlcnZpY2U7XG4gIH1cbiAgZnVuY3Rpb24gYmluZCQob2JqLCBrZXksIHRhcmdldCl7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiAodGFyZ2V0IHx8IG9iailba2V5XS5hcHBseShvYmosIGFyZ3VtZW50cykgfTtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiIsIihmdW5jdGlvbigpe1xuICBhbmd1bGFyLm1vZHVsZShcImRzY1wiKS5jb250cm9sbGVyKFwiSXRlbXNDb250cm9sbGVyXCIsIGZ1bmN0aW9uKCRzY29wZSwgZGF0YUV4cG9ydFN2YywgaXRlbVN2YywgdWlHcmlkQ29uc3RhbnRzKXtcbiAgICB2YXIgaSQsIHJlZiQsIGxlbiQsIGl0ZW1UeXBlO1xuICAgICRzY29wZS5pdGVtVHlwZXMgPSBbXTtcbiAgICBmb3IgKGkkID0gMCwgbGVuJCA9IChyZWYkID0gWydub25lJywgJ2l0ZW0nLCAnd2VhcG9uJywgJ2FybW9yJ10pLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICBpdGVtVHlwZSA9IHJlZiRbaSRdO1xuICAgICAgJHNjb3BlLml0ZW1UeXBlcy5wdXNoKGl0ZW1UeXBlKTtcbiAgICB9XG4gICAgcmVxdWlyZSgnLi9jb25maWcvaXRlbXMtZ3JpZC1vcHRpb25zJykoJHNjb3BlLCB1aUdyaWRDb25zdGFudHMpO1xuICAgICRzY29wZS5zZWxlY3RlZEl0ZW1UeXBlQ2hhbmdlZCA9IGZ1bmN0aW9uKCl7XG4gICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkSXRlbVR5cGUgPT09ICdub25lJykge1xuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9IFtdO1xuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IFtdO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9ICRzY29wZS5jb2x1bW5Db25maWdzWyRzY29wZS5zZWxlY3RlZEl0ZW1UeXBlXTtcbiAgICAgIGl0ZW1TdmMubG9hZEFsbEl0ZW1zKCRzY29wZS5zZWxlY3RlZEl0ZW1UeXBlKS50aGVuKGZ1bmN0aW9uKGl0ZW1EYXRhKXtcbiAgICAgICAgdmFyIGkkLCBsZW4kLCB3ZWFwb247XG4gICAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRJdGVtVHlwZSA9PT0gJ3dlYXBvbicpIHtcbiAgICAgICAgICBmb3IgKGkkID0gMCwgbGVuJCA9IGl0ZW1EYXRhLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgICAgICB3ZWFwb24gPSBpdGVtRGF0YVtpJF07XG4gICAgICAgICAgICAoZm4kLmNhbGwodGhpcywgd2VhcG9uKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5kYXRhID0gaXRlbURhdGE7XG4gICAgICAgIGZ1bmN0aW9uIGZuJCh3ZWFwb24pe1xuICAgICAgICAgIGl0ZW1TdmMuZ2V0VXBncmFkZWQod2VhcG9uLCAwKS50aGVuKGZ1bmN0aW9uKHVwKXtcbiAgICAgICAgICAgIGltcG9ydCQod2VhcG9uLCB1cCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgJHNjb3BlLmV4cG9ydEFzSnNvbiA9IGZ1bmN0aW9uKCl7XG4gICAgICBkYXRhRXhwb3J0U3ZjLmV4cG9ydEpzb24obWFwKGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgZGVsZXRlIGl0LiQkaGFzaEtleTtcbiAgICAgICAgcmV0dXJuIGl0O1xuICAgICAgfSkoXG4gICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSkpO1xuICAgIH07XG4gICAgJHNjb3BlLmV4cG9ydEFzQ3N2ID0gZnVuY3Rpb24oKXtcbiAgICAgIHZhciBvdXRwdXREYXRhO1xuICAgICAgb3V0cHV0RGF0YSA9IG1hcChmdW5jdGlvbihpdCl7XG4gICAgICAgIHZhciBpdGVtO1xuICAgICAgICBpdGVtID0gaW1wb3J0JCh7fSwgaXQpO1xuICAgICAgICBkZWxldGUgaXRlbS4kJGhhc2hLZXk7XG4gICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgfSkoXG4gICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSk7XG4gICAgICBkYXRhRXhwb3J0U3ZjLmV4cG9ydENzdihvdXRwdXREYXRhKTtcbiAgICB9O1xuICAgICRzY29wZS5zZWxlY3RlZEl0ZW1UeXBlID0gJ25vbmUnO1xuICB9KTtcbiAgZnVuY3Rpb24gaW1wb3J0JChvYmosIHNyYyl7XG4gICAgdmFyIG93biA9IHt9Lmhhc093blByb3BlcnR5O1xuICAgIGZvciAodmFyIGtleSBpbiBzcmMpIGlmIChvd24uY2FsbChzcmMsIGtleSkpIG9ialtrZXldID0gc3JjW2tleV07XG4gICAgcmV0dXJuIG9iajtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiIsIihmdW5jdGlvbigpe1xuICByZXF1aXJlKCcuL2l0ZW1zLWNvbnRyb2xsZXInKTtcbiAgcmVxdWlyZSgnLi9pdGVtLXNlcnZpY2UnKTtcbiAgcmVxdWlyZSgnLi9pdGVtLWluZGV4LXNlcnZpY2UnKTtcbn0pLmNhbGwodGhpcyk7XG4iLCIoZnVuY3Rpb24oKXtcbiAgdmFyIEl0ZW1Nb2RlbCwgRXF1aXBtZW50TW9kZWwsIFdlYXBvbk1vZGVsLCBBcm1vck1vZGVsO1xuICBpZiAodHlwZW9mIG1vZHVsZSAhPSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09IG51bGwpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IHtcbiAgICAgICdJdGVtJzogSXRlbU1vZGVsID0gKGZ1bmN0aW9uKCl7XG4gICAgICAgIEl0ZW1Nb2RlbC5kaXNwbGF5TmFtZSA9ICdJdGVtTW9kZWwnO1xuICAgICAgICB2YXIgcHJvdG90eXBlID0gSXRlbU1vZGVsLnByb3RvdHlwZSwgY29uc3RydWN0b3IgPSBJdGVtTW9kZWw7XG4gICAgICAgIGZ1bmN0aW9uIEl0ZW1Nb2RlbCgpe1xuICAgICAgICAgIHRoaXMudXNlRGF0YUZyb20gPSBiaW5kJCh0aGlzLCAndXNlRGF0YUZyb20nLCBwcm90b3R5cGUpO1xuICAgICAgICAgIHRoaXMuaWQgPSAwO1xuICAgICAgICAgIHRoaXMuaXRlbVR5cGUgPSAnaXRlbSc7XG4gICAgICAgICAgdGhpcy5pdGVtU3VidHlwZSA9ICcnO1xuICAgICAgICAgIHRoaXMubmFtZSA9ICcnO1xuICAgICAgICAgIHRoaXMuc2VsbFZhbHVlID0gMDtcbiAgICAgICAgICB0aGlzLmljb25JZCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgdW5pcXVlIElEIHRoYXQgZG9lc24ndCBvdmVybGFwIGJldHdlZW4gaXRlbSB0eXBlcy5cbiAgICAgICAgICovXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGUsICd1aWQnLCB7XG4gICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXRlbVR5cGUgKyB0aGlzLmlkO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHByb3RvdHlwZS51c2VEYXRhRnJvbSA9IGZ1bmN0aW9uKGl0ZW1EYXRhKXtcbiAgICAgICAgICByZXR1cm4gaW1wb3J0JCh0aGlzLCBpdGVtRGF0YSk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBJdGVtTW9kZWw7XG4gICAgICB9KCkpLFxuICAgICAgJ0VxdWlwbWVudCc6IEVxdWlwbWVudE1vZGVsID0gKGZ1bmN0aW9uKHN1cGVyY2xhc3Mpe1xuICAgICAgICB2YXIgcHJvdG90eXBlID0gZXh0ZW5kJCgoaW1wb3J0JChFcXVpcG1lbnRNb2RlbCwgc3VwZXJjbGFzcykuZGlzcGxheU5hbWUgPSAnRXF1aXBtZW50TW9kZWwnLCBFcXVpcG1lbnRNb2RlbCksIHN1cGVyY2xhc3MpLnByb3RvdHlwZSwgY29uc3RydWN0b3IgPSBFcXVpcG1lbnRNb2RlbDtcbiAgICAgICAgZnVuY3Rpb24gRXF1aXBtZW50TW9kZWwoKXtcbiAgICAgICAgICBFcXVpcG1lbnRNb2RlbC5zdXBlcmNsYXNzLmNhbGwodGhpcyk7XG4gICAgICAgICAgdGhpcy53ZWlnaHQgPSAwLjA7XG4gICAgICAgICAgdGhpcy5kdXJhYmlsaXR5ID0gMDtcbiAgICAgICAgICB0aGlzLmRlZlBoeSA9IDA7XG4gICAgICAgICAgdGhpcy5kZWZNYWcgPSAwO1xuICAgICAgICAgIHRoaXMuZGVmRmlyID0gMDtcbiAgICAgICAgICB0aGlzLmRlZkxpdCA9IDA7XG4gICAgICAgICAgdGhpcy5kZWZUb3ggPSAwO1xuICAgICAgICAgIHRoaXMuZGVmQmxvID0gMDtcbiAgICAgICAgICB0aGlzLmRlZkN1ciA9IDA7XG4gICAgICAgICAgdGhpcy5tYXRTZXRJZCA9IDA7XG4gICAgICAgICAgdGhpcy51cGdyYWRlQ29zdCA9IDA7XG4gICAgICAgICAgdGhpcy51cGdyYWRlSWQgPSAtMTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gRXF1aXBtZW50TW9kZWw7XG4gICAgICB9KEl0ZW1Nb2RlbCkpLFxuICAgICAgJ1dlYXBvbic6IFdlYXBvbk1vZGVsID0gKGZ1bmN0aW9uKHN1cGVyY2xhc3Mpe1xuICAgICAgICB2YXIgcHJvdG90eXBlID0gZXh0ZW5kJCgoaW1wb3J0JChXZWFwb25Nb2RlbCwgc3VwZXJjbGFzcykuZGlzcGxheU5hbWUgPSAnV2VhcG9uTW9kZWwnLCBXZWFwb25Nb2RlbCksIHN1cGVyY2xhc3MpLnByb3RvdHlwZSwgY29uc3RydWN0b3IgPSBXZWFwb25Nb2RlbDtcbiAgICAgICAgZnVuY3Rpb24gV2VhcG9uTW9kZWwoKXtcbiAgICAgICAgICB0aGlzLl9kcHNGb3IgPSBiaW5kJCh0aGlzLCAnX2Rwc0ZvcicsIHByb3RvdHlwZSk7XG4gICAgICAgICAgV2VhcG9uTW9kZWwuc3VwZXJjbGFzcy5jYWxsKHRoaXMpO1xuICAgICAgICAgIHRoaXMuaXRlbVR5cGUgPSAnd2VhcG9uJztcbiAgICAgICAgICB0aGlzLndlYXBvblR5cGUgPSAnJztcbiAgICAgICAgICB0aGlzLndlYXBvblN1YnR5cGUgPSAnJztcbiAgICAgICAgICB0aGlzLnBhdGggPSAnJztcbiAgICAgICAgICB0aGlzLmNhbkJsb2NrID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5jYW5QYXJyeSA9IGZhbHNlO1xuICAgICAgICAgIHRoaXMuY2FzdHNNYWdpYyA9IGZhbHNlO1xuICAgICAgICAgIHRoaXMuY2FzdHNQeXJvbWFuY3kgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLmNhc3RzTWlyYWNsZXMgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLmRhbWFnZXNHaG9zdHMgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLmlzQXVnbWVudGFibGUgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLmRvZXNSZWd1bGFyRGFtYWdlID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5kb2VzU3RyaWtlRGFtYWdlID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5kb2VzU2xhc2hEYW1hZ2UgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLmRvZXNUaHJ1c3REYW1hZ2UgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLnJlcVN0ciA9IDA7XG4gICAgICAgICAgdGhpcy5yZXFEZXggPSAwO1xuICAgICAgICAgIHRoaXMucmVxSW50ID0gMDtcbiAgICAgICAgICB0aGlzLnJlcUZhaSA9IDA7XG4gICAgICAgICAgdGhpcy5hdGtQaHkgPSAwO1xuICAgICAgICAgIHRoaXMuYXRrTWFnID0gMDtcbiAgICAgICAgICB0aGlzLmF0a0ZpciA9IDA7XG4gICAgICAgICAgdGhpcy5hdGtMaXQgPSAwO1xuICAgICAgICAgIHRoaXMuYXRrU3RhQ29zdCA9IDA7XG4gICAgICAgICAgdGhpcy5ib251c1N0ciA9IDA7XG4gICAgICAgICAgdGhpcy5ib251c0RleCA9IDA7XG4gICAgICAgICAgdGhpcy5ib251c0ludCA9IDA7XG4gICAgICAgICAgdGhpcy5ib251c0ZhaSA9IDA7XG4gICAgICAgICAgdGhpcy5kZWZTdGEgPSAwO1xuICAgICAgICAgIHRoaXMuZGl2aW5lID0gMDtcbiAgICAgICAgICB0aGlzLm9jY3VsdCA9IDA7XG4gICAgICAgICAgdGhpcy5yYW5nZSA9IDA7XG4gICAgICAgICAgdGhpcy5hdGtCbG8gPSAwO1xuICAgICAgICAgIHRoaXMuZG1nQmxvID0gMDtcbiAgICAgICAgICB0aGlzLmF0a1RveCA9IDA7XG4gICAgICAgICAgdGhpcy5kbWdUb3ggPSAwO1xuICAgICAgICAgIHRoaXMuYXRrSGVhbCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgcHJvdG90eXBlLl9kcHNGb3IgPSBmdW5jdGlvbihzdGF0KXtcbiAgICAgICAgICBpZiAodGhpcy5hdGtTdGFDb3N0ID4gMSkge1xuICAgICAgICAgICAgcmV0dXJuIHN0YXQgLyAodGhpcy5hdGtTdGFDb3N0ICogMS44KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlLCAnZHBzUGh5Jywge1xuICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kcHNGb3IodGhpcy5hdGtQaHkpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGUsICdkcHNNYWcnLCB7XG4gICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Rwc0Zvcih0aGlzLmF0a01hZyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZSwgJ2Rwc0ZpcicsIHtcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZHBzRm9yKHRoaXMuYXRrRmlyKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlLCAnZHBzTGl0Jywge1xuICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kcHNGb3IodGhpcy5hdGtMaXQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBXZWFwb25Nb2RlbDtcbiAgICAgIH0oRXF1aXBtZW50TW9kZWwpKSxcbiAgICAgICdBcm1vcic6IEFybW9yTW9kZWwgPSAoZnVuY3Rpb24oc3VwZXJjbGFzcyl7XG4gICAgICAgIHZhciBwcm90b3R5cGUgPSBleHRlbmQkKChpbXBvcnQkKEFybW9yTW9kZWwsIHN1cGVyY2xhc3MpLmRpc3BsYXlOYW1lID0gJ0FybW9yTW9kZWwnLCBBcm1vck1vZGVsKSwgc3VwZXJjbGFzcykucHJvdG90eXBlLCBjb25zdHJ1Y3RvciA9IEFybW9yTW9kZWw7XG4gICAgICAgIGZ1bmN0aW9uIEFybW9yTW9kZWwoKXtcbiAgICAgICAgICBBcm1vck1vZGVsLnN1cGVyY2xhc3MuY2FsbCh0aGlzKTtcbiAgICAgICAgICB0aGlzLml0ZW1UeXBlID0gJ2FybW9yJztcbiAgICAgICAgICB0aGlzLmFybW9yVHlwZSA9ICcnO1xuICAgICAgICAgIHRoaXMuYXJtb3JTZXQgPSAnJztcbiAgICAgICAgICB0aGlzLmRlZlNsYXNoID0gMDtcbiAgICAgICAgICB0aGlzLmRlZlN0cmlrZSA9IDA7XG4gICAgICAgICAgdGhpcy5kZWZUaHJ1c3QgPSAwO1xuICAgICAgICAgIHRoaXMuZGVmUG9pc2UgPSAwO1xuICAgICAgICAgIHRoaXMuc3RhUmVnZW5Nb2QgPSAwO1xuICAgICAgICB9XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGUsICdzb3J0VHlwZScsIHtcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuYXJtb3JUeXBlKSB7XG4gICAgICAgICAgICBjYXNlICdoZWFkJzpcbiAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICBjYXNlICdjaGVzdCc6XG4gICAgICAgICAgICAgIHJldHVybiAyO1xuICAgICAgICAgICAgY2FzZSAnaGFuZHMnOlxuICAgICAgICAgICAgICByZXR1cm4gMztcbiAgICAgICAgICAgIGNhc2UgJ2xlZ3MnOlxuICAgICAgICAgICAgICByZXR1cm4gNDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gQXJtb3JNb2RlbDtcbiAgICAgIH0oRXF1aXBtZW50TW9kZWwpKVxuICAgIH07XG4gIH1cbiAgZnVuY3Rpb24gYmluZCQob2JqLCBrZXksIHRhcmdldCl7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiAodGFyZ2V0IHx8IG9iailba2V5XS5hcHBseShvYmosIGFyZ3VtZW50cykgfTtcbiAgfVxuICBmdW5jdGlvbiBpbXBvcnQkKG9iaiwgc3JjKXtcbiAgICB2YXIgb3duID0ge30uaGFzT3duUHJvcGVydHk7XG4gICAgZm9yICh2YXIga2V5IGluIHNyYykgaWYgKG93bi5jYWxsKHNyYywga2V5KSkgb2JqW2tleV0gPSBzcmNba2V5XTtcbiAgICByZXR1cm4gb2JqO1xuICB9XG4gIGZ1bmN0aW9uIGV4dGVuZCQoc3ViLCBzdXApe1xuICAgIGZ1bmN0aW9uIGZ1bigpe30gZnVuLnByb3RvdHlwZSA9IChzdWIuc3VwZXJjbGFzcyA9IHN1cCkucHJvdG90eXBlO1xuICAgIChzdWIucHJvdG90eXBlID0gbmV3IGZ1bikuY29uc3RydWN0b3IgPSBzdWI7XG4gICAgaWYgKHR5cGVvZiBzdXAuZXh0ZW5kZWQgPT0gJ2Z1bmN0aW9uJykgc3VwLmV4dGVuZGVkKHN1Yik7XG4gICAgcmV0dXJuIHN1YjtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiIsIihmdW5jdGlvbigpe1xuICBpZiAodHlwZW9mIG1vZHVsZSAhPSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09IG51bGwpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHVpR3JpZENvbnN0YW50cyl7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IHRydWUsXG4gICAgICAgIGNvbHVtbkRlZnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogJ25hbWUnLFxuICAgICAgICAgICAgc29ydDoge1xuICAgICAgICAgICAgICBkaXJlY3Rpb246IHVpR3JpZENvbnN0YW50cy5BU0NcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ2l0ZW1UeXBlJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnVHlwZScsXG4gICAgICAgICAgICBmaWx0ZXI6IHtcbiAgICAgICAgICAgICAgdHlwZTogdWlHcmlkQ29uc3RhbnRzLmZpbHRlci5TRUxFQ1QsXG4gICAgICAgICAgICAgIHNlbGVjdE9wdGlvbnM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICB2YWx1ZTogJ3dlYXBvbicsXG4gICAgICAgICAgICAgICAgICBsYWJlbDogXCJXZWFwb25zXCJcbiAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICB2YWx1ZTogJ2FybW9yJyxcbiAgICAgICAgICAgICAgICAgIGxhYmVsOiBcIkFybW9yXCJcbiAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICB2YWx1ZTogJ2l0ZW0nLFxuICAgICAgICAgICAgICAgICAgbGFiZWw6IFwiSXRlbXNcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnYW1vdW50JyxcbiAgICAgICAgICAgIHdpZHRoOiA1MFxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgb25SZWdpc3RlckFwaTogZnVuY3Rpb24oZ3JpZEFwaSl7XG4gICAgICAgICAgZ3JpZEFwaS5jb3JlLmFkZFJvd0hlYWRlckNvbHVtbih7XG4gICAgICAgICAgICBuYW1lOiAncm93SGVhZGVyQ29sJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnJyxcbiAgICAgICAgICAgIHdpZHRoOiAxMDAsXG4gICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICdHcmlkUm93SGVhZGVyLmh0bWwnXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiIsIihmdW5jdGlvbigpe1xuICBhbmd1bGFyLm1vZHVsZShcImRzY1wiKS5maWx0ZXIoXCJ0b1N0YXRBcnJheVwiLCBmdW5jdGlvbihzdGF0U3ZjKXtcbiAgICB2YXIgb3V0cHV0O1xuICAgIG91dHB1dCA9IFtdO1xuICAgIHJldHVybiBmdW5jdGlvbihtb2RlbCl7XG4gICAgICBpZiAob3V0cHV0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICAgIH1cbiAgICAgIHN0YXRTdmMuZm9yRWFjaFN0YXQobW9kZWwsIGZ1bmN0aW9uKHN0YXQsIG5hbWUpe1xuICAgICAgICBvdXRwdXQucHVzaChtb2RlbFtuYW1lXSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfTtcbiAgfSk7XG59KS5jYWxsKHRoaXMpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gIHZhciBJbnZlbnRvcnlTdmM7XG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPSAndW5kZWZpbmVkJyAmJiBhbmd1bGFyICE9PSBudWxsKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJkc2NcIikuc2VydmljZShcImludmVudG9yeVN2Y1wiLCBmdW5jdGlvbihzdG9yYWdlU3ZjLCBpdGVtSW5kZXhTdmMsICRxKXtcbiAgICAgIHJldHVybiAoZnVuY3Rpb24oZnVuYywgYXJncywgY3Rvcikge1xuICAgICAgICBjdG9yLnByb3RvdHlwZSA9IGZ1bmMucHJvdG90eXBlO1xuICAgICAgICB2YXIgY2hpbGQgPSBuZXcgY3RvciwgcmVzdWx0ID0gZnVuYy5hcHBseShjaGlsZCwgYXJncyksIHQ7XG4gICAgICAgIHJldHVybiAodCA9IHR5cGVvZiByZXN1bHQpICA9PSBcIm9iamVjdFwiIHx8IHQgPT0gXCJmdW5jdGlvblwiID8gcmVzdWx0IHx8IGNoaWxkIDogY2hpbGQ7XG4gIH0pKEludmVudG9yeVN2YywgYXJndW1lbnRzLCBmdW5jdGlvbigpe30pO1xuICAgIH0pO1xuICB9XG4gIEludmVudG9yeVN2YyA9IChmdW5jdGlvbigpe1xuICAgIEludmVudG9yeVN2Yy5kaXNwbGF5TmFtZSA9ICdJbnZlbnRvcnlTdmMnO1xuICAgIHZhciBwcm90b3R5cGUgPSBJbnZlbnRvcnlTdmMucHJvdG90eXBlLCBjb25zdHJ1Y3RvciA9IEludmVudG9yeVN2YztcbiAgICBmdW5jdGlvbiBJbnZlbnRvcnlTdmMoX3N0b3JhZ2VTdmMsIF9pdGVtSW5kZXhTdmMsICRxKXtcbiAgICAgIHRoaXMuX3N0b3JhZ2VTdmMgPSBfc3RvcmFnZVN2YztcbiAgICAgIHRoaXMuX2l0ZW1JbmRleFN2YyA9IF9pdGVtSW5kZXhTdmM7XG4gICAgICB0aGlzLiRxID0gJHE7XG4gICAgICB0aGlzLmNsZWFyID0gYmluZCQodGhpcywgJ2NsZWFyJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMucmVtb3ZlID0gYmluZCQodGhpcywgJ3JlbW92ZScsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmFkZCA9IGJpbmQkKHRoaXMsICdhZGQnLCBwcm90b3R5cGUpO1xuICAgICAgdGhpcy5jcmVhdGVJbnZlbnRvcnlJdGVtRnJvbSA9IGJpbmQkKHRoaXMsICdjcmVhdGVJbnZlbnRvcnlJdGVtRnJvbScsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmZpbmRJdGVtQnlVaWQgPSBiaW5kJCh0aGlzLCAnZmluZEl0ZW1CeVVpZCcsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmxvYWQgPSBiaW5kJCh0aGlzLCAnbG9hZCcsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLnNhdmUgPSBiaW5kJCh0aGlzLCAnc2F2ZScsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLl9pbnZlbnRvcnkgPSBbXTtcbiAgICAgIHRoaXMuX21vZGVscyA9IHJlcXVpcmUoJy4vbW9kZWxzL2ludmVudG9yeS1tb2RlbHMnKTtcbiAgICB9XG4gICAgcHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbigpe1xuICAgICAgdmFyIGRhdGEsIGkkLCByZWYkLCBsZW4kLCBpdGVtO1xuICAgICAgZGF0YSA9IFtdO1xuICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSAocmVmJCA9IHRoaXMuX2ludmVudG9yeSkubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgICAgaXRlbSA9IHJlZiRbaSRdO1xuICAgICAgICBkYXRhLnB1c2goe1xuICAgICAgICAgICd1aWQnOiBpdGVtLnVpZCxcbiAgICAgICAgICAnYW1vdW50JzogaXRlbS5hbW91bnRcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLl9zdG9yYWdlU3ZjLnNhdmUoJ2ludmVudG9yeScsIGRhdGEpO1xuICAgIH07XG4gICAgcHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbihyZXR1cm5Qcm9taXNlKXtcbiAgICAgIHZhciBwcm9taXNlcywgaSQsIHJlZiQsIGxlbiQsIGRhdGEsIHByb21pc2UsIHRoaXMkID0gdGhpcztcbiAgICAgIHJldHVyblByb21pc2UgPT0gbnVsbCAmJiAocmV0dXJuUHJvbWlzZSA9IHRydWUpO1xuICAgICAgaWYgKHRoaXMuX2ludmVudG9yeS4kcHJvbWlzZSA9PSBudWxsKSB7XG4gICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICAgICAgcHJvbWlzZXMgPSBbXTtcbiAgICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSAocmVmJCA9IHRoaXMuX3N0b3JhZ2VTdmMubG9hZCgnaW52ZW50b3J5JykpLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgICAgZGF0YSA9IHJlZiRbaSRdO1xuICAgICAgICAgIHByb21pc2UgPSBmbiQoZGF0YSk7XG4gICAgICAgICAgcHJvbWlzZXMucHVzaChwcm9taXNlKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9pbnZlbnRvcnkuJHByb21pc2UgPSB0aGlzLiRxLmFsbChwcm9taXNlcykudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAgIHJldHVybiB0aGlzJC5faW52ZW50b3J5O1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXR1cm5Qcm9taXNlXG4gICAgICAgID8gdGhpcy5faW52ZW50b3J5LiRwcm9taXNlXG4gICAgICAgIDogdGhpcy5faW52ZW50b3J5O1xuICAgICAgZnVuY3Rpb24gZm4kKGRhdGEpe1xuICAgICAgICB2YXIgaXRlbTtcbiAgICAgICAgaXRlbSA9IG5ldyB0aGlzJC5fbW9kZWxzLkludmVudG9yeUl0ZW0oZGF0YSk7XG4gICAgICAgIHJldHVybiB0aGlzJC5faXRlbUluZGV4U3ZjLmZpbmRFbnRyeUJ5VWlkKGRhdGEudWlkKS50aGVuKGZ1bmN0aW9uKGluZGV4RW50cnkpe1xuICAgICAgICAgIGl0ZW0udXNlRGF0YUZyb20oaW5kZXhFbnRyeSk7XG4gICAgICAgICAgdGhpcyQuX2ludmVudG9yeS5wdXNoKGl0ZW0pO1xuICAgICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHByb3RvdHlwZS5maW5kSXRlbUJ5VWlkID0gZnVuY3Rpb24odWlkKXtcbiAgICAgIHZhciB0aGlzJCA9IHRoaXM7XG4gICAgICByZXR1cm4gdGhpcy5sb2FkKCkudGhlbihmdW5jdGlvbihpbnZlbnRvcnkpe1xuICAgICAgICByZXR1cm4gZmluZChmdW5jdGlvbihpdCl7XG4gICAgICAgICAgcmV0dXJuIGl0LnVpZCA9PT0gdWlkO1xuICAgICAgICB9KShcbiAgICAgICAgaW52ZW50b3J5KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgcHJvdG90eXBlLmNyZWF0ZUludmVudG9yeUl0ZW1Gcm9tID0gZnVuY3Rpb24oaXRlbSwgYW1vdW50KXtcbiAgICAgIHZhciB4JDtcbiAgICAgIGFtb3VudCA9PSBudWxsICYmIChhbW91bnQgPSAxKTtcbiAgICAgIHgkID0gbmV3IHRoaXMuX21vZGVscy5JbnZlbnRvcnlJdGVtO1xuICAgICAgeCQudXNlRGF0YUZyb20oaXRlbSk7XG4gICAgICB4JC5hbW91bnQgPSBhbW91bnQ7XG4gICAgICByZXR1cm4geCQ7XG4gICAgfTtcbiAgICBwcm90b3R5cGUuYWRkID0gZnVuY3Rpb24oaXRlbSwgYW1vdW50KXtcbiAgICAgIHZhciB0aGlzJCA9IHRoaXM7XG4gICAgICBhbW91bnQgPT0gbnVsbCAmJiAoYW1vdW50ID0gMSk7XG4gICAgICByZXR1cm4gdGhpcy5maW5kSXRlbUJ5VWlkKGl0ZW0udWlkKS50aGVuKGZ1bmN0aW9uKGludkl0ZW0pe1xuICAgICAgICB2YXIgeCQ7XG4gICAgICAgIGlmIChpbnZJdGVtICE9IG51bGwpIHtcbiAgICAgICAgICBpbnZJdGVtLmFtb3VudCArPSBhbW91bnQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgeCQgPSBpbnZJdGVtID0gdGhpcyQuY3JlYXRlSW52ZW50b3J5SXRlbUZyb20oaXRlbSwgYW1vdW50KTtcbiAgICAgICAgICB0aGlzJC5faW52ZW50b3J5LnB1c2goXG4gICAgICAgICAgeCQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMkLnNhdmUoKTtcbiAgICAgICAgcmV0dXJuIGludkl0ZW07XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihpdGVtLCBhbW91bnQpe1xuICAgICAgdmFyIHRoaXMkID0gdGhpcztcbiAgICAgIGFtb3VudCA9PSBudWxsICYmIChhbW91bnQgPSAxKTtcbiAgICAgIHJldHVybiB0aGlzLmZpbmRJdGVtQnlVaWQoaXRlbS51aWQpLnRoZW4oZnVuY3Rpb24oZW50cnkpe1xuICAgICAgICBpZiAoZW50cnkgPT0gbnVsbCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byByZW1vdmUgdGhlIGFib3ZlIGl0ZW0gYmVjYXVzZSBjb3VsZG4ndCBmaW5kIGl0IGluIHRoZSBpbnZlbnRvcnkuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVudHJ5LmFtb3VudCA9IGFtb3VudCA9PT0gdHJ1ZVxuICAgICAgICAgID8gMFxuICAgICAgICAgIDogZW50cnkuYW1vdW50IC09IGFtb3VudDtcbiAgICAgICAgaWYgKGVudHJ5LmFtb3VudCA8IDEpIHtcbiAgICAgICAgICB0aGlzJC5faW52ZW50b3J5LnNwbGljZSh0aGlzJC5faW52ZW50b3J5LmluZGV4T2YoZW50cnkpLCAxKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzJC5zYXZlKCk7XG4gICAgICAgIHJldHVybiBlbnRyeTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgcHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMuX2ludmVudG9yeS5sZW5ndGggPSAwO1xuICAgICAgZGVsZXRlIHRoaXMuX2ludmVudG9yeS4kcHJvbWlzZTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgcmV0dXJuIEludmVudG9yeVN2YztcbiAgfSgpKTtcbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlICE9PSBudWxsKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBJbnZlbnRvcnlTdmM7XG4gIH1cbiAgZnVuY3Rpb24gYmluZCQob2JqLCBrZXksIHRhcmdldCl7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiAodGFyZ2V0IHx8IG9iailba2V5XS5hcHBseShvYmosIGFyZ3VtZW50cykgfTtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiIsIihmdW5jdGlvbigpe1xuICBhbmd1bGFyLm1vZHVsZShcImRzY1wiKTtcbiAgcmVxdWlyZShcIi4vaW52ZW50b3J5LXNlcnZpY2VcIik7XG4gIHJlcXVpcmUoXCIuL3N0YXQtc2VydmljZVwiKTtcbiAgcmVxdWlyZShcIi4vZmlsdGVycy9zdGF0LWZpbHRlcnNcIik7XG4gIHJlcXVpcmUoXCIuL3BjLWNvbnRyb2xsZXJcIik7XG59KS5jYWxsKHRoaXMpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gIHZhciBQY01vZGVsO1xuICBpZiAodHlwZW9mIG1vZHVsZSAhPSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09IG51bGwpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IFBjTW9kZWwgPSAoZnVuY3Rpb24oKXtcbiAgICAgIFBjTW9kZWwuZGlzcGxheU5hbWUgPSAnUGNNb2RlbCc7XG4gICAgICB2YXIgcHJvdG90eXBlID0gUGNNb2RlbC5wcm90b3R5cGUsIGNvbnN0cnVjdG9yID0gUGNNb2RlbDtcbiAgICAgIFBjTW9kZWwuU3RhdHMgPSBbJ3ZpdGFsaXR5JywgJ2F0dHVuZW1lbnQnLCAnZW5kdXJhbmNlJywgJ3N0cmVuZ3RoJywgJ2RleHRlcml0eScsICdyZXNpc3RhbmNlJywgJ2ludGVsbGlnZW5jZScsICdmYWl0aCcsICdodW1hbml0eSddO1xuICAgICAgZnVuY3Rpb24gUGNNb2RlbChzdGF0U3ZjKXtcbiAgICAgICAgdGhpcy5zdGF0U3ZjID0gc3RhdFN2YztcbiAgICAgICAgdGhpcy52YWxpZGF0ZSA9IGJpbmQkKHRoaXMsICd2YWxpZGF0ZScsIHByb3RvdHlwZSk7XG4gICAgICAgIHRoaXMuZm9yRWFjaFN0YXQgPSBiaW5kJCh0aGlzLCAnZm9yRWFjaFN0YXQnLCBwcm90b3R5cGUpO1xuICAgICAgICB0aGlzLmZvckVhY2hTdGF0KGZ1bmN0aW9uKHN0YXQsIG5hbWUpe1xuICAgICAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vUGNTdGF0TW9kZWwnKSkobmFtZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcHJvdG90eXBlLmZvckVhY2hTdGF0ID0gZnVuY3Rpb24oZnVuYyl7XG4gICAgICAgIHRoaXMuc3RhdFN2Yy5mb3JFYWNoU3RhdChmdW5jLCB0aGlzKTtcbiAgICAgIH07XG4gICAgICBwcm90b3R5cGUudmFsaWRhdGUgPSBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLmZvckVhY2hTdGF0KGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgICBpdC5iYXNlID0gbWF4KDgsIG1pbig5OSwgaXQuYmFzZSkpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gUGNNb2RlbDtcbiAgICB9KCkpO1xuICB9XG4gIGZ1bmN0aW9uIGJpbmQkKG9iaiwga2V5LCB0YXJnZXQpe1xuICAgIHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gKHRhcmdldCB8fCBvYmopW2tleV0uYXBwbHkob2JqLCBhcmd1bWVudHMpIH07XG4gIH1cbn0pLmNhbGwodGhpcyk7XG4iLCIoZnVuY3Rpb24oKXtcbiAgdmFyIFBjU3RhdE1vZGVsO1xuICBpZiAodHlwZW9mIG1vZHVsZSAhPSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09IG51bGwpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IFBjU3RhdE1vZGVsID0gKGZ1bmN0aW9uKCl7XG4gICAgICBQY1N0YXRNb2RlbC5kaXNwbGF5TmFtZSA9ICdQY1N0YXRNb2RlbCc7XG4gICAgICB2YXIgcHJvdG90eXBlID0gUGNTdGF0TW9kZWwucHJvdG90eXBlLCBjb25zdHJ1Y3RvciA9IFBjU3RhdE1vZGVsO1xuICAgICAgZnVuY3Rpb24gUGNTdGF0TW9kZWwobmFtZSwgYmFzZSl7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuYmFzZSA9IGJhc2UgIT0gbnVsbCA/IGJhc2UgOiAwO1xuICAgICAgICB0aGlzLmJvbnVzID0gMDtcbiAgICAgIH1cbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGUsICd0b3RhbCcsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgIHJldHVybiB0aGlzLmJhc2UgKyB0aGlzLmJvbnVzO1xuICAgICAgICB9LFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgIH0pO1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZSwgJ2Rpc3BsYXlOYW1lJywge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgcmV0dXJuIGNhcGl0YWxpemUodGhpcy5uYW1lKTtcbiAgICAgICAgfSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBQY1N0YXRNb2RlbDtcbiAgICB9KCkpO1xuICB9XG59KS5jYWxsKHRoaXMpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gIHZhciBJbnZlbnRvcnlJdGVtTW9kZWw7XG4gIEludmVudG9yeUl0ZW1Nb2RlbCA9IChmdW5jdGlvbigpe1xuICAgIEludmVudG9yeUl0ZW1Nb2RlbC5kaXNwbGF5TmFtZSA9ICdJbnZlbnRvcnlJdGVtTW9kZWwnO1xuICAgIHZhciBwcm90b3R5cGUgPSBJbnZlbnRvcnlJdGVtTW9kZWwucHJvdG90eXBlLCBjb25zdHJ1Y3RvciA9IEludmVudG9yeUl0ZW1Nb2RlbDtcbiAgICBmdW5jdGlvbiBJbnZlbnRvcnlJdGVtTW9kZWwoaXRlbSl7XG4gICAgICB0aGlzLnVzZURhdGFGcm9tID0gYmluZCQodGhpcywgJ3VzZURhdGFGcm9tJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuYW1vdW50ID0gMTtcbiAgICAgIHRoaXMubmFtZSA9ICcnO1xuICAgICAgdGhpcy5pdGVtVHlwZSA9ICcnO1xuICAgICAgdGhpcy5pZCA9ICcnO1xuICAgICAgdGhpcy51aWQgPSAnJztcbiAgICAgIHRoaXMudXNlRGF0YUZyb20oaXRlbSk7XG4gICAgfVxuICAgIHByb3RvdHlwZS51c2VEYXRhRnJvbSA9IGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgdmFyIGkkLCByZWYkLCBsZW4kLCBmaWVsZDtcbiAgICAgIGlmIChpdGVtID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSAocmVmJCA9IFsnYW1vdW50JywgJ3VpZCcsICduYW1lJywgJ2l0ZW1UeXBlJywgJ2lkJ10pLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgIGZpZWxkID0gcmVmJFtpJF07XG4gICAgICAgIGlmIChpdGVtW2ZpZWxkXSAhPSBudWxsKSB7XG4gICAgICAgICAgdGhpc1tmaWVsZF0gPSBpdGVtW2ZpZWxkXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICByZXR1cm4gSW52ZW50b3J5SXRlbU1vZGVsO1xuICB9KCkpO1xuICBpZiAodHlwZW9mIG1vZHVsZSAhPSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09IG51bGwpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IHtcbiAgICAgICdJbnZlbnRvcnlJdGVtJzogSW52ZW50b3J5SXRlbU1vZGVsXG4gICAgfTtcbiAgfVxuICBmdW5jdGlvbiBiaW5kJChvYmosIGtleSwgdGFyZ2V0KXtcbiAgICByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuICh0YXJnZXQgfHwgb2JqKVtrZXldLmFwcGx5KG9iaiwgYXJndW1lbnRzKSB9O1xuICB9XG59KS5jYWxsKHRoaXMpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gIGFuZ3VsYXIubW9kdWxlKFwiZHNjXCIpLmNvbnRyb2xsZXIoXCJwY0NvbnRyb2xsZXJcIiwgZnVuY3Rpb24oJHNjb3BlLCB1aUdyaWRDb25zdGFudHMsIHN0YXRTdmMsIGl0ZW1TdmMsIGl0ZW1JbmRleFN2Yywgc3RvcmFnZVN2YywgaW52ZW50b3J5U3ZjLCBkYXRhRXhwb3J0U3ZjKXtcbiAgICAkc2NvcGUubW9kZWwgPSBzdGF0U3ZjLmxvYWRVc2VyRGF0YSgpO1xuICAgICRzY29wZS5zYXZlU3RhdHMgPSBmdW5jdGlvbigpe1xuICAgICAgc3RhdFN2Yy5zYXZlVXNlckRhdGEoJHNjb3BlLm1vZGVsKTtcbiAgICB9O1xuICAgICRzY29wZS5zZWxlY3RlZEl0ZW0gPSBudWxsO1xuICAgICRzY29wZS5hcm1vclNldHMgPSBbXTtcbiAgICAkc2NvcGUuYWxsSXRlbXMgPSBbXTtcbiAgICAkc2NvcGUuaXRlbVR5cGVzID0gWyd3ZWFwb24nLCAnYXJtb3InLCAnaXRlbSddO1xuICAgICRzY29wZS5ncmlkT3B0aW9ucyA9IHJlcXVpcmUoJy4vY29uZmlnL2ludmVudG9yeS1ncmlkLW9wdHMnKSh1aUdyaWRDb25zdGFudHMpO1xuICAgICRzY29wZS5hbGxJdGVtcyA9IGl0ZW1JbmRleFN2Yy5sb2FkQWxsRW50cmllcyhmYWxzZSk7XG4gICAgJHNjb3BlLmFybW9yU2V0cyA9IGl0ZW1JbmRleFN2Yy5sb2FkQWxsQXJtb3JTZXRFbnRyaWVzKGZhbHNlKTtcbiAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9IGludmVudG9yeVN2Yy5sb2FkKGZhbHNlKTtcbiAgICAkc2NvcGVbJ2V4cG9ydCddID0gZnVuY3Rpb24oKXt9O1xuICAgICRzY29wZS5jYW5VcGdyYWRlID0gZnVuY3Rpb24oaXRlbSl7XG4gICAgICByZXR1cm4gaXRlbVN2Yy51cGdyYWRlQ29tcC5jYW5CZVVwZ3JhZGVkKFxuICAgICAgaXRlbSk7XG4gICAgfTtcbiAgICAkc2NvcGUudXBncmFkZSA9IGZ1bmN0aW9uKGludkVudHJ5KXtcbiAgICAgIHJldHVybiBpdGVtU3ZjLmZpbmRBbnlJdGVtQnlVaWQoaW52RW50cnkudWlkKS50aGVuKGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICByZXR1cm4gaXRlbVN2Yy5nZXRVcGdyYWRlZChpdGVtKTtcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24odXBJdGVtKXtcbiAgICAgICAgaWYgKHVwSXRlbSA9PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgICRzY29wZS5yZW1vdmUoaW52RW50cnkpO1xuICAgICAgICAkc2NvcGUuYWRkKHVwSXRlbSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgICRzY29wZS5hZGROZXdJdGVtID0gZnVuY3Rpb24oc2VsZWN0aW9uKXtcbiAgICAgICRzY29wZS5hZGQoc2VsZWN0aW9uLm9yaWdpbmFsT2JqZWN0KTtcbiAgICB9O1xuICAgICRzY29wZS5hZGQgPSBpbnZlbnRvcnlTdmMuYWRkO1xuICAgICRzY29wZS5yZW1vdmUgPSBpbnZlbnRvcnlTdmMucmVtb3ZlO1xuICAgICRzY29wZS5hZGRBcm1vclNldCA9IGZ1bmN0aW9uKHNlbGVjdGlvbil7XG4gICAgICB2YXIgYXJtb3JTZXQ7XG4gICAgICBhcm1vclNldCA9IHNlbGVjdGlvbi5vcmlnaW5hbE9iamVjdDtcbiAgICAgIGl0ZW1JbmRleFN2Yy5maW5kQnlBcm1vclNldChhcm1vclNldCkudGhlbihmdW5jdGlvbihhcm1vcnMpe1xuICAgICAgICBlYWNoKCRzY29wZS5hZGQpKFxuICAgICAgICBhcm1vcnMpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG59KS5jYWxsKHRoaXMpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gIHZhciBTdGF0U2VydmljZTtcbiAgaWYgKHR5cGVvZiBhbmd1bGFyICE9ICd1bmRlZmluZWQnICYmIGFuZ3VsYXIgIT09IG51bGwpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcImRzY1wiKS5zZXJ2aWNlKFwic3RhdFN2Y1wiLCBmdW5jdGlvbihzdG9yYWdlU3ZjKXtcbiAgICAgIHJldHVybiAoZnVuY3Rpb24oZnVuYywgYXJncywgY3Rvcikge1xuICAgICAgICBjdG9yLnByb3RvdHlwZSA9IGZ1bmMucHJvdG90eXBlO1xuICAgICAgICB2YXIgY2hpbGQgPSBuZXcgY3RvciwgcmVzdWx0ID0gZnVuYy5hcHBseShjaGlsZCwgYXJncyksIHQ7XG4gICAgICAgIHJldHVybiAodCA9IHR5cGVvZiByZXN1bHQpICA9PSBcIm9iamVjdFwiIHx8IHQgPT0gXCJmdW5jdGlvblwiID8gcmVzdWx0IHx8IGNoaWxkIDogY2hpbGQ7XG4gIH0pKFN0YXRTZXJ2aWNlLCBhcmd1bWVudHMsIGZ1bmN0aW9uKCl7fSk7XG4gICAgfSk7XG4gIH1cbiAgU3RhdFNlcnZpY2UgPSAoZnVuY3Rpb24oKXtcbiAgICBTdGF0U2VydmljZS5kaXNwbGF5TmFtZSA9ICdTdGF0U2VydmljZSc7XG4gICAgdmFyIHByb3RvdHlwZSA9IFN0YXRTZXJ2aWNlLnByb3RvdHlwZSwgY29uc3RydWN0b3IgPSBTdGF0U2VydmljZTtcbiAgICBmdW5jdGlvbiBTdGF0U2VydmljZShfc3RvcmFnZVN2Yyl7XG4gICAgICB0aGlzLl9zdG9yYWdlU3ZjID0gX3N0b3JhZ2VTdmM7XG4gICAgICB0aGlzLnN0YXRTY2FsaW5nRmFjdG9yT2YgPSBiaW5kJCh0aGlzLCAnc3RhdFNjYWxpbmdGYWN0b3JPZicsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLnNhdmVVc2VyRGF0YSA9IGJpbmQkKHRoaXMsICdzYXZlVXNlckRhdGEnLCBwcm90b3R5cGUpO1xuICAgICAgdGhpcy5sb2FkVXNlckRhdGEgPSBiaW5kJCh0aGlzLCAnbG9hZFVzZXJEYXRhJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuZm9yRWFjaFN0YXQgPSBiaW5kJCh0aGlzLCAnZm9yRWFjaFN0YXQnLCBwcm90b3R5cGUpO1xuICAgICAgdGhpcy5zdGF0VmFsdWVPZiA9IGJpbmQkKHRoaXMsICdzdGF0VmFsdWVPZicsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLmRhdGEgPSB7fTtcbiAgICAgIHRoaXMuUGNNb2RlbCA9IHJlcXVpcmUoJy4vbW9kZWxzL1BjTW9kZWwnKTtcbiAgICAgIHRoaXMuUGNTdGF0TW9kZWwgPSByZXF1aXJlKCcuL21vZGVscy9QY1N0YXRNb2RlbCcpO1xuICAgIH1cbiAgICBwcm90b3R5cGUuc3RhdFZhbHVlT2YgPSBmdW5jdGlvbihuYW1lKXtcbiAgICAgIHRoaXMubG9hZFVzZXJEYXRhKCk7XG4gICAgICByZXR1cm4gdGhpcy5kYXRhLnN0YXRzW25hbWVdLnRvdGFsO1xuICAgIH07XG4gICAgcHJvdG90eXBlLmZvckVhY2hTdGF0ID0gZnVuY3Rpb24oZnVuYywgbW9kZWwpe1xuICAgICAgdmFyIGkkLCByZWYkLCBsZW4kLCBzdGF0TmFtZSwgc3RhdCwgcmVmMSQ7XG4gICAgICBtb2RlbCA9PSBudWxsICYmIChtb2RlbCA9IHRoaXMuZGF0YSk7XG4gICAgICBmb3IgKGkkID0gMCwgbGVuJCA9IChyZWYkID0gdGhpcy5QY01vZGVsLlN0YXRzKS5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgICBzdGF0TmFtZSA9IHJlZiRbaSRdO1xuICAgICAgICBzdGF0ID0gKG1vZGVsLnN0YXRzIHx8IChtb2RlbC5zdGF0cyA9IHt9KSlbc3RhdE5hbWVdO1xuICAgICAgICAobW9kZWwuc3RhdHMgfHwgKG1vZGVsLnN0YXRzID0ge30pKVtzdGF0TmFtZV0gPSAocmVmMSQgPSBmdW5jKHN0YXQsIHN0YXROYW1lKSkgIT0gbnVsbCA/IHJlZjEkIDogc3RhdDtcbiAgICAgIH1cbiAgICB9O1xuICAgIHByb3RvdHlwZS5sb2FkVXNlckRhdGEgPSBmdW5jdGlvbigpe1xuICAgICAgdmFyIGRhdGEsIG1vZGVsLCB0aGlzJCA9IHRoaXM7XG4gICAgICBkYXRhID0gdGhpcy5fc3RvcmFnZVN2Yy5sb2FkKCdwYycgIT0gbnVsbFxuICAgICAgICA/ICdwYydcbiAgICAgICAgOiB7fSk7XG4gICAgICBtb2RlbCA9IGltcG9ydCQobmV3IHRoaXMuUGNNb2RlbCh0aGlzKSwgZGF0YSk7XG4gICAgICBtb2RlbC5mb3JFYWNoU3RhdChmdW5jdGlvbihzdGF0LCBuYW1lKXtcbiAgICAgICAgdmFyIHgkLCByZWYkO1xuICAgICAgICB4JCA9IGltcG9ydCQobmV3IHRoaXMkLlBjU3RhdE1vZGVsLCBkYXRhICE9IG51bGwgPyAocmVmJCA9IGRhdGEuc3RhdHMpICE9IG51bGwgPyByZWYkW25hbWVdIDogdm9pZCA4IDogdm9pZCA4KTtcbiAgICAgICAgeCQubmFtZSA9IG5hbWU7XG4gICAgICAgIHJldHVybiB4JDtcbiAgICAgIH0pO1xuICAgICAgbW9kZWwudmFsaWRhdGUoKTtcbiAgICAgIHJldHVybiB0aGlzLmRhdGEgPSBtb2RlbDtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5zYXZlVXNlckRhdGEgPSBmdW5jdGlvbihtb2RlbCl7XG4gICAgICB2YXIgZGF0YSwga2V5LCB2YWx1ZTtcbiAgICAgIG1vZGVsID09IG51bGwgJiYgKG1vZGVsID0gdGhpcy5kYXRhKTtcbiAgICAgIG1vZGVsLnZhbGlkYXRlKCk7XG4gICAgICBkYXRhID0gaW1wb3J0JCh7fSwgbW9kZWwpO1xuICAgICAgZm9yIChrZXkgaW4gbW9kZWwpIHtcbiAgICAgICAgdmFsdWUgPSBtb2RlbFtrZXldO1xuICAgICAgICBpZiAoa2V5ICE9PSAnc3RhdHMnKSB7XG4gICAgICAgICAgZGVsZXRlIGRhdGFba2V5XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5fc3RvcmFnZVN2Yy5zYXZlKCdwYycsIGRhdGEpO1xuICAgIH07XG4gICAgcHJvdG90eXBlLnN0YXRTY2FsaW5nRmFjdG9yT2YgPSBmdW5jdGlvbihuYW1lKXtcbiAgICAgIHZhciBzdGF0VmFsdWUsIHRocmVzaG9sZHMsIHJlc3VsdCwgaSQsIGxlbiQsIHRocmVzaG9sZDtcbiAgICAgIHN0YXRWYWx1ZSA9IHRoaXMuc3RhdFZhbHVlT2YobmFtZSk7XG4gICAgICB0aHJlc2hvbGRzID0gKGZ1bmN0aW9uKCl7XG4gICAgICAgIHN3aXRjaCAobmFtZSkge1xuICAgICAgICBjYXNlICdzdHJlbmd0aCc6XG4gICAgICAgICAgLy8gZmFsbHRocm91Z2hcbiAgICAgICAgY2FzZSAnZGV4dGVyaXR5JzpcbiAgICAgICAgICByZXR1cm4gW1sxMCwgMC41XSwgWzEwLCAzLjVdLCBbMjAsIDIuMjVdXTtcbiAgICAgICAgY2FzZSAnaW50ZWxsaWdlbmNlJzpcbiAgICAgICAgICAvLyBmYWxsdGhyb3VnaFxuICAgICAgICBjYXNlICdmYWl0aCc6XG4gICAgICAgICAgcmV0dXJuIFtbMTAsIDAuNV0sIFsyMCwgMi4yNV0sIFsyMCwgMS41XV07XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgRXJyb3IoJ3VuaW1wbGVtZW50ZWQnKTtcbiAgICAgICAgfVxuICAgICAgfSgpKTtcbiAgICAgIHJlc3VsdCA9IDA7XG4gICAgICBmb3IgKGkkID0gMCwgbGVuJCA9IHRocmVzaG9sZHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgICAgdGhyZXNob2xkID0gdGhyZXNob2xkc1tpJF07XG4gICAgICAgIGlmIChzdGF0VmFsdWUgPj0gdGhyZXNob2xkWzBdKSB7XG4gICAgICAgICAgcmVzdWx0ICs9IHRocmVzaG9sZFswXSAqIHRocmVzaG9sZFsxXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXN1bHQgKz0gc3RhdFZhbHVlICogdGhyZXNob2xkWzFdO1xuICAgICAgICB9XG4gICAgICAgIHN0YXRWYWx1ZSAtPSB0aHJlc2hvbGRbMF07XG4gICAgICAgIGlmIChzdGF0VmFsdWUgPCAxKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlc3VsdCAvPSAxMDA7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gICAgcmV0dXJuIFN0YXRTZXJ2aWNlO1xuICB9KCkpO1xuICBpZiAodHlwZW9mIG1vZHVsZSAhPSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09IG51bGwpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IFN0YXRTZXJ2aWNlO1xuICB9XG4gIGZ1bmN0aW9uIGJpbmQkKG9iaiwga2V5LCB0YXJnZXQpe1xuICAgIHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gKHRhcmdldCB8fCBvYmopW2tleV0uYXBwbHkob2JqLCBhcmd1bWVudHMpIH07XG4gIH1cbiAgZnVuY3Rpb24gaW1wb3J0JChvYmosIHNyYyl7XG4gICAgdmFyIG93biA9IHt9Lmhhc093blByb3BlcnR5O1xuICAgIGZvciAodmFyIGtleSBpbiBzcmMpIGlmIChvd24uY2FsbChzcmMsIGtleSkpIG9ialtrZXldID0gc3JjW2tleV07XG4gICAgcmV0dXJuIG9iajtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiIsIihmdW5jdGlvbigpe1xuICBpZiAodHlwZW9mIG1vZHVsZSAhPSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09IG51bGwpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHVpR3JpZENvbnN0YW50cyl7XG4gICAgICB2YXIgcGVyY2VudEZpZWxkTWluV2lkdGg7XG4gICAgICBwZXJjZW50RmllbGRNaW5XaWR0aCA9IDQ1O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29sdW1uRGVmczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAnc2NvcmUnLFxuICAgICAgICAgICAgbWluV2lkdGg6IDUwLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogJ251bWJlcjoyJyxcbiAgICAgICAgICAgIHNvcnQ6IHtcbiAgICAgICAgICAgICAgZGlyZWN0aW9uOiB1aUdyaWRDb25zdGFudHMuREVTQyxcbiAgICAgICAgICAgICAgcHJpb3JpdHk6IDFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnd2VhcG9uLm5hbWUnLFxuICAgICAgICAgICAgbWluV2lkdGg6IDIxMFxuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnd2VhcG9uLnJlcVN0cicsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1JTJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICd3ZWFwb24ucmVxRGV4JyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnUkQnLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcidcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ3dlYXBvbi5yZXFJbnQnLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdSSScsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnd2VhcG9uLnJlcUZhaScsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1JGJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICd3ZWFwb24uYXRrUGh5JyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnQVAnLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgICAgICBjZWxsRmlsdGVyOiBcIm51bWJlcjowXCJcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ3dlYXBvbi5hdGtNYWcnLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdBTScsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgICAgIGNlbGxGaWx0ZXI6IFwibnVtYmVyOjBcIlxuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnd2VhcG9uLmF0a0ZpcicsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0FGJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogXCJudW1iZXI6MFwiXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICd3ZWFwb24uYXRrTGl0JyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnQUwnLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgICAgICBjZWxsRmlsdGVyOiBcIm51bWJlcjowXCJcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ3dlYXBvbi5hdGtTdGFDb3N0JyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnQVMnLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgICAgICBjZWxsRmlsdGVyOiBcIm51bWJlcjowXCJcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ3dlYXBvbi5ib251c1N0cicsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1NTJyxcbiAgICAgICAgICAgIG1pbldpZHRoOiBwZXJjZW50RmllbGRNaW5XaWR0aCxcbiAgICAgICAgICAgIGNlbGxGaWx0ZXI6ICdwZXJjZW50YWdlJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICd3ZWFwb24uYm9udXNEZXgnLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdTRCcsXG4gICAgICAgICAgICBtaW5XaWR0aDogcGVyY2VudEZpZWxkTWluV2lkdGgsXG4gICAgICAgICAgICBjZWxsRmlsdGVyOiAncGVyY2VudGFnZScsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnd2VhcG9uLmJvbnVzSW50JyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnU0knLFxuICAgICAgICAgICAgbWluV2lkdGg6IHBlcmNlbnRGaWVsZE1pbldpZHRoLFxuICAgICAgICAgICAgY2VsbEZpbHRlcjogJ3BlcmNlbnRhZ2UnLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcidcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ3dlYXBvbi5ib251c0ZhaScsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1NGJyxcbiAgICAgICAgICAgIG1pbldpZHRoOiBwZXJjZW50RmllbGRNaW5XaWR0aCxcbiAgICAgICAgICAgIGNlbGxGaWx0ZXI6ICdwZXJjZW50YWdlJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICd3ZWFwb24uZGVmUGh5JyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnRFAnLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcidcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ3dlYXBvbi5kZWZNYWcnLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdETScsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnd2VhcG9uLmRlZkZpcicsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0RGJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICd3ZWFwb24uZGVmTGl0JyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnREwnLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcidcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ3dlYXBvbi5kZWZUb3gnLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdEVCcsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnd2VhcG9uLmRlZkJsbycsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0RCJyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgZmllbGQ6ICd3ZWFwb24uZGVmQ3VyJyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnREMnLFxuICAgICAgICAgICAgdHlwZTogJ251bWJlcidcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBmaWVsZDogJ3dlYXBvbi5kZWZTdGEnLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdTdCcsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnd2VhcG9uLmRpdmluZScsXG4gICAgICAgICAgICBtaW5XaWR0aDogcGVyY2VudEZpZWxkTWluV2lkdGgsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0RpdicsXG4gICAgICAgICAgICBjZWxsRmlsdGVyOiAncGVyY2VudGFnZScsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnd2VhcG9uLm9jY3VsdCcsXG4gICAgICAgICAgICBtaW5XaWR0aDogcGVyY2VudEZpZWxkTWluV2lkdGgsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ09jYycsXG4gICAgICAgICAgICBjZWxsRmlsdGVyOiAncGVyY2VudGFnZScsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJ1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZpZWxkOiAnd2VhcG9uLndlaWdodCcsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1d0JyxcbiAgICAgICAgICAgIHR5cGU6ICdudW1iZXInXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9O1xuICAgIH07XG4gIH1cbn0pLmNhbGwodGhpcyk7XG4iLCIoZnVuY3Rpb24oKXtcbiAgcmVxdWlyZSgnLi93ZWFwb24tZmluZGVyLXNlcnZpY2UnKTtcbiAgcmVxdWlyZSgnLi93ZWFwb24tZmluZGVyLWNvbnRyb2xsZXInKTtcbn0pLmNhbGwodGhpcyk7XG4iLCIoZnVuY3Rpb24oKXtcbiAgYW5ndWxhci5tb2R1bGUoXCJkc2NcIikuY29udHJvbGxlcihcIndlYXBvbkZpbmRlckNvbnRyb2xsZXJcIiwgZnVuY3Rpb24oJHNjb3BlLCB3ZWFwb25GaW5kZXJTdmMsIHVpR3JpZENvbnN0YW50cyl7XG4gICAgJHNjb3BlLnJlc3VsdHMgPSBbXTtcbiAgICAkc2NvcGUuZ3JpZE9wdGlvbnMgPSByZXF1aXJlKCcuL2NvbmZpZy93ZWFwb24tZmluZGVyLWdyaWQtb3B0aW9ucycpKHVpR3JpZENvbnN0YW50cyk7XG4gICAgJHNjb3BlLmZpbmRXZWFwb25zID0gZnVuY3Rpb24oKXtcbiAgICAgIHdlYXBvbkZpbmRlclN2Yy5maW5kQmVzdFdlYXBvbnMoKS50aGVuKGZ1bmN0aW9uKHJlc3VsdHMpe1xuICAgICAgICAkc2NvcGUucmVzdWx0cyA9IG1hcChmdW5jdGlvbihyZXN1bHQpe1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzY29yZTogcmVzdWx0LnNjb3JlLFxuICAgICAgICAgICAgd2VhcG9uOiByZXN1bHRcbiAgICAgICAgICB9O1xuICAgICAgICB9KShcbiAgICAgICAgcmVzdWx0cyk7XG4gICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5kYXRhID0gJHNjb3BlLnJlc3VsdHM7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcbn0pLmNhbGwodGhpcyk7XG4iLCIoZnVuY3Rpb24oKXtcbiAgdmFyIFdlYXBvbkZpbmRlclNlcnZpY2U7XG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPSAndW5kZWZpbmVkJyAmJiBhbmd1bGFyICE9PSBudWxsKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJkc2NcIikuc2VydmljZShcIndlYXBvbkZpbmRlclN2Y1wiLCBmdW5jdGlvbihpdGVtU3ZjLCBzdGF0U3ZjLCAkcSl7XG4gICAgICByZXR1cm4gKGZ1bmN0aW9uKGZ1bmMsIGFyZ3MsIGN0b3IpIHtcbiAgICAgICAgY3Rvci5wcm90b3R5cGUgPSBmdW5jLnByb3RvdHlwZTtcbiAgICAgICAgdmFyIGNoaWxkID0gbmV3IGN0b3IsIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY2hpbGQsIGFyZ3MpLCB0O1xuICAgICAgICByZXR1cm4gKHQgPSB0eXBlb2YgcmVzdWx0KSAgPT0gXCJvYmplY3RcIiB8fCB0ID09IFwiZnVuY3Rpb25cIiA/IHJlc3VsdCB8fCBjaGlsZCA6IGNoaWxkO1xuICB9KShXZWFwb25GaW5kZXJTZXJ2aWNlLCBhcmd1bWVudHMsIGZ1bmN0aW9uKCl7fSk7XG4gICAgfSk7XG4gIH1cbiAgV2VhcG9uRmluZGVyU2VydmljZSA9IChmdW5jdGlvbigpe1xuICAgIFdlYXBvbkZpbmRlclNlcnZpY2UuZGlzcGxheU5hbWUgPSAnV2VhcG9uRmluZGVyU2VydmljZSc7XG4gICAgdmFyIHByb3RvdHlwZSA9IFdlYXBvbkZpbmRlclNlcnZpY2UucHJvdG90eXBlLCBjb25zdHJ1Y3RvciA9IFdlYXBvbkZpbmRlclNlcnZpY2U7XG4gICAgZnVuY3Rpb24gV2VhcG9uRmluZGVyU2VydmljZShfaXRlbVN2YywgX3N0YXRTdmMsICRxKXtcbiAgICAgIHRoaXMuX2l0ZW1TdmMgPSBfaXRlbVN2YztcbiAgICAgIHRoaXMuX3N0YXRTdmMgPSBfc3RhdFN2YztcbiAgICAgIHRoaXMuJHEgPSAkcTtcbiAgICAgIHRoaXMuY2FsY3VsYXRlU2NvcmVGb3IgPSBiaW5kJCh0aGlzLCAnY2FsY3VsYXRlU2NvcmVGb3InLCBwcm90b3R5cGUpO1xuICAgICAgdGhpcy5maW5kRml0dGluZ1dlYXBvbnMgPSBiaW5kJCh0aGlzLCAnZmluZEZpdHRpbmdXZWFwb25zJywgcHJvdG90eXBlKTtcbiAgICAgIHRoaXMuZmluZEJlc3RXZWFwb25zID0gYmluZCQodGhpcywgJ2ZpbmRCZXN0V2VhcG9ucycsIHByb3RvdHlwZSk7XG4gICAgICB0aGlzLnBhcmFtcyA9IHtcbiAgICAgICAgc3RhdEJvbnVzOiAwXG4gICAgICB9O1xuICAgIH1cbiAgICBwcm90b3R5cGUuZmluZEJlc3RXZWFwb25zID0gZnVuY3Rpb24oKXtcbiAgICAgIHZhciBhbGxXZWFwb25zLCB0aGlzJCA9IHRoaXM7XG4gICAgICBhbGxXZWFwb25zID0gW107XG4gICAgICByZXR1cm4gdGhpcy5maW5kRml0dGluZ1dlYXBvbnMoKS50aGVuKGZ1bmN0aW9uKHdlYXBvbnMpe1xuICAgICAgICBhbGxXZWFwb25zID0gYWxsV2VhcG9ucy5jb25jYXQod2VhcG9ucyk7XG4gICAgICAgIHJldHVybiBtYXAoZnVuY3Rpb24oaXQpe1xuICAgICAgICAgIHJldHVybiB0aGlzJC5faXRlbVN2Yy51cGdyYWRlQ29tcC5maW5kQWxsQXZhaWxhYmxlVXBncmFkZXNGb3IoaXQpO1xuICAgICAgICB9KShcbiAgICAgICAgdGhpcyQuJHEuYWxsKHdlYXBvbnMpKTtcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24odXBXZWFwb25zKXtcbiAgICAgICAgYWxsV2VhcG9ucyA9IGFsbFdlYXBvbnMuY29uY2F0KHVwV2VhcG9ucyk7XG4gICAgICAgIGVhY2goZnVuY3Rpb24oaXQpe1xuICAgICAgICAgIHJldHVybiBpdC5zY29yZSA9IHRoaXMkLmNhbGN1bGF0ZVNjb3JlRm9yKGl0KTtcbiAgICAgICAgfSkoXG4gICAgICAgIGFsbFdlYXBvbnMpO1xuICAgICAgICByZXR1cm4gYWxsV2VhcG9ucztcbiAgICAgIH0pO1xuICAgIH07XG4gICAgcHJvdG90eXBlLmZpbmRGaXR0aW5nV2VhcG9ucyA9IGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgdGhpcyQgPSB0aGlzO1xuICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1TdmMuZmluZEl0ZW1zRnJvbUludmVudG9yeSgnd2VhcG9uJykudGhlbihmdW5jdGlvbih3ZWFwb25zKXtcbiAgICAgICAgcmV0dXJuIHdlYXBvbnM7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5jYWxjdWxhdGVTY29yZUZvciA9IGZ1bmN0aW9uKHdlYXBvbil7XG4gICAgICB2YXIgc2NTLCBzY0QsIHNjSSwgc2NGLCBzdHIsIGRleCwgaW50LCBmYWksIHNjb3JlO1xuICAgICAgc2NTID0gdGhpcy5fc3RhdFN2Yy5zdGF0U2NhbGluZ0ZhY3Rvck9mKCdzdHJlbmd0aCcpO1xuICAgICAgc2NEID0gdGhpcy5fc3RhdFN2Yy5zdGF0U2NhbGluZ0ZhY3Rvck9mKCdkZXh0ZXJpdHknKTtcbiAgICAgIHNjSSA9IHRoaXMuX3N0YXRTdmMuc3RhdFNjYWxpbmdGYWN0b3JPZignaW50ZWxsaWdlbmNlJyk7XG4gICAgICBzY0YgPSB0aGlzLl9zdGF0U3ZjLnN0YXRTY2FsaW5nRmFjdG9yT2YoJ2ZhaXRoJyk7XG4gICAgICBzdHIgPSB0aGlzLnBhcmFtcy5zdGF0Qm9udXMgKyB0aGlzLl9zdGF0U3ZjLnN0YXRWYWx1ZU9mKCdzdHJlbmd0aCcpO1xuICAgICAgZGV4ID0gdGhpcy5wYXJhbXMuc3RhdEJvbnVzICsgdGhpcy5fc3RhdFN2Yy5zdGF0VmFsdWVPZignZGV4dGVyaXR5Jyk7XG4gICAgICBpbnQgPSB0aGlzLnBhcmFtcy5zdGF0Qm9udXMgKyB0aGlzLl9zdGF0U3ZjLnN0YXRWYWx1ZU9mKCdpbnRlbGxpZ2VuY2UnKTtcbiAgICAgIGZhaSA9IHRoaXMucGFyYW1zLnN0YXRCb251cyArIHRoaXMuX3N0YXRTdmMuc3RhdFZhbHVlT2YoJ2ZhaXRoJyk7XG4gICAgICB3ZWFwb24uYXRrUGh5ICo9IDEgKyAod2VhcG9uLmJvbnVzU3RyICogc2NTICsgd2VhcG9uLmJvbnVzRGV4ICogc2NEKTtcbiAgICAgIHdlYXBvbi5hdGtNYWcgKj0gMSArICh3ZWFwb24uYm9udXNJbnQgKiBzY0kgKyB3ZWFwb24uYm9udXNGYWkgKiBzY0YpO1xuICAgICAgcmV0dXJuIHNjb3JlID0gd2VhcG9uLmF0a1BoeTtcbiAgICB9O1xuICAgIHJldHVybiBXZWFwb25GaW5kZXJTZXJ2aWNlO1xuICB9KCkpO1xuICBpZiAodHlwZW9mIG1vZHVsZSAhPSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09IG51bGwpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IFdlYXBvbkZpbmRlclNlcnZpY2U7XG4gIH1cbiAgZnVuY3Rpb24gYmluZCQob2JqLCBrZXksIHRhcmdldCl7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiAodGFyZ2V0IHx8IG9iailba2V5XS5hcHBseShvYmosIGFyZ3VtZW50cykgfTtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiJdfQ==
